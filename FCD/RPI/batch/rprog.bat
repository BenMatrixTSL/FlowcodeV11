REM CRC: 9CBAA20B02874D61C96DAE4FEC699BE710B24B81C306C5564FD0E6EF6BFA5CF24ACACED02C13B4AC3809EC856F905CF49A0D46BD3B6AACB92DE4D84759EBB5079CA9DA2D2BBCDAE2A4D1C56CD1580BF5282E911BC87A5647F5288A9E7786B15439BA94A42E12055041011792FA2C595E7123BED004AA37D0DFA1CFD1369D9942846A8FB301366B33011C3C5BE5E407DD84C9F61B50392B4C3C8B11C402CD8753EB5EB3F9311265F42C3050DA273BE4EEE9B5D46F1830F0A0901EB42DFB13CED0135425140F79A09E3C4E04E7CDB5FC3F295E1D946A835C79
REM REVISION: 1.0
REM GUID: AE20CA3D-1EA9-4ACC-86C6-FFA1B8FCDDF1
REM DATE: 08\08\2022
REM DIR: FCD\RPI\batch\rprog.bat
@REM Paramters: Filename, OutDir, IP address, UserName, Password, sudo
@SET MX_PROJECT=%~1
@SET MX_OUTDIR=%~2
@SET MX_COMPILER=%~3
@SET MX_IP_ADDRESS=%~4
@SET MX_USERNAME=%~5
@SET MX_PASSWORD=%~6
@SET MX_SUDO=%~7
@PUSHD %MX_OUTDIR%
@ECHO Stopping %MX_PROJECT%
@ECHO id=^$( ps -fe ^| awk '/\s*%MX_PROJECT%^$/{ print ^$2 }' )  > command.txt
@ECHO if [ "$id" > "0" ]; then echo Stopping %MX_PROJECT%; kill $id; fi  >> command.txt
@"%MX_COMPILER%putty\putty" -ssh %MX_USERNAME%@%MX_IP_ADDRESS% -pw %MX_PASSWORD% -t -m command.txt
@IF %ERRORLEVEL% NEQ 0 GOTO Error

@ECHO Downloading %MX_PROJECT%
@ECHO y | "%MX_COMPILER%putty\pscp" -pw %MX_PASSWORD% "%MX_PROJECT%" %MX_USERNAME%@%MX_IP_ADDRESS%:/home/%MX_USERNAME%
@IF %ERRORLEVEL% NEQ 0 GOTO Error

@ECHO Running %MX_PROJECT%
@ECHO chmod 777 "%MX_PROJECT%"  > command.txt
@ECHO %MX_SUDO% ./"%MX_PROJECT%"  >> command.txt
@start "Flowcode" "%MX_COMPILER%putty\putty.exe" -ssh %MX_USERNAME%@%MX_IP_ADDRESS% -pw %MX_PASSWORD% -t -m command.txt  
@POPD
@EXIT 0

@:Error
@ECHO Could not connect to %MX_IP_ADDRESS%
@POPD
@EXIT 1
