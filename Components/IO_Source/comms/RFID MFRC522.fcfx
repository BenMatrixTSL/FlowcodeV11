<root>
<document scada='0' schema='103' license='10,CompMaker,WNV3JN' title='' description='' fcversion='655617' target='PIC.16F.16F1937' >
	<config data='!0,fe2!10,1eff%0,2%3,0%5,1%6,1%7,1%8,1%9,3%b,1%c,0%d,0%10,3%14,3%18,0%19,1%1a,1%1c,1%1d,0' clkspd='19660800' simspd='1' usewdt='0' constif='0' Use3V3='0' />
	<plugins >
		<dll_models enabled='1' />
	</plugins>
	<supplement use='0' head='#define _FGS(x) __attribute__((section(&quot;__FGS.sec,code&quot;))) int _FGS = (x);' body='' />
	<debug />
	<traces />
	<ghost >
		<FK2 >
			<data name='FK2D0' port='4294967295' pin='4294967295' />
			<data name='FK2D1' port='4294967295' pin='4294967295' />
			<data name='FK2D2' port='4294967295' pin='4294967295' />
			<data name='FK2D3' port='4294967295' pin='4294967295' />
			<data name='FK2D4' port='4294967295' pin='4294967295' />
			<data name='FK2D5' port='4294967295' pin='4294967295' />
			<data name='FK2D6' port='4294967295' pin='4294967295' />
			<data name='FK2D7' port='4294967295' pin='4294967295' />
			<data name='FK2D8' port='4294967295' pin='4294967295' />
			<data name='FK2D9' port='4294967295' pin='4294967295' />
			<data name='FK2D10' port='4294967295' pin='4294967295' />
			<data name='FK2D11' port='4294967295' pin='4294967295' />
			<data name='FK2D12' port='4294967295' pin='4294967295' />
			<data name='FK2D13' port='4294967295' pin='4294967295' />
			<data name='FK2D14' port='4294967295' pin='4294967295' />
			<data name='FK2D15' port='4294967295' pin='4294967295' />
			<data name='FK2A0' port='4294967295' pin='4294967295' />
			<data name='FK2A1' port='4294967295' pin='4294967295' />
			<data name='FK2A2' port='4294967295' pin='4294967295' />
			<data name='FK2A3' port='4294967295' pin='4294967295' />
			<data name='FK2A4' port='4294967295' pin='4294967295' />
			<data name='FK2A5' port='4294967295' pin='4294967295' />
		</FK2>
		<ICD >
			<data name='AnalogPrescaleValue' value='19' />
			<data name='DigitalSampleRate' value='100000' />
			<data name='BreakpointCount' value='8' />
			<data name='CallStackDepthCount' value='8' />
			<data name='ClockPort' value='1' />
			<data name='ClockPin' value='6' />
			<data name='DataPort' value='1' />
			<data name='DataPin' value='7' />
			<data name='UseDefaultPins' value='1' />
			<data name='WrapEnabled' value='1' />
			<data name='CommsDelayOverridden' value='0' />
			<data name='CommsDelay' value='9' />
			<data name='CalculatedCommsDelay' value='9' />
			<data name='AnalogEB2PrescaleValue' value='2' />
			<data name='DigitalEB2SampleRate' value='100000' />
		</ICD>
		<pins >
			<digital A='0' B='0' C='0' D='0' E='0' F='0' G='0' H='0' I='0' J='0' K='0' L='0' M='0' N='0' O='0' P='0' Q='0' R='0' S='0' T='0' U='0' V='0' W='0' X='0' Y='0' Z='0' />
			<analog A='0' B='0' C='0' D='0' E='0' F='0' G='0' H='0' I='0' J='0' K='0' L='0' M='0' N='0' O='0' P='0' Q='0' R='0' S='0' T='0' U='0' V='0' W='0' X='0' Y='0' Z='0' />
		</pins>
	</ghost>
	<components >
		<settings autoimg='0' center='1' unitscale='0' fixedscale='0' fixedx='1' fixedy='1' fixedz='1' headcode='0' />
		<definition guid='3f8d29a6-40a6-4d5e-a254-190c86d9ebb7' vstate='40' vmin='0' vmaj='3' srcleaf='MFRC522.fcfx' visiblename='RFID (MFRC522)' description='Functions designed to work with the MFRC522 contactless reader IC.
The MFRC522 supports all variants of the MIFARE Mini, MIFARE 1K, MIFARE 4K, MIFARE Ultralight, 
MIFARE DESFire EV1 and MIFARE Plus RF identification protocols.' category='Wireless' category2='' category3='' bIs2dOnly='1' bIs3dOnly='0' catenable='1' author='Ben Rowland and STibor' manuname='' manucode='' sysinfo='1061643' keywords='' dynamic='1' scadaCompatible='1' embeddedCompatible='1' showmacros='1' iconpath='..\..\Icons\Components\RFID.png' />
		<component class_type='root' codename='RFID_MFRC522_V2' panelId='-1' x='0' y='0' z='0' xsz='1' ysz='1' zsz='1' xang='0' yang='0' zang='0' xquat='0' yquat='0' zquat='0' wquat='1' visible='1' scadavisible='1' interactive='1' solid='1' layer='0' poslock='0' comp2dType='0' >
			<resources />
			<properties >
				<property name='Connections' folder='property_1' hidden='0' >
					<property name='Channel' target='cal_spi::CHANNEL' typeid='16' hidden='0' locked='0' info='SPI Channel selector' filter='000Software
001Channel 1
' />
					<property name='Prescale' target='cal_spi::PR_SCALE' typeid='16' hidden='0' locked='0' info='Prescale option selector' filter='004Fosc/4
016Fosc/16
064Fosc/64' />
					<property name='MOSI' target='cal_spi::MOSI' typeid='5' hidden='0' locked='1' info='SPI Data Out Pin SDO - Also Known as Master Out Slave In (MOSI) when used in Master mode.' />
					<property name='MOSI Remap Pin' target='cal_spi::MOSIPins' typeid='16' hidden='1' locked='0' info='Select which the target pin to assign the MOSI hardware pin functionality.' filter='000$PORTC.0
001$PORTC.1
002$PORTC.2
003$PORTC.3
004$PORTC.4
005$PORTC.5
006$PORTC.6
007$PORTC.7
008$PORTB.0
009$PORTB.1
010$PORTB.2
011$PORTB.3
012$PORTB.4
013$PORTB.5
014$PORTB.6
015$PORTB.7' />
					<property name='MISO' target='cal_spi::MISO' typeid='5' hidden='0' locked='1' info='SPI Data In Pin SDI - Also Known as Master In Slave Out (MISO) when used in Master mode.' />
					<property name='MISO Remap Pin' target='cal_spi::MISOPins' typeid='16' hidden='1' locked='0' info='Select which the target pin to assign the MISO hardware pin functionality.' filter='016$PORTC.0
017$PORTC.1
018$PORTC.2
019$PORTC.3
020$PORTC.4
021$PORTC.5
022$PORTC.6
023$PORTC.7
008$PORTB.0
009$PORTB.1
010$PORTB.2
011$PORTB.3
012$PORTB.4
013$PORTB.5
014$PORTB.6
015$PORTB.7' />
					<property name='CLK' target='cal_spi::CLK' typeid='5' hidden='0' locked='1' info='SPI Clock Pin CLK - The Clock signal is driven by the SPI master.' />
					<property name='CLK Remap Pin' target='cal_spi::CLKPins' typeid='16' hidden='1' locked='0' info='Select which the target pin to assign the CLK hardware pin functionality.' filter='000$PORTC.0
001$PORTC.1
002$PORTC.2
003$PORTC.3
004$PORTC.4
005$PORTC.5
006$PORTC.6
007$PORTC.7
008$PORTB.0
009$PORTB.1
010$PORTB.2
011$PORTB.3
012$PORTB.4
013$PORTB.5
014$PORTB.6
015$PORTB.7' />
					<property name='CS / SS' target='cal_spi::SS' typeid='5' hidden='0' locked='0' info='Chip Select / Slave Select Pin 
Master Mode: General purpose output pin used to select the remote SPI device.
Slave Mode: Hardware chip select pin input used to select the SPI device.
' />
					<property name='Reset' target='reset' typeid='5' hidden='0' locked='0' info='MFRC522 Reset Pin
' />
				</property>
				<property name='Simulation' folder='property_2' hidden='0' >
					<property name='Label' target='label' typeid='10' hidden='0' locked='0' info='' />
					<property name='Scope Traces' target='cal_spi::ScopeTraces' typeid='7' hidden='0' locked='0' info='Selects if the scope traces are automatically generated or not' />
					<property name='Console Data' target='cal_spi::ConsoleData' typeid='7' hidden='0' locked='0' info='Selects if the console data is automatically generated or not' />
					<property name='API' target='cal_spi::Injector' typeid='16' hidden='0' locked='0' info='' filter='000' />
					<property name='API CS Pin' target='cal_spi1::InjectorCS' typeid='21' hidden='1' locked='0' info='' />
				</property>
			</properties>
			<values >
				<value target='cal_spi::CHANNEL' data='001' />
				<value target='cal_spi::PR_SCALE' data='004' />
				<value target='cal_spi::MOSI' data='$PORTC.5' />
				<value target='cal_spi::MOSIPins' data='008' />
				<value target='cal_spi::MISO' data='$PORTC.4' />
				<value target='cal_spi::MISOPins' data='013' />
				<value target='cal_spi::CLK' data='$PORTC.3' />
				<value target='cal_spi::CLKPins' data='004' />
				<value target='cal_spi::SS' data='$PORTC.2' />
				<value target='reset' data='$PORTC.1' />
				<value target='label' data='MFRC522' />
				<value target='cal_spi::ScopeTraces' data='1' />
				<value target='cal_spi::ConsoleData' data='0' />
				<value target='cal_spi::Injector' data='000' />
				<value target='cal_spi1::InjectorCS' data='' />
			</values>
			<events >
				<event class='System' event='Timer' target='Ev_Timer' />
				<event class='Components' event='Property' target='Ev_Property' />
				<event class='Components' event='Initialise' target='Ev_Initialise' />
				<event class='Components' event='Renamed' target='Ev_Renamed' />
			</events>
			<apis >
				<api name='CompareUID' alt='CompareUID' type='1' proto='1' />
				<api name='IsNewCardPresent' alt='IsNewCardPresent' type='1' proto='1' />
				<api name='GetType' alt='GetType' type='1' proto='1' />
				<api name='AntennaOff' alt='AntennaOff' type='1' proto='1' />
				<api name='ReadCardSerial' alt='ReadCardSerial' type='1' proto='1' />
				<api name='MifareWrite' alt='MifareWrite' type='1' proto='1' />
				<api name='Select' alt='Select' type='1' proto='1' />
				<api name='StopCrypto' alt='StopCrypto' type='1' proto='1' />
				<api name='MifareRead' alt='MifareRead' type='1' proto='1' />
				<api name='Authenticate' alt='Authenticate' type='1' proto='1' />
				<api name='HaltA' alt='HaltA' type='1' proto='1' />
				<api name='ReadUIDByte' alt='ReadUIDByte' type='1' proto='1' />
				<api name='AntennaOn' alt='AntennaOn' type='1' proto='1' />
				<api name='Initialise' alt='Initialise' type='1' proto='1' />
			</apis>
			<variables >
				<variable public='1' >
					<def class_type='variable' name='PICC_TYPE_MIFARE_MINI' type='s16' description='' isconst='1' isHidden='0' isinit='1' usrinit='3' setinit='3' />
				</variable>
				<variable public='0' >
					<def class_type='variable' name='CollReg' type='s16' description='' isconst='1' isHidden='0' isinit='1' usrinit='14' setinit='0x0E' />
				</variable>
				<variable public='0' >
					<def class_type='variable' name='Status2Reg' type='s16' description='' isconst='1' isHidden='0' isinit='1' usrinit='8' setinit='0x08' />
				</variable>
				<variable public='1' >
					<def class_type='variable' name='PICC_TYPE_MIFARE_UL' type='s16' description='' isconst='1' isHidden='0' isinit='1' usrinit='6' setinit='6' />
				</variable>
				<variable public='1' >
					<def class_type='variable' name='STATUS_INVALID' type='s16' description='' isconst='1' isHidden='0' isinit='1' usrinit='6' setinit='6' />
				</variable>
				<variable public='0' >
					<def class_type='variable' name='PCD_MFAuthent' type='s16' description='' isconst='1' isHidden='0' isinit='1' usrinit='14' setinit='0x0E' />
				</variable>
				<variable public='0' >
					<def class_type='variable' name='FIFOLevelReg' type='s16' description='' isconst='1' isHidden='0' isinit='1' usrinit='10' setinit='0x0A' />
				</variable>
				<variable public='0' >
					<def class_type='variable' name='PCD_Transceive' type='s16' description='' isconst='1' isHidden='0' isinit='1' usrinit='12' setinit='0x0C' />
				</variable>
				<variable public='0' >
					<def class_type='variable' name='TReloadRegL' type='s16' description='' isconst='1' isHidden='0' isinit='1' usrinit='45' setinit='0x2D' />
				</variable>
				<variable public='0' >
					<def class_type='variable' name='ModWidthReg' type='s16' description='' isconst='1' isHidden='0' isinit='1' usrinit='36' setinit='0x24' />
				</variable>
				<variable public='0' >
					<def class_type='variable' name='BitFramingReg' type='s16' description='' isconst='1' isHidden='0' isinit='1' usrinit='13' setinit='0x0D' />
				</variable>
				<variable public='0' >
					<def class_type='variable' name='TxASKReg' type='s16' description='' isconst='1' isHidden='0' isinit='1' usrinit='21' setinit='0x15' />
				</variable>
				<variable public='0' >
					<def class_type='variable' name='TReloadRegH' type='s16' description='' isconst='1' isHidden='0' isinit='1' usrinit='44' setinit='0x2C' />
				</variable>
				<variable public='1' >
					<def class_type='variable' name='PICC_TYPE_MIFARE_1K' type='s16' description='' isconst='1' isHidden='0' isinit='1' usrinit='4' setinit='4' />
				</variable>
				<variable public='0' >
					<def class_type='variable' name='TxModeReg' type='s16' description='' isconst='1' isHidden='0' isinit='1' usrinit='18' setinit='0x12' />
				</variable>
				<variable public='0' >
					<def class_type='variable' name='false' type='b1' description='' isconst='1' isHidden='0' isinit='1' usrinit='0' setinit='0' />
				</variable>
				<variable public='0' >
					<def class_type='variable' name='uidSak' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
				</variable>
				<variable public='0' >
					<def class_type='variable' name='uidSize' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
				</variable>
				<variable public='1' >
					<def class_type='variable' name='STATUS_NO_ROOM' type='s16' description='' isconst='1' isHidden='0' isinit='1' usrinit='4' setinit='4' />
				</variable>
				<variable public='1' >
					<def class_type='variable' name='PICC_CMD_MF_AUTH_KEY_B' type='s16' description='' isconst='1' isHidden='0' isinit='1' usrinit='97' setinit='0x61' />
				</variable>
				<variable public='0' >
					<def class_type='variable' name='CommandReg' type='s16' description='' isconst='1' isHidden='0' isinit='1' usrinit='1' setinit='0x01' />
				</variable>
				<variable public='0' >
					<def class_type='variable' name='ControlReg' type='s16' description='' isconst='1' isHidden='0' isinit='1' usrinit='12' setinit='0x0C' />
				</variable>
				<variable public='1' >
					<def class_type='variable' name='PICC_CMD_MF_AUTH_KEY_A' type='s16' description='' isconst='1' isHidden='0' isinit='1' usrinit='96' setinit='0x60' />
				</variable>
				<variable public='0' >
					<def class_type='variable' name='CRCResultRegL' type='s16' description='' isconst='1' isHidden='0' isinit='1' usrinit='34' setinit='0x22' />
				</variable>
				<variable public='0' >
					<def class_type='variable' name='TPrescalerReg' type='s16' description='' isconst='1' isHidden='0' isinit='1' usrinit='43' setinit='0x2B' />
				</variable>
				<variable public='1' >
					<def class_type='variable' name='PICC_TYPE_TNP3XXX' type='s16' description='' isconst='1' isHidden='0' isinit='1' usrinit='9' setinit='9' />
				</variable>
				<variable public='0' >
					<def class_type='variable' name='TxControlReg' type='s16' description='' isconst='1' isHidden='0' isinit='1' usrinit='20' setinit='0x14' />
				</variable>
				<variable public='0' >
					<def class_type='variable' name='CRCResultRegH' type='s16' description='' isconst='1' isHidden='0' isinit='1' usrinit='33' setinit='0x21' />
				</variable>
				<variable public='0' >
					<def class_type='variable' name='TModeReg' type='s16' description='' isconst='1' isHidden='0' isinit='1' usrinit='42' setinit='0x2A' />
				</variable>
				<variable public='1' >
					<def class_type='variable' name='PICC_TYPE_ISO_14443_4' type='s16' description='' isconst='1' isHidden='0' isinit='1' usrinit='1' setinit='1' />
				</variable>
				<variable public='1' >
					<def class_type='variable' name='PICC_TYPE_ISO_18092' type='s16' description='' isconst='1' isHidden='0' isinit='1' usrinit='2' setinit='2' />
				</variable>
				<variable public='1' >
					<def class_type='variable' name='STATUS_CRC_WRONG' type='s16' description='' isconst='1' isHidden='0' isinit='1' usrinit='7' setinit='7' />
				</variable>
				<variable public='1' >
					<def class_type='variable' name='PICC_TYPE_NOT_COMPLETE' type='s16' description='' isconst='1' isHidden='0' isinit='1' usrinit='255' setinit='0xFF' />
				</variable>
				<variable public='1' >
					<def class_type='variable' name='STATUS_ERROR' type='s16' description='' isconst='1' isHidden='0' isinit='1' usrinit='1' setinit='1' />
				</variable>
				<variable public='1' >
					<def class_type='variable' name='PICC_TYPE_MIFARE_4K' type='s16' description='' isconst='1' isHidden='0' isinit='1' usrinit='5' setinit='5' />
				</variable>
				<variable public='0' >
					<def class_type='variable' name='MF_KEY_SIZE' type='s16' description='' isconst='1' isHidden='0' isinit='1' usrinit='6' setinit='6' />
				</variable>
				<variable public='0' >
					<def class_type='variable' name='PCD_SoftReset' type='s16' description='' isconst='1' isHidden='0' isinit='1' usrinit='15' setinit='0x0F' />
				</variable>
				<variable public='1' >
					<def class_type='variable' name='STATUS_OK' type='s16' description='' isconst='1' isHidden='0' isinit='1' usrinit='0' setinit='0' />
				</variable>
				<variable public='0' >
					<def class_type='variable' name='PCD_Idle' type='s16' description='' isconst='1' isHidden='0' isinit='1' usrinit='0' setinit='0' />
				</variable>
				<variable public='0' >
					<def class_type='variable' name='PCD_CalcCRC' type='s16' description='' isconst='1' isHidden='0' isinit='1' usrinit='3' setinit='0x03' />
				</variable>
				<variable public='0' >
					<def class_type='variable' name='RxModeReg' type='s16' description='' isconst='1' isHidden='0' isinit='1' usrinit='19' setinit='0x13' />
				</variable>
				<variable public='0' >
					<def class_type='variable' name='ComIrqReg' type='s16' description='' isconst='1' isHidden='0' isinit='1' usrinit='4' setinit='0x04' />
				</variable>
				<variable public='1' >
					<def class_type='variable' name='STATUS_TIMEOUT' type='s16' description='' isconst='1' isHidden='0' isinit='1' usrinit='3' setinit='3' />
				</variable>
				<variable public='1' >
					<def class_type='variable' name='STATUS_MIFARE_NACK' type='s16' description='' isconst='1' isHidden='0' isinit='1' usrinit='255' setinit='0xFF' />
				</variable>
				<variable public='1' >
					<def class_type='variable' name='PICC_TYPE_MIFARE_PLUS' type='s16' description='' isconst='1' isHidden='0' isinit='1' usrinit='7' setinit='7' />
				</variable>
				<variable public='1' >
					<def class_type='variable' name='STATUS_COLLISION' type='s16' description='' isconst='1' isHidden='0' isinit='1' usrinit='2' setinit='2' />
				</variable>
				<variable public='0' >
					<def class_type='variable' name='ModeReg' type='s16' description='' isconst='1' isHidden='0' isinit='1' usrinit='17' setinit='0x11' />
				</variable>
				<variable public='0' >
					<def class_type='variable' name='ErrorReg' type='s16' description='' isconst='1' isHidden='0' isinit='1' usrinit='6' setinit='0x06' />
				</variable>
				<variable public='0' >
					<def class_type='variable' name='uidBytes' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
						<array size='10' />
					</def>
				</variable>
				<variable public='0' >
					<def class_type='variable' name='DivIrqReg' type='s16' description='' isconst='1' isHidden='0' isinit='1' usrinit='5' setinit='0x05' />
				</variable>
				<variable public='0' >
					<def class_type='variable' name='FIFODataReg' type='s16' description='' isconst='1' isHidden='0' isinit='1' usrinit='9' setinit='0x09' />
				</variable>
				<variable public='1' >
					<def class_type='variable' name='PICC_TYPE_UNKNOWN' type='s16' description='' isconst='1' isHidden='0' isinit='1' usrinit='0' setinit='0' />
				</variable>
				<variable public='1' >
					<def class_type='variable' name='STATUS_INTERNAL_ERROR' type='s16' description='' isconst='1' isHidden='0' isinit='1' usrinit='5' setinit='5' />
				</variable>
				<variable public='0' >
					<def class_type='variable' name='true' type='b1' description='' isconst='1' isHidden='0' isinit='1' usrinit='1' setinit='1' />
				</variable>
			</variables>
			<macros >
				<macro >
					<flowline name='Reset' description='Resets the MFRC522 device' statediag='0' >
						<return name='Return' type='v0' description='' isconst='0' isHidden='0' isinit='0' usrinit='' setinit='' />
						<local name='done' type='u8' description='' isconst='0' isHidden='0' isinit='1' usrinit='0' setinit='0' />
						<local name='ret' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
							<exp exp='.done = 0' />
						</command>
						<command class_type='call' title='Issue the SoftReset command' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='WriteRegister' >
							<argument exp='CommandReg' />
							<argument exp='PCD_SoftReset' />
						</command>
						<command class_type='delay' title='Delay' cmdcolor='12632064' cmdcolor_sec='16769676' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' exp='50' type='1' />
						<command class_type='loop' title='Wait for the PowerDown bit in CommandReg to be cleared' cmdcolor='13142532' cmdcolor_sec='15174148' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' type='0' exp='ReadRegister (CommandReg) &amp; (1 &lt;&lt; 4)' >
							<flowline >
								<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
									<exp exp='.done = .done + 1' />
								</command>
								<command class_type='decision' title='Decision' cmdcolor='12878594' cmdcolor_sec='15113998' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' exp='.done = 100' swap='0' >
									<flowline >
										<command class_type='goto' title='Goto Connection Point' cmdcolor='16777215' cmdcolor_sec='16777215' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' labelid='0' labelname='' />
									</flowline>
									<flowline />
								</command>
							</flowline>
						</command>
						<command class_type='label' title='Connection Point' cmdcolor='12615680' cmdcolor_sec='15376912' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' labelid='0' labelname='A' />
					</flowline>
				</macro>
				<macro >
					<flowline name='CompareUID' description='Compares the UID from the ReadCardSerial macro with 4 byte UID.
Returns 0 if the addresses match.' statediag='0' >
						<return name='Return' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='Add0' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='Add1' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='Add2' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='Add3' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
							<exp exp='.Return = 255' />
						</command>
						<command class_type='decision' title='Decision' cmdcolor='12878594' cmdcolor_sec='15113998' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' exp='.Add0 = uidBytes[0]' swap='0' >
							<flowline >
								<command class_type='decision' title='Decision' cmdcolor='12878594' cmdcolor_sec='15113998' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' exp='.Add1 = uidBytes[1]' swap='0' >
									<flowline >
										<command class_type='decision' title='Decision' cmdcolor='12878594' cmdcolor_sec='15113998' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' exp='.Add2 = uidBytes[2]' swap='0' >
											<flowline >
												<command class_type='decision' title='Decision' cmdcolor='12878594' cmdcolor_sec='15113998' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' exp='.Add3 = uidBytes[3]' swap='0' >
													<flowline >
														<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
															<exp exp='.Return = 0' />
														</command>
													</flowline>
													<flowline />
												</command>
											</flowline>
											<flowline />
										</command>
									</flowline>
									<flowline />
								</command>
							</flowline>
							<flowline />
						</command>
					</flowline>
				</macro>
				<macro >
					<flowline name='Ev_Timer' description='Called back on the panel command System.TimerStart' statediag='0' >
						<return name='Return' type='u32' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='TimerID' type='u32' description='The identifier passed to the System.TimerStart panel command' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='Handle' type='h32' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<command class_type='sim' title='Component Macro' cmdcolor='16777215' cmdcolor_sec='16777215' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' component='cal_spi' macro='GetConsoleHandle' >
							<return exp='.Handle' />
						</command>
						<command class_type='sim' title='Component Macro' cmdcolor='16777215' cmdcolor_sec='16777215' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' component='LibraryComponent1' macro='SetConsoleHandle' >
							<argument exp='.Handle' />
						</command>
					</flowline>
				</macro>
				<macro >
					<flowline name='IsNewCardPresent' description='Is there a card present for us to communicate with. 
Returns 0 for no card and 1 for valid card present.' statediag='0' >
						<return name='Return' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='bufferATQA' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='2' />
						</local>
						<local name='Result' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='bufferSize' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='1' />
						</local>
						<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
							<exp exp='.bufferSize[0] = 2' />
						</command>
						<command class_type='call' title='Reset Baud Rates' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='WriteRegister' >
							<argument exp='TxModeReg' />
							<argument exp='0x00' />
						</command>
						<command class_type='call' title='Reset Baud Rates' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='WriteRegister' >
							<argument exp='RxModeReg' />
							<argument exp='0x00' />
						</command>
						<command class_type='call' title='Reset ModWidthReg' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='WriteRegister' >
							<argument exp='ModWidthReg' />
							<argument exp='0x26' />
						</command>
						<command class_type='call' title='Call Macro' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='RequestA' >
							<return exp='.Result' />
							<argument exp='.bufferATQA' />
							<argument exp='.bufferSize' />
						</command>
						<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
							<exp exp='.Return = (.result == STATUS_OK) || (.result == STATUS_COLLISION)' />
						</command>
					</flowline>
				</macro>
				<macro >
					<flowline name='GetType' description='Translates the SAK (Select Acknowledge) to a PICC type' statediag='0' >
						<return name='Return' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='sak' type='u8' description='The SAK byte returned from PICC_Select' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
							<exp exp='.sak = .sak &amp; 0x7F' />
						</command>
						<command class_type='switch' title='Switch' textarea='36,25,36,25' cmdcolor='16777215' cmdcolor_sec='16777215' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' exp='.sak' >
							<case >
								<flowline >
									<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
										<exp exp='.Return = PICC_TYPE_UNKNOWN' />
									</command>
								</flowline>
							</case>
							<case exp='0x04' >
								<flowline >
									<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
										<exp exp='.Return = PICC_TYPE_NOT_COMPLETE' />
									</command>
								</flowline>
							</case>
							<case exp='0x09' >
								<flowline >
									<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
										<exp exp='.Return = PICC_TYPE_MIFARE_MINI' />
									</command>
								</flowline>
							</case>
							<case exp='0x08' >
								<flowline >
									<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
										<exp exp='.Return = PICC_TYPE_MIFARE_1K' />
									</command>
								</flowline>
							</case>
							<case exp='0x18' >
								<flowline >
									<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
										<exp exp='.Return = PICC_TYPE_MIFARE_4K' />
									</command>
								</flowline>
							</case>
							<case exp='0x00' >
								<flowline >
									<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
										<exp exp='.Return = PICC_TYPE_MIFARE_UL' />
									</command>
								</flowline>
							</case>
							<case exp='0x10' >
								<flowline >
									<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
										<exp exp='.Return = PICC_TYPE_MIFARE_PLUS' />
									</command>
								</flowline>
							</case>
							<case exp='0x11' >
								<flowline >
									<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
										<exp exp='.Return = PICC_TYPE_MIFARE_PLUS' />
									</command>
								</flowline>
							</case>
							<case exp='0x01' >
								<flowline >
									<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
										<exp exp='.Return = PICC_TYPE_TNP3XXX' />
									</command>
								</flowline>
							</case>
							<case exp='0x20' >
								<flowline >
									<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
										<exp exp='.Return = PICC_TYPE_ISO_14443_4' />
									</command>
								</flowline>
							</case>
							<case exp='0x40' >
								<flowline >
									<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
										<exp exp='.Return = PICC_TYPE_ISO_18092' />
									</command>
								</flowline>
							</case>
						</command>
					</flowline>
				</macro>
				<macro >
					<flowline name='SetRegisterBitMask' description='Sets the specified bits in a register onboard the MFRC522 device' statediag='0' >
						<return name='Return' type='v0' description='' isconst='0' isHidden='0' isinit='0' usrinit='' setinit='' />
						<param name='Address' type='u8' description='Register Address' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='Mask' type='u8' description='Bit mask to select which bits to modify 0=dont modify, 1=modify' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='RegVal' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<command class_type='call' title='Read Register' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='ReadRegister' >
							<return exp='.RegVal' />
							<argument exp='.Address' />
						</command>
						<command class_type='call' title='Write Register with modified value' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='WriteRegister' >
							<argument exp='.Address' />
							<argument exp='.RegVal | .Mask' />
						</command>
					</flowline>
				</macro>
				<macro >
					<flowline name='AntennaOff' description='Switches off the RFID antenna to save power.
The antenna must be switched on again before communicating with an RFID tag.' statediag='0' >
						<return name='Return' type='v0' description='' isconst='0' isHidden='0' isinit='0' usrinit='' setinit='' />
						<local name='RegVal' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<command class_type='call' title='Call Macro' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='ClearRegisterBitMask' >
							<argument exp='TxControlReg' />
							<argument exp='0x03' />
						</command>
					</flowline>
				</macro>
				<macro >
					<flowline name='Ev_Initialise' description='Initialisation routine for the component once the component is linked to its parent' statediag='0' >
						<return name='Return' type='u32' description='Non-zero to prevent initialisation' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='temp' type='T8' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='20' />
						</local>
					</flowline>
				</macro>
				<macro >
					<flowline name='RequestA' description='' statediag='0' >
						<return name='Return' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='bufferATQA' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='20' />
						</param>
						<param name='bufferSize' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='20' />
						</param>
						<command class_type='call' title='PICC_CMD_REQA' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='ReqA_Or_WupA' >
							<return exp='.Return' />
							<argument exp='0x26' />
							<argument exp='.bufferATQA' />
							<argument exp='.bufferSize' />
						</command>
					</flowline>
				</macro>
				<macro >
					<flowline name='CommunicateWithPICC' description='' statediag='0' >
						<return name='Return' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='command' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='waitIRq' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='SendData' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='20' />
						</param>
						<param name='SendLen' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='BackData' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='20' />
						</param>
						<param name='BackLen' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='20' />
						</param>
						<param name='ValidBits' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='20' />
						</param>
						<param name='rxAlign' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='checkCRC' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='ReadBack' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='ValidBitsUsed' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='txLastBits' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='bitFraming' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='i' type='u16' description='' isconst='0' isHidden='0' isinit='1' usrinit='2000' setinit='2000' />
						<local name='n' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='errorRegValue' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='_validBits' type='u8' description='' isconst='0' isHidden='0' isinit='1' usrinit='0' setinit='0' />
						<local name='ControlBuffer' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='2' />
						</local>
						<local name='status' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<command class_type='calculation' title='Prepare values for BitFramingReg' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
							<exp exp='.txLastBits = .ValidBits[0]' />
							<exp exp='.bitFraming = (.rxAlign &lt;&lt; 4) + .txLastBits' />
						</command>
						<command class_type='call' title='Stop any active command' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='WriteRegister' >
							<argument exp='CommandReg' />
							<argument exp='PCD_Idle' />
						</command>
						<command class_type='call' title='Clear all seven interrupt request bits' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='WriteRegister' >
							<argument exp='ComIrqReg' />
							<argument exp='0x7F' />
						</command>
						<command class_type='call' title='FlushBuffer = 1, FIFO initialization' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='WriteRegister' >
							<argument exp='FIFOLevelReg' />
							<argument exp='0x80' />
						</command>
						<command class_type='call' title='Write sendData to the FIFO' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='WriteRegisters' >
							<argument exp='FIFODataReg' />
							<argument exp='.SendLen' />
							<argument exp='.SendData' />
						</command>
						<command class_type='call' title='Bit adjustments' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='WriteRegister' >
							<argument exp='BitFramingReg' />
							<argument exp='.bitFraming' />
						</command>
						<command class_type='call' title='Execute the command' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='WriteRegister' >
							<argument exp='CommandReg' />
							<argument exp='.command' />
						</command>
						<command class_type='decision' title='Decision' cmdcolor='12878594' cmdcolor_sec='15113998' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' exp='.command = PCD_Transceive' swap='0' >
							<flowline >
								<command class_type='call' title='StartSend=1, transmission of data starts' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='SetRegisterBitMask' >
									<argument exp='BitFramingReg' />
									<argument exp='0x80' />
								</command>
							</flowline>
							<flowline />
						</command>
						<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
							<exp exp='.i = 2000' />
						</command>
						<command class_type='loop' title='Wait for the command to complete' cmdcolor='13142532' cmdcolor_sec='15174148' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' type='0' exp='.i &gt; 0' >
							<flowline >
								<command class_type='call' title='Call Macro' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='ReadRegister' >
									<return exp='.n' />
									<argument exp='ComIrqReg' />
								</command>
								<command class_type='decision' title='One of the interrupts that signal success has been set' cmdcolor='12878594' cmdcolor_sec='15113998' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' exp='.n &amp; .waitIRq' swap='0' >
									<flowline >
										<command class_type='goto' title='Goto Connection Point' cmdcolor='16777215' cmdcolor_sec='16777215' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' labelid='0' labelname='' />
									</flowline>
									<flowline >
										<command class_type='decision' title='Timer interrupt - nothing received in 25ms' cmdcolor='12878594' cmdcolor_sec='15113998' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' exp='.n &amp; 0x01' swap='0' >
											<flowline >
												<command class_type='calculation' title='35.7ms and nothing happend. Communication with the MFRC522 might' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
													<exp exp='.Return = STATUS_TIMEOUT' />
												</command>
												<command class_type='goto' title='Goto Connection Point' cmdcolor='16777215' cmdcolor_sec='16777215' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' labelid='1' labelname='' />
											</flowline>
											<flowline />
										</command>
									</flowline>
								</command>
								<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
									<exp exp='.i = .i - 1' />
								</command>
								<command class_type='delay' title='Delay' cmdcolor='12632064' cmdcolor_sec='16769676' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' exp='10' type='0' />
							</flowline>
						</command>
						<command class_type='label' title='Connection Point' cmdcolor='12615680' cmdcolor_sec='15376912' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' labelid='0' labelname='A' />
						<command class_type='decision' title='Decision' cmdcolor='12878594' cmdcolor_sec='15113998' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' exp='.i = 0' swap='0' >
							<flowline >
								<command class_type='calculation' title='35.7ms and nothing happend. Communication with the MFRC522 might' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
									<exp exp='.Return = STATUS_TIMEOUT' />
								</command>
								<command class_type='goto' title='Goto Connection Point' cmdcolor='16777215' cmdcolor_sec='16777215' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' labelid='1' labelname='' />
							</flowline>
							<flowline />
						</command>
						<command class_type='call' title='Call Macro' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='ReadRegister' >
							<return exp='.errorRegValue' />
							<argument exp='ErrorReg' />
						</command>
						<command class_type='decision' title='BufferOvfl ParityErr ProtocolErr' cmdcolor='12878594' cmdcolor_sec='15113998' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' exp='.errorRegValue &amp; 0x13' swap='0' >
							<flowline >
								<command class_type='calculation' title='' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
									<exp exp='.Return = STATUS_ERROR' />
								</command>
								<command class_type='goto' title='Goto Connection Point' cmdcolor='16777215' cmdcolor_sec='16777215' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' labelid='1' labelname='' />
							</flowline>
							<flowline />
						</command>
						<command class_type='comment' title='' comment='The code here checks to see if BackData and BackLen are valid buffers
Otherwise no readback is performed?
if (backData &amp;&amp; backLen)' textarea='12,0,12,0' cmdcolor='16777215' cmdcolor_sec='16777215' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' />
						<command class_type='decision' title='Decision' cmdcolor='12878594' cmdcolor_sec='15113998' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' exp='.ReadBack' swap='0' >
							<flowline >
								<command class_type='call' title='Call Macro' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='ReadRegister' >
									<return exp='.n' />
									<argument exp='FIFOLevelReg' />
								</command>
								<command class_type='comment' title='' comment='Another check here to see if n &gt; *BackLen
Again we are assuming this is ok.' textarea='12,0,12,0' cmdcolor='16777215' cmdcolor_sec='16777215' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' />
								<command class_type='calculation' title='Number of bytes returned' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
									<exp exp='.BackLen[0] = .n' />
								</command>
								<command class_type='call' title='Get received data from FIFO' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='ReadRegisters' >
									<argument exp='FIFODataReg' />
									<argument exp='.n' />
									<argument exp='.BackData' />
									<argument exp='.rxAlign' />
								</command>
								<command class_type='call' title='Call Macro' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='ReadRegister' >
									<return exp='._validbits' />
									<argument exp='ControlReg' />
								</command>
								<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
									<exp exp='._validbits = ._validbits &amp; 0x07' />
								</command>
								<command class_type='comment' title='' comment='Again checking to see if Validbits is a valid buffer?!
if (validBits)' textarea='12,0,12,0' cmdcolor='16777215' cmdcolor_sec='16777215' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' />
								<command class_type='decision' title='Decision' cmdcolor='12878594' cmdcolor_sec='15113998' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' exp='.ValidBitsUsed' swap='0' >
									<flowline >
										<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
											<exp exp='.validbits[0] = ._validbits' />
										</command>
									</flowline>
									<flowline />
								</command>
							</flowline>
							<flowline />
						</command>
						<command class_type='decision' title='Tell about collisions' cmdcolor='12878594' cmdcolor_sec='15113998' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' exp='.errorRegValue &amp; 0x08' swap='0' >
							<flowline >
								<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
									<exp exp='.Return = STATUS_COLLISION' />
								</command>
								<command class_type='goto' title='Goto Connection Point' cmdcolor='16777215' cmdcolor_sec='16777215' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' labelid='1' labelname='' />
							</flowline>
							<flowline />
						</command>
						<command class_type='comment' title='' comment='Another buffer check.
if (backData &amp;&amp; backLen &amp;&amp; checkCRC)' textarea='12,0,12,0' cmdcolor='16777215' cmdcolor_sec='16777215' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' />
						<command class_type='decision' title='Perform CRC_A validation if requested' cmdcolor='12878594' cmdcolor_sec='15113998' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' exp='.checkCRC' swap='0' >
							<flowline >
								<command class_type='decision' title='In this case a MIFARE Classic NAK is not OK' cmdcolor='12878594' cmdcolor_sec='15113998' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' exp='(.backlen[0] = 1) &amp;&amp; (._validbits = 4)' swap='0' >
									<flowline >
										<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
											<exp exp='.Return = STATUS_MIFARE_NACK' />
										</command>
										<command class_type='goto' title='Goto Connection Point' cmdcolor='16777215' cmdcolor_sec='16777215' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' labelid='1' labelname='' />
									</flowline>
									<flowline />
								</command>
								<command class_type='decision' title='We need at least the CRC_A value and all 8 bits of the last byte' cmdcolor='12878594' cmdcolor_sec='15113998' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' exp='(.backlen[0] &lt; 2) &amp;&amp; (._validbits != 0)' swap='0' >
									<flowline >
										<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
											<exp exp='.Return = STATUS_CRC_WRONG' />
										</command>
										<command class_type='goto' title='Goto Connection Point' cmdcolor='16777215' cmdcolor_sec='16777215' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' labelid='1' labelname='' />
									</flowline>
									<flowline />
								</command>
								<command class_type='call' title='Verify CRC_A - do our own calculation and store the control in c' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='CalculateCRC' >
									<return exp='.status' />
									<argument exp='.BackData' />
									<argument exp='.Backlen[0] - 2' />
									<argument exp='.ControlBuffer' />
								</command>
								<command class_type='decision' title='Decision' cmdcolor='12878594' cmdcolor_sec='15113998' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' exp='.status != STATUS_OK' swap='0' >
									<flowline >
										<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
											<exp exp='.Return = .status' />
										</command>
										<command class_type='goto' title='Goto Connection Point' cmdcolor='16777215' cmdcolor_sec='16777215' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' labelid='1' labelname='' />
									</flowline>
									<flowline />
								</command>
								<command class_type='decision' title='Decision' cmdcolor='12878594' cmdcolor_sec='15113998' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' exp='(.backData[.BackLen[0] - 2] != .ControlBuffer[0]) || (.backData[.BackLen[0] - 1] != .ControlBuffer[1])' swap='0' >
									<flowline >
										<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
											<exp exp='.Return = STATUS_CRC_WRONG' />
										</command>
										<command class_type='goto' title='Goto Connection Point' cmdcolor='16777215' cmdcolor_sec='16777215' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' labelid='1' labelname='' />
									</flowline>
									<flowline />
								</command>
							</flowline>
							<flowline />
						</command>
						<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
							<exp exp='.Return = STATUS_OK' />
						</command>
						<command class_type='label' title='Connection Point' cmdcolor='12615680' cmdcolor_sec='15376912' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' labelid='1' labelname='B' />
					</flowline>
				</macro>
				<macro >
					<flowline name='ReqA_Or_WupA' description='' statediag='0' >
						<return name='Return' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='command' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='BufferATQA' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='20' />
						</param>
						<param name='BufferSize' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='20' />
						</param>
						<local name='commandpointer' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='1' />
						</local>
						<local name='validBits' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='1' />
						</local>
						<local name='status' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<command class_type='call' title='ValuesAfterColl=1 =&gt; Bits received after collision are cleare' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='ClearRegisterBitMask' >
							<argument exp='CollReg' />
							<argument exp='0x80' />
						</command>
						<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
							<exp exp='.validBits[0] = 7' />
						</command>
						<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
							<exp exp='.commandpointer[0] = .command' />
						</command>
						<command class_type='call' title='Call Macro' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='TransceiveData' >
							<return exp='.status' />
							<argument exp='.commandpointer' />
							<argument exp='1' />
							<argument exp='.BufferATQA' />
							<argument exp='.BufferSize' />
							<argument exp='.validBits' />
							<argument exp='0' />
							<argument exp='0' />
							<argument exp='1' />
							<argument exp='1' />
						</command>
						<command class_type='decision' title='Decision' cmdcolor='12878594' cmdcolor_sec='15113998' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' exp='.status != STATUS_OK' swap='0' >
							<flowline >
								<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
									<exp exp='.Return = .status' />
								</command>
							</flowline>
							<flowline >
								<command class_type='decision' title='Decision' cmdcolor='12878594' cmdcolor_sec='15113998' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' exp='(.BufferSize[0] != 2) || (.validBits[0] != 0)' swap='0' >
									<flowline >
										<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
											<exp exp='.Return = STATUS_ERROR' />
										</command>
									</flowline>
									<flowline >
										<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
											<exp exp='.Return = STATUS_OK' />
										</command>
									</flowline>
								</command>
							</flowline>
						</command>
					</flowline>
				</macro>
				<macro >
					<flowline name='ReadCardSerial' description='Simple wrapper around PICC_Select.
Returns true if a UID could be read.
Remember to call PICC_IsNewCardPresent(), PICC_RequestA() or PICC_WakeupA() first.
The read UID is available in the class variable uid.' statediag='0' >
						<return name='Return' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='result' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<command class_type='call' title='Call Macro' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='Select' >
							<return exp='.result' />
							<argument exp='0' />
						</command>
						<command class_type='decision' title='Decision' cmdcolor='12878594' cmdcolor_sec='15113998' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' exp='.result = STATUS_OK' swap='0' >
							<flowline >
								<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
									<exp exp='.Return = 1' />
								</command>
							</flowline>
							<flowline >
								<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
									<exp exp='.Return = 0' />
								</command>
							</flowline>
						</command>
					</flowline>
				</macro>
				<macro >
					<flowline name='MifareWrite' description='Writes to a block of data on a MIFARE type tag' statediag='0' >
						<return name='Return' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='BlockAddress' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='Buffer' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='20' />
						</param>
						<param name='BufferSize' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='20' />
						</param>
						<local name='tempCRC' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='2' />
						</local>
						<local name='result' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='cmdBuffer' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='2' />
						</local>
						<command class_type='comment' title='' comment='Sanity checks here to check buffers are ok
if (buffer == nullptr || bufferSize &lt; 16)' textarea='12,0,12,0' cmdcolor='16777215' cmdcolor_sec='16777215' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' />
						<command class_type='decision' title='Decision' cmdcolor='12878594' cmdcolor_sec='15113998' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' exp='.BufferSize[0] &lt; 16' swap='0' >
							<flowline >
								<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
									<exp exp='.Return = STATUS_INVALID' />
								</command>
							</flowline>
							<flowline >
								<command class_type='calculation' title='Build command buffer - PICC_CMD_MF_WRITE' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
									<exp exp='.cmdBuffer[0] = 0xA0' />
									<exp exp='.cmdBuffer[1] = .BlockAddress' />
								</command>
								<command class_type='call' title='Call Macro' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='MifareTransceive' >
									<return exp='.result' />
									<argument exp='.cmdBuffer' />
									<argument exp='2' />
									<argument exp='1' />
								</command>
								<command class_type='decision' title='Decision' cmdcolor='12878594' cmdcolor_sec='15113998' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' exp='.result != STATUS_OK' swap='0' >
									<flowline >
										<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
											<exp exp='.Return = .result' />
										</command>
									</flowline>
									<flowline >
										<command class_type='call' title='Call Macro' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='MifareTransceive' >
											<return exp='.Return' />
											<argument exp='.buffer' />
											<argument exp='.BufferSize[0]' />
											<argument exp='1' />
										</command>
									</flowline>
								</command>
							</flowline>
						</command>
					</flowline>
				</macro>
				<macro >
					<flowline name='Select' description='' statediag='0' >
						<return name='Return' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='ValidBits' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='uidComplete' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='SelectDone' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='useCascadeTag' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='CascadeLevel' type='u8' description='' isconst='0' isHidden='0' isinit='1' usrinit='1' setinit='1' />
						<local name='count' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='index' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='uidIndex' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='currentLevelKnownBits' type='s16' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='buffer' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='9' />
						</local>
						<local name='bufferUsed' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='rxAlign' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='ResponseBuffer' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='20' />
						</local>
						<local name='BytesToCopy' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='MaxBytes' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='tempCRC' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='2' />
						</local>
						<local name='result' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='ResponseLength' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='1' />
						</local>
						<local name='txLastBits' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='1' />
						</local>
						<local name='ValueOfCollReg' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='CollisionPos' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='CopyResp' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='ix' type='u8' description='' isconst='0' isHidden='0' isinit='1' usrinit='0' setinit='0' />
						<command class_type='decision' title='Sanity checks' cmdcolor='12878594' cmdcolor_sec='15113998' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' exp='.ValidBits &gt; 80' swap='0' >
							<flowline >
								<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
									<exp exp='.Return = STATUS_INVALID' />
								</command>
							</flowline>
							<flowline >
								<command class_type='call' title='Prepare MFRC522' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='ClearRegisterBitMask' >
									<argument exp='CollReg' />
									<argument exp='0x80' />
								</command>
								<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
									<exp exp='.uidComplete = 0' />
								</command>
								<command class_type='loop' title='Repeat Cascade Level loop until we have a complete UID' cmdcolor='13142532' cmdcolor_sec='15174148' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' type='0' exp='.uidComplete = 0' >
									<flowline >
										<command class_type='switch' title='Switch' textarea='36,25,36,25' cmdcolor='16777215' cmdcolor_sec='16777215' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' exp='.CascadeLevel' >
											<case >
												<flowline >
													<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
														<exp exp='.Return = STATUS_INTERNAL_ERROR' />
													</command>
													<command class_type='goto' title='Goto Connection Point' cmdcolor='16777215' cmdcolor_sec='16777215' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' labelid='0' labelname='' />
												</flowline>
											</case>
											<case exp='1' >
												<flowline >
													<command class_type='calculation' title='Anti collision/Select, Cascade Level 1' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
														<exp exp='.buffer[0] = 0x93' />
													</command>
													<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
														<exp exp='.uidIndex = 0' />
													</command>
													<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
														<exp exp='.useCascadeTag = .validbits &amp;&amp; (uidSize &gt; 4)' />
													</command>
												</flowline>
											</case>
											<case exp='2' >
												<flowline >
													<command class_type='calculation' title='Anti collision/Select, Cascade Level 2' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
														<exp exp='.buffer[0] = 0x95' />
													</command>
													<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
														<exp exp='.uidIndex = 3' />
													</command>
													<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
														<exp exp='.useCascadeTag = .validbits &amp;&amp; (uidSize &gt; 7)' />
													</command>
												</flowline>
											</case>
											<case exp='3' >
												<flowline >
													<command class_type='calculation' title='Anti collision/Select, Cascade Level 3' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
														<exp exp='.buffer[0] = 0x97' />
													</command>
													<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
														<exp exp='.uidIndex = 6' />
													</command>
													<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
														<exp exp='.useCascadeTag = 0' />
													</command>
												</flowline>
											</case>
										</command>
										<command class_type='calculation' title='How many UID bits are known in this Cascade Level' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
											<exp exp='.currentLevelKnownBits = .ValidBits - (8 * .uidIndex)' />
										</command>
										<command class_type='decision' title='Decision' cmdcolor='12878594' cmdcolor_sec='15113998' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' exp='.currentLevelKnownBits &lt; 0' swap='0' >
											<flowline >
												<command class_type='calculation' title='' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
													<exp exp='.currentLevelKnownBits = 0' />
												</command>
											</flowline>
											<flowline />
										</command>
										<command class_type='calculation' title='Copy the known bits from uid-&gt;uidByte[] to buffer[]' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
											<exp exp='.index = 2' />
										</command>
										<command class_type='decision' title='Decision' cmdcolor='12878594' cmdcolor_sec='15113998' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' exp='.useCascadeTag' swap='0' >
											<flowline >
												<command class_type='calculation' title='PICC_CMD_CT' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
													<exp exp='.buffer[.index] = 0x88' />
													<exp exp='.index = .index + 1' />
												</command>
											</flowline>
											<flowline />
										</command>
										<command class_type='calculation' title='The number of bytes needed to represent the known bits for this ' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
											<exp exp='.BytesToCopy = .currentLevelKnownBits / 8' />
										</command>
										<command class_type='decision' title='Decision' cmdcolor='12878594' cmdcolor_sec='15113998' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' exp='.currentLevelKnownBits % 8' swap='0' >
											<flowline >
												<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
													<exp exp='.BytesToCopy = .BytesToCopy + 1' />
												</command>
											</flowline>
											<flowline />
										</command>
										<command class_type='decision' title='Decision' cmdcolor='12878594' cmdcolor_sec='15113998' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' exp='.BytesToCopy' swap='0' >
											<flowline >
												<command class_type='decision' title='Decision' cmdcolor='12878594' cmdcolor_sec='15113998' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' exp='.useCascadeTag' swap='0' >
													<flowline >
														<command class_type='calculation' title='Only 3 left if we use the Cascade Tag' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
															<exp exp='.MaxBytes = 3' />
														</command>
													</flowline>
													<flowline >
														<command class_type='calculation' title='Max 4 bytes in each Cascade Level' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
															<exp exp='.MaxBytes = 4' />
														</command>
													</flowline>
												</command>
												<command class_type='decision' title='Decision' cmdcolor='12878594' cmdcolor_sec='15113998' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' exp='.BytesToCopy &gt; .MaxBytes' swap='0' >
													<flowline >
														<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
															<exp exp='.BytesToCopy = .MaxBytes' />
														</command>
													</flowline>
													<flowline />
												</command>
												<command class_type='loop' title='Loop' cmdcolor='13142532' cmdcolor_sec='15174148' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' type='2' forvar='.count' exp='.BytesToCopy' >
													<flowline >
														<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
															<exp exp='.buffer[.index] = uidBytes[.uidIndex + .count]' />
															<exp exp='.index = .index + 1' />
														</command>
													</flowline>
												</command>
											</flowline>
											<flowline />
										</command>
										<command class_type='decision' title='Decision' cmdcolor='12878594' cmdcolor_sec='15113998' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' exp='.useCascadeTag' swap='0' >
											<flowline >
												<command class_type='calculation' title='Now that the data has been copied we need to include the 8 bits ' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
													<exp exp='.currentLevelKnownBits = .currentLevelKnownBits + 8' />
												</command>
											</flowline>
											<flowline />
										</command>
										<command class_type='calculation' title='Repeat anti collision loop until we can transmit all UID bits' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
											<exp exp='.SelectDone = 0' />
										</command>
										<command class_type='loop' title='+ BCC and receive a SAK - max 32 iterations' cmdcolor='13142532' cmdcolor_sec='15174148' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' type='0' exp='.SelectDone = 0' >
											<flowline >
												<command class_type='decision' title='Find out how many bits and bytes to send and receive' cmdcolor='12878594' cmdcolor_sec='15113998' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' exp='.currentLevelKnownBits &gt;= 32' swap='0' >
													<flowline >
														<command class_type='calculation' title='NVB - Number of Valid Bits: Seven whole bytes' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
															<exp exp='.buffer[1] = 0x70' />
														</command>
														<command class_type='calculation' title='Calculate BCC - Block Check Character' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
															<exp exp='.buffer[6] = .buffer[2] ^ .buffer[3] ^ .buffer[4] ^ .buffer[5]' />
														</command>
														<command class_type='call' title='Call Macro' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='CalculateCRC' >
															<return exp='.result' />
															<argument exp='.buffer' />
															<argument exp='7' />
															<argument exp='.tempCRC' />
														</command>
														<command class_type='calculation' title='Add CRC bytes to buffer' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
															<exp exp='.buffer[7] = .tempCRC[0]' />
															<exp exp='.buffer[8] = .tempCRC[1]' />
														</command>
														<command class_type='decision' title='Decision' cmdcolor='12878594' cmdcolor_sec='15113998' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' exp='.result != STATUS_OK' swap='0' >
															<flowline >
																<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
																	<exp exp='.Return = .result' />
																</command>
																<command class_type='goto' title='Goto Connection Point' cmdcolor='16777215' cmdcolor_sec='16777215' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' labelid='0' labelname='' />
															</flowline>
															<flowline />
														</command>
														<command class_type='calculation' title='0 =&gt; All 8 bits are valid' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
															<exp exp='.txLastBits[0] = 0' />
															<exp exp='.bufferUsed = 9' />
														</command>
														<command class_type='comment' title='' comment='Some nastyness here to do with ResponseBuffer' textarea='56,4,56,4' cmdcolor='16777215' cmdcolor_sec='16777215' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' />
														<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
															<exp exp='.CopyResp = 6' />
														</command>
														<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
															<exp exp='.ResponseLength[0] = 3' />
														</command>
													</flowline>
													<flowline >
														<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
															<exp exp='.txLastBits[0] = .currentLevelKnownBits % 8' />
														</command>
														<command class_type='calculation' title='Number of whole bytes in the UID part' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
															<exp exp='.count = .currentLevelKnownBits / 8' />
														</command>
														<command class_type='calculation' title='Number of whole bytes: SEL + NVB + UIDs' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
															<exp exp='.index = 2 + .count' />
														</command>
														<command class_type='calculation' title='NVB - Number of Valid Bits' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
															<exp exp='.buffer[1] = (.index &lt;&lt; 4) + .txLastBits[0]' />
														</command>
														<command class_type='calculation' title='' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
															<exp exp='.bufferUsed = .index' />
															<exp exp='' />
														</command>
														<command class_type='decision' title='Decision' cmdcolor='12878594' cmdcolor_sec='15113998' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' exp='.txLastBits[0]' swap='0' >
															<flowline >
																<command class_type='calculation' title='' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
																	<exp exp='.bufferUsed = .bufferUsed + 1' />
																	<exp exp='' />
																</command>
															</flowline>
															<flowline />
														</command>
														<command class_type='comment' title='' comment='Some nastyness here to do with ResponseBuffer' textarea='56,4,56,4' cmdcolor='16777215' cmdcolor_sec='16777215' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' />
														<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
															<exp exp='.CopyResp = .index' />
														</command>
														<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
															<exp exp='.ResponseLength[0] = 9 - .index' />
														</command>
													</flowline>
												</command>
												<command class_type='calculation' title='Set bit adjustments' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
													<exp exp='.rxAlign = .txLastBits[0]' />
												</command>
												<command class_type='call' title='RxAlign = BitFramingReg[6..4]. TxLastBits = BitFramingReg[2..0]' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='WriteRegister' >
													<argument exp='BitFramingReg' />
													<argument exp='(.rxAlign &lt;&lt; 4) + .txLastBits[0]' />
												</command>
												<command class_type='call' title='Transmit the buffer and receive the response' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='TransceiveData' >
													<return exp='.result' />
													<argument exp='.buffer' />
													<argument exp='.bufferUsed' />
													<argument exp='.ResponseBuffer' />
													<argument exp='.ResponseLength' />
													<argument exp='.txLastBits' />
													<argument exp='.rxAlign' />
													<argument exp='0' />
													<argument exp='1' />
													<argument exp='1' />
												</command>
												<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
													<exp exp='.ix = 0' />
												</command>
												<command class_type='loop' title='Merge buffers' cmdcolor='13142532' cmdcolor_sec='15174148' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' type='0' exp='.ix &lt; .ResponseLength[0]' >
													<flowline >
														<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
															<exp exp='.buffer[.CopyResp + .ix] = .ResponseBuffer[.ix]' />
														</command>
														<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
															<exp exp='.ix = .ix + 1' />
														</command>
													</flowline>
												</command>
												<command class_type='decision' title='More than one PICC in the field =&gt; collision' cmdcolor='12878594' cmdcolor_sec='15113998' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' exp='.result = STATUS_COLLISION' swap='0' >
													<flowline >
														<command class_type='call' title='Call Macro' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='ReadRegister' >
															<return exp='.ValueOfCollReg' />
															<argument exp='CollReg' />
														</command>
														<command class_type='decision' title='CollPosNotValid' cmdcolor='12878594' cmdcolor_sec='15113998' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' exp='.ValueOfCollReg &amp; 0x20' swap='0' >
															<flowline >
																<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
																	<exp exp='.Return = STATUS_COLLISION' />
																</command>
																<command class_type='goto' title='Goto Connection Point' cmdcolor='16777215' cmdcolor_sec='16777215' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' labelid='0' labelname='' />
															</flowline>
															<flowline />
														</command>
														<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
															<exp exp='.CollisionPos = .ValueOfCollReg &amp; 0x1F' />
														</command>
														<command class_type='decision' title='Values 0-31, 0 means bit 32' cmdcolor='12878594' cmdcolor_sec='15113998' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' exp='.CollisionPos = 0' swap='0' >
															<flowline >
																<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
																	<exp exp='.CollisionPos = 32' />
																</command>
															</flowline>
															<flowline />
														</command>
														<command class_type='decision' title='No progress - should not happen' cmdcolor='12878594' cmdcolor_sec='15113998' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' exp='.CollisionPos &lt;= .currentLevelKnownBits' swap='0' >
															<flowline >
																<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
																	<exp exp='.Return = STATUS_INTERNAL_ERROR' />
																</command>
																<command class_type='goto' title='Goto Connection Point' cmdcolor='16777215' cmdcolor_sec='16777215' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' labelid='0' labelname='' />
															</flowline>
															<flowline />
														</command>
														<command class_type='calculation' title='Choose the PICC with the bit set' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
															<exp exp='.count = (.CollisionPos - 1) % 8' />
															<exp exp='.index = 1 + ((.CollisionPos - 1) / 8)' />
														</command>
														<command class_type='decision' title='Decision' cmdcolor='12878594' cmdcolor_sec='15113998' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' exp='.count' swap='0' >
															<flowline >
																<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
																	<exp exp='.index = .index + 1' />
																</command>
															</flowline>
															<flowline />
														</command>
														<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
															<exp exp='.buffer[.index] = .buffer[.index] | (1 &lt;&lt; .count)' />
														</command>
													</flowline>
													<flowline >
														<command class_type='decision' title='Decision' cmdcolor='12878594' cmdcolor_sec='15113998' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' exp='.result != STATUS_OK' swap='0' >
															<flowline >
																<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
																	<exp exp='.Return = .result' />
																</command>
																<command class_type='goto' title='Goto Connection Point' cmdcolor='16777215' cmdcolor_sec='16777215' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' labelid='0' labelname='' />
															</flowline>
															<flowline />
														</command>
														<command class_type='decision' title='Decision' cmdcolor='12878594' cmdcolor_sec='15113998' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' exp='.currentLevelKnownBits &gt;= 32' swap='0' >
															<flowline >
																<command class_type='calculation' title='No more anticollision' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
																	<exp exp='.SelectDone = 1' />
																</command>
															</flowline>
															<flowline >
																<command class_type='calculation' title='This was an ANTICOLLISION' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
																	<exp exp='.currentLevelKnownBits = 32' />
																</command>
															</flowline>
														</command>
													</flowline>
												</command>
											</flowline>
										</command>
										<command class_type='decision' title='PICC_CMD_CT' cmdcolor='12878594' cmdcolor_sec='15113998' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' exp='.buffer[2] = 0x88' swap='0' >
											<flowline >
												<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
													<exp exp='.index = 3' />
													<exp exp='.BytesToCopy = 3' />
												</command>
											</flowline>
											<flowline >
												<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
													<exp exp='.index = 2' />
													<exp exp='.BytesToCopy = 4' />
												</command>
											</flowline>
										</command>
										<command class_type='loop' title='Loop' cmdcolor='13142532' cmdcolor_sec='15174148' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' type='2' forvar='.count' exp='.BytesToCopy' >
											<flowline >
												<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
													<exp exp='uidBytes[.uidIndex + .count] = .buffer[.index]' />
												</command>
												<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
													<exp exp='.index = .index + 1' />
												</command>
											</flowline>
										</command>
										<command class_type='decision' title='Decision' cmdcolor='12878594' cmdcolor_sec='15113998' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' exp='(.ResponseLength[0] != 3) || (.txLastBits[0] != 0)' swap='0' >
											<flowline >
												<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
													<exp exp='.Return = STATUS_ERROR' />
												</command>
												<command class_type='goto' title='Goto Connection Point' cmdcolor='16777215' cmdcolor_sec='16777215' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' labelid='0' labelname='' />
											</flowline>
											<flowline />
										</command>
										<command class_type='call' title='Call Macro' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='CalculateCRC' >
											<return exp='.result' />
											<argument exp='.ResponseBuffer' />
											<argument exp='1' />
											<argument exp='.tempCRC' />
										</command>
										<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
											<exp exp='.buffer[2] = .tempCRC[0]' />
											<exp exp='.buffer[3] = .tempCRC[1]' />
										</command>
										<command class_type='decision' title='Decision' cmdcolor='12878594' cmdcolor_sec='15113998' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' exp='.result != STATUS_OK' swap='0' >
											<flowline >
												<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
													<exp exp='.Return = .result' />
												</command>
												<command class_type='goto' title='Goto Connection Point' cmdcolor='16777215' cmdcolor_sec='16777215' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' labelid='0' labelname='' />
											</flowline>
											<flowline />
										</command>
										<command class_type='decision' title='Decision' cmdcolor='12878594' cmdcolor_sec='15113998' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' exp='(.buffer[2] != .ResponseBuffer[1]) || (.buffer[3] != .ResponseBuffer[2])' swap='0' >
											<flowline >
												<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
													<exp exp='.Return = STATUS_CRC_WRONG' />
												</command>
												<command class_type='goto' title='Goto Connection Point' cmdcolor='16777215' cmdcolor_sec='16777215' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' labelid='0' labelname='' />
											</flowline>
											<flowline />
										</command>
										<command class_type='decision' title='Cascade bit set - UID not complete yes' cmdcolor='12878594' cmdcolor_sec='15113998' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' exp='.ResponseBuffer[0] &amp; 0x04' swap='0' >
											<flowline >
												<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
													<exp exp='.CascadeLevel = .CascadeLevel + 1' />
												</command>
											</flowline>
											<flowline >
												<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
													<exp exp='.uidComplete = 1' />
												</command>
												<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
													<exp exp='uidSak = .responseBuffer[0]' />
												</command>
											</flowline>
										</command>
									</flowline>
								</command>
								<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
									<exp exp='uidSize = 3 * .CascadeLevel + 1' />
								</command>
								<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
									<exp exp='.Return = STATUS_OK' />
								</command>
							</flowline>
						</command>
						<command class_type='label' title='Connection Point' cmdcolor='12615680' cmdcolor_sec='15376912' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' labelid='0' labelname='A' />
					</flowline>
				</macro>
				<macro >
					<flowline name='StopCrypto' description='Used to exit the PCD from its authenticated state.
Remember to call this function after communicating with an authenticated PICC - otherwise no new communications can start.' statediag='0' >
						<return name='Return' type='v0' description='' isconst='0' isHidden='0' isinit='0' usrinit='' setinit='' />
						<command class_type='call' title='Clear MFCrypto1On bit' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='ClearRegisterBitMask' >
							<argument exp='Status2Reg' />
							<argument exp='0x08' />
						</command>
					</flowline>
				</macro>
				<macro >
					<flowline name='ReadRegisters' description='Returns a value from a register onboard the MFRC522 device' statediag='0' >
						<return name='Return' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='reg' type='u8' description='Register Address' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='count' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='values' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='20' />
						</param>
						<param name='rxAlign' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='index' type='u8' description='' isconst='0' isHidden='0' isinit='1' usrinit='0' setinit='0' />
						<local name='address' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='mask' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='value' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
							<exp exp='.Return = 255' />
						</command>
						<command class_type='decision' title='Decision' cmdcolor='12878594' cmdcolor_sec='15113998' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' exp='.count = 0' swap='0' >
							<flowline />
							<flowline >
								<command class_type='calculation' title='MSB == 1 is for reading. LSB is not used in address' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
									<exp exp='.address = (.reg &lt;&lt; 1) | 0x80' />
								</command>
								<command class_type='calculation' title='One read is performed outside of the loop' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
									<exp exp='.count = .count - 1' />
								</command>
								<command class_type='call' title='Call Component Macro' cmdcolor='2207487' cmdcolor_sec='5488895' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' component='cal_spi' macro='Master_Enable_CS' />
								<command class_type='call' title='Call Component Macro' cmdcolor='2207487' cmdcolor_sec='5488895' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' component='cal_spi' macro='Master_Byte' >
									<argument exp='.address' />
								</command>
								<command class_type='decision' title='Only update bit positions' cmdcolor='12878594' cmdcolor_sec='15113998' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' exp='.rxAlign' swap='0' >
									<flowline >
										<command class_type='calculation' title='Create bit mask for bit positions rxAlign..7' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
											<exp exp='.mask = (0xFF &lt;&lt; .rxAlign) &amp; 0xFF' />
										</command>
										<command class_type='call' title='Read value and tell that we want to read the same address again' cmdcolor='2207487' cmdcolor_sec='5488895' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' component='cal_spi' macro='Master_Byte' >
											<return exp='.value' />
											<argument exp='.address' />
										</command>
										<command class_type='calculation' title='Apply mask to both current value of values[0] and the new data i' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
											<exp exp='.values[0] = (.values[0] &amp; ~ .mask) | (.value &amp; .mask)' />
										</command>
										<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
											<exp exp='.index = .index + 1' />
										</command>
									</flowline>
									<flowline />
								</command>
								<command class_type='loop' title='Loop' cmdcolor='13142532' cmdcolor_sec='15174148' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' type='0' exp='.index &lt; .count' >
									<flowline >
										<command class_type='call' title='Read value and tell that we want to read the same address again' cmdcolor='2207487' cmdcolor_sec='5488895' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' component='cal_spi' macro='Master_Byte' >
											<return exp='.values[.index]' />
											<argument exp='.address' />
										</command>
										<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
											<exp exp='.index = .index + 1' />
										</command>
										<command class_type='sim' title='Component Macro' cmdcolor='16777215' cmdcolor_sec='16777215' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' component='LibraryComponent1' macro='FlashRx' />
									</flowline>
								</command>
								<command class_type='call' title='Read the final byte. Send 0 to stop reading' cmdcolor='2207487' cmdcolor_sec='5488895' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' component='cal_spi' macro='Master_Byte' >
									<return exp='.values[.index]' />
									<argument exp='0' />
								</command>
								<command class_type='call' title='Call Component Macro' cmdcolor='2207487' cmdcolor_sec='5488895' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' component='cal_spi' macro='Master_Disable_CS' />
							</flowline>
						</command>
					</flowline>
				</macro>
				<macro >
					<flowline name='Ev_Property' description='Sent when a property has been changed by the User' statediag='0' >
						<return name='Return' type='u32' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='tempstr' type='T8' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='20' />
						</local>
						<command class_type='sim' title='Built-in Function' cmdcolor='16777215' cmdcolor_sec='16777215' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='System.TimerStart' >
							<argument exp='0' />
							<argument exp='200' />
						</command>
					</flowline>
				</macro>
				<macro >
					<flowline name='WriteRegisters' description='Writes a value to a register onboard the MFRC522 device' statediag='0' >
						<return name='Return' type='v0' description='' isconst='0' isHidden='0' isinit='0' usrinit='' setinit='' />
						<param name='Address' type='u8' description='Register Address' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='Count' type='u8' description='Number of bytes to write' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='data' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='20' />
						</param>
						<local name='index' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<command class_type='call' title='Call Component Macro' cmdcolor='2207487' cmdcolor_sec='5488895' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' component='cal_spi' macro='Master_Enable_CS' />
						<command class_type='call' title='Call Component Macro' cmdcolor='2207487' cmdcolor_sec='5488895' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' component='cal_spi' macro='Master_Byte' >
							<argument exp='(.Address &lt;&lt; 1) &amp; 0x7E' />
						</command>
						<command class_type='loop' title='Loop' cmdcolor='13142532' cmdcolor_sec='15174148' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' type='2' forvar='.index' exp='.count' >
							<flowline >
								<command class_type='call' title='Call Component Macro' cmdcolor='2207487' cmdcolor_sec='5488895' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' component='cal_spi' macro='Master_Byte' >
									<argument exp='.data[.index]' />
								</command>
								<command class_type='sim' title='Component Macro' cmdcolor='16777215' cmdcolor_sec='16777215' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' component='LibraryComponent1' macro='FlashTx' />
							</flowline>
						</command>
						<command class_type='call' title='Call Component Macro' cmdcolor='2207487' cmdcolor_sec='5488895' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' component='cal_spi' macro='Master_Disable_CS' />
					</flowline>
				</macro>
				<macro >
					<flowline name='MifareRead' description='Reads from a block of data on a MIFARE type tag' statediag='0' >
						<return name='Return' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='BlockAddress' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='Buffer' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='20' />
						</param>
						<param name='BufferSize' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='20' />
						</param>
						<local name='tempCRC' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='2' />
						</local>
						<local name='result' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<command class_type='comment' title='' comment='Sanity checks here to check buffers are ok
if (buffer == nullptr || *bufferSize &lt; 18)' textarea='12,0,12,0' cmdcolor='16777215' cmdcolor_sec='16777215' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' />
						<command class_type='decision' title='Decision' cmdcolor='12878594' cmdcolor_sec='15113998' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' exp='.BufferSize[0] &lt; 18' swap='0' >
							<flowline >
								<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
									<exp exp='.Return = STATUS_NO_ROOM' />
								</command>
							</flowline>
							<flowline >
								<command class_type='calculation' title='Build command buffer - PICC_CMD_MF_READ' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
									<exp exp='.buffer[0] = 0x30' />
									<exp exp='.buffer[1] = .BlockAddress' />
								</command>
								<command class_type='call' title='Calculate CRC_A' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='CalculateCRC' >
									<return exp='.result' />
									<argument exp='.Buffer' />
									<argument exp='2' />
									<argument exp='.tempCRC' />
								</command>
								<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
									<exp exp='.buffer[2] = .tempCRC[0]' />
									<exp exp='.buffer[3] = .tempCRC[1]' />
								</command>
								<command class_type='decision' title='Decision' cmdcolor='12878594' cmdcolor_sec='15113998' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' exp='.result != STATUS_OK' swap='0' >
									<flowline >
										<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
											<exp exp='.Return = .result' />
											<exp exp='' />
										</command>
									</flowline>
									<flowline >
										<command class_type='comment' title='' comment='.TempCRC below should be a nullptr' textarea='12,0,12,0' cmdcolor='16777215' cmdcolor_sec='16777215' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' />
										<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
											<exp exp='.tempCRC[0] = 0' />
											<exp exp='.tempCRC[1] = 0' />
										</command>
										<command class_type='call' title='Call Macro' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='TransceiveData' >
											<return exp='.Return' />
											<argument exp='.buffer' />
											<argument exp='4' />
											<argument exp='.buffer' />
											<argument exp='.BufferSize' />
											<argument exp='.tempCRC' />
											<argument exp='0' />
											<argument exp='1' />
											<argument exp='1' />
											<argument exp='0' />
										</command>
									</flowline>
								</command>
							</flowline>
						</command>
					</flowline>
				</macro>
				<macro >
					<flowline name='Authenticate' description='This command manages MIFARE authentication to enable a secure communication to any MIFARE Mini, MIFARE 1K and MIFARE 4K card.
All keys are set to FFFFFFFFFFFFh at chip delivery.
The authentication is described in the MFRC522 datasheet section 10.3.1.9.' statediag='0' >
						<return name='Return' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='Command' type='u8' description='PICC_CMD_MF_AUTH_KEY_A or PICC_CMD_MF_AUTH_KEY_B' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='BlockAddress' type='u8' description='The block number' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='Key' type='u8' description='Crypteo key to use' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='20' />
						</param>
						<local name='WaitIRq' type='u8' description='' isconst='0' isHidden='0' isinit='1' usrinit='16' setinit='0x10' />
						<local name='SendData' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='12' />
						</local>
						<local name='i' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='Temp' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='1' />
						</local>
						<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
							<exp exp='.Return = 255' />
						</command>
						<command class_type='decision' title='Decision' cmdcolor='12878594' cmdcolor_sec='15113998' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' exp='(.Command = PICC_CMD_MF_AUTH_KEY_A) || (.Command = PICC_CMD_MF_AUTH_KEY_B)' swap='0' >
							<flowline >
								<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
									<exp exp='.SendData[0] = .Command' />
									<exp exp='.SendData[1] = .BlockAddress' />
								</command>
								<command class_type='loop' title='Add key to data' cmdcolor='13142532' cmdcolor_sec='15174148' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' type='2' forvar='.i' exp='MF_KEY_SIZE' >
									<flowline >
										<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
											<exp exp='.SendData[2 + .i] = .Key[.i]' />
										</command>
									</flowline>
								</command>
								<command class_type='loop' title='Add last 4 bytes of UID to data' cmdcolor='13142532' cmdcolor_sec='15174148' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' type='2' forvar='.i' exp='4' >
									<flowline >
										<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
											<exp exp='.SendData[8 + .i] = uidBytes[.i + uidSize - 4]' />
										</command>
									</flowline>
								</command>
								<command class_type='call' title='Call Macro' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='CommunicateWithPICC' >
									<return exp='.Return' />
									<argument exp='PCD_MFAuthent' />
									<argument exp='.WaitIRq' />
									<argument exp='.SendData' />
									<argument exp='12' />
									<argument exp='.Temp' />
									<argument exp='.Temp' />
									<argument exp='.Temp' />
									<argument exp='0' />
									<argument exp='0' />
									<argument exp='0' />
									<argument exp='0' />
								</command>
							</flowline>
							<flowline />
						</command>
					</flowline>
				</macro>
				<macro >
					<flowline name='Ev_Renamed' description='' statediag='0' >
						<return name='Return' type='u32' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='Name' type='T8' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='20' />
						</local>
						<command class_type='sim' title='' cmdcolor='16777215' cmdcolor_sec='16777215' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='Tree.GetName' >
							<return exp='.Name' />
							<argument exp='this' />
						</command>
						<command class_type='sim' title='' cmdcolor='16777215' cmdcolor_sec='16777215' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='Component.Property.SetValue' >
							<argument exp='LibraryComponent1' />
							<argument exp='&quot;Name&quot;' />
							<argument exp='.Name' />
						</command>
					</flowline>
				</macro>
				<macro >
					<flowline name='ClearRegisterBitMask' description='Clears the specified bits in a register onboard the MFRC522 device' statediag='0' >
						<return name='Return' type='v0' description='' isconst='0' isHidden='0' isinit='0' usrinit='' setinit='' />
						<param name='Address' type='u8' description='Register Address' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='Mask' type='u8' description='Bit mask to select which bits to modify 0=dont modify, 1=modify' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='RegVal' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<command class_type='call' title='Read Register' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='ReadRegister' >
							<return exp='.RegVal' />
							<argument exp='.Address' />
						</command>
						<command class_type='call' title='Write Register with modified value' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='WriteRegister' >
							<argument exp='.Address' />
							<argument exp='.RegVal &amp; (~.Mask)' />
						</command>
					</flowline>
				</macro>
				<macro >
					<flowline name='TransceiveData' description='' statediag='0' >
						<return name='Return' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='SendData' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='20' />
						</param>
						<param name='SendLen' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='BackData' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='20' />
						</param>
						<param name='BackLen' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='20' />
						</param>
						<param name='ValidBits' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='20' />
						</param>
						<param name='rxAlign' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='checkCRC' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='ReadBack' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='ValidBitsUsed' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<command class_type='call' title='Call Macro' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='CommunicateWithPICC' >
							<return exp='.Return' />
							<argument exp='PCD_Transceive' />
							<argument exp='0x30' />
							<argument exp='.SendData' />
							<argument exp='.SendLen' />
							<argument exp='.BackData' />
							<argument exp='.BackLen' />
							<argument exp='.ValidBits' />
							<argument exp='.rxAlign' />
							<argument exp='.checkCRC' />
							<argument exp='.ReadBack' />
							<argument exp='.ValidBitsUsed' />
						</command>
					</flowline>
				</macro>
				<macro >
					<flowline name='MifareTransceive' description='' statediag='0' >
						<return name='Return' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='SendData' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='20' />
						</param>
						<param name='SendLen' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='AcceptTimeout' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='result' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='cmdBuffer' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='18' />
						</local>
						<local name='ix' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='crcBuff' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='2' />
						</local>
						<local name='waitIRq' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='cmdBufferSize' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='1' />
						</local>
						<local name='ValidBits' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='1' />
						</local>
						<command class_type='decision' title='Sanity check' cmdcolor='12878594' cmdcolor_sec='15113998' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' exp='.SendLen &gt; 16' swap='0' >
							<flowline >
								<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
									<exp exp='.Return = STATUS_INVALID' />
								</command>
							</flowline>
							<flowline >
								<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
									<exp exp='.ix = 0' />
								</command>
								<command class_type='loop' title='Loop' cmdcolor='13142532' cmdcolor_sec='15174148' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' type='0' exp='.ix &lt; .SendLen' >
									<flowline >
										<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
											<exp exp='.cmdBuffer[.ix] = .SendData[.ix]' />
										</command>
										<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
											<exp exp='.ix = .ix + 1' />
										</command>
									</flowline>
								</command>
								<command class_type='call' title='Call Macro' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='CalculateCRC' >
									<return exp='.result' />
									<argument exp='.cmdBuffer' />
									<argument exp='.SendLen' />
									<argument exp='.crcBuff' />
								</command>
								<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
									<exp exp='.cmdBuffer[.SendLen] = .crcBuff[0]' />
									<exp exp='.cmdBuffer[.SendLen + 1] = .crcBuff[1]' />
								</command>
								<command class_type='decision' title='Decision' cmdcolor='12878594' cmdcolor_sec='15113998' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' exp='.result != STATUS_OK' swap='0' >
									<flowline >
										<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
											<exp exp='.Return = .result' />
										</command>
									</flowline>
									<flowline >
										<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
											<exp exp='.SendLen = .SendLen + 2' />
										</command>
										<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
											<exp exp='.waitIRq = 0x30' />
										</command>
										<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
											<exp exp='.cmdBufferSize[0] = 18' />
										</command>
										<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
											<exp exp='.validbits[0] = 0' />
										</command>
										<command class_type='call' title='Call Macro' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='CommunicateWithPICC' >
											<return exp='.result' />
											<argument exp='PCD_Transceive' />
											<argument exp='.waitIRq' />
											<argument exp='.cmdBuffer' />
											<argument exp='.SendLen' />
											<argument exp='.cmdBuffer' />
											<argument exp='.cmdBufferSize' />
											<argument exp='.ValidBits' />
											<argument exp='0' />
											<argument exp='0' />
											<argument exp='1' />
											<argument exp='1' />
										</command>
										<command class_type='decision' title='Decision' cmdcolor='12878594' cmdcolor_sec='15113998' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' exp='.AcceptTimeout &amp;&amp; (.result = STATUS_TIMEOUT)' swap='0' >
											<flowline >
												<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
													<exp exp='.Return = STATUS_OK' />
												</command>
											</flowline>
											<flowline >
												<command class_type='decision' title='Decision' cmdcolor='12878594' cmdcolor_sec='15113998' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' exp='.result != STATUS_OK' swap='0' >
													<flowline >
														<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
															<exp exp='.Return = .result' />
														</command>
													</flowline>
													<flowline >
														<command class_type='decision' title='Decision' cmdcolor='12878594' cmdcolor_sec='15113998' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' exp='.cmdBufferSize[0] != 1 || .ValidBits[0] != 4' swap='0' >
															<flowline >
																<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
																	<exp exp='.Return = STATUS_ERROR' />
																</command>
															</flowline>
															<flowline >
																<command class_type='decision' title='MF_ACK' cmdcolor='12878594' cmdcolor_sec='15113998' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' exp='.cmdBuffer[0] != 0xA' swap='0' >
																	<flowline >
																		<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
																			<exp exp='.Return = STATUS_MIFARE_NACK' />
																		</command>
																	</flowline>
																	<flowline >
																		<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
																			<exp exp='.Return = STATUS_OK' />
																		</command>
																	</flowline>
																</command>
															</flowline>
														</command>
													</flowline>
												</command>
											</flowline>
										</command>
									</flowline>
								</command>
							</flowline>
						</command>
					</flowline>
				</macro>
				<macro >
					<flowline name='HaltA' description='Instructs a PICC in state ACTIVE(*) to go to state HALT' statediag='0' >
						<return name='Return' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='buffer' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='4' />
						</local>
						<local name='tempbuff' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='2' />
						</local>
						<local name='temp' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='1' />
						</local>
						<command class_type='calculation' title='Build command buffer - PICC_CMD_HLTA' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
							<exp exp='.buffer[0] = 0x50' />
							<exp exp='.buffer[1] = 0' />
						</command>
						<command class_type='call' title='Calculate CRC_A' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='CalculateCRC' >
							<return exp='.Return' />
							<argument exp='.buffer' />
							<argument exp='2' />
							<argument exp='.tempbuff' />
						</command>
						<command class_type='calculation' title='Combine Buffer with CRC' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
							<exp exp='.buffer[2] = .tempbuff[0]' />
							<exp exp='.buffer[3] = .tempbuff[1]' />
						</command>
						<command class_type='decision' title='Decision' cmdcolor='12878594' cmdcolor_sec='15113998' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' exp='.Return != STATUS_OK' swap='0' >
							<flowline />
							<flowline >
								<command class_type='comment' title='' comment='This contains nulls in the ref code
' textarea='12,0,12,0' cmdcolor='16777215' cmdcolor_sec='16777215' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' />
								<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
									<exp exp='.temp[0] = 0' />
								</command>
								<command class_type='call' title='Send the command' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='TransceiveData' >
									<return exp='.Return' />
									<argument exp='.buffer' />
									<argument exp='4' />
									<argument exp='.temp' />
									<argument exp='.temp' />
									<argument exp='.temp' />
									<argument exp='0' />
									<argument exp='0' />
									<argument exp='0' />
									<argument exp='0' />
								</command>
								<command class_type='comment' title='' comment='The standard says:
If the PICC responds with any modulation during a period of 1 ms after the end of the frame containing the
HLTA command, this response shall be interpreted as &apos;not acknowledge&apos;.
We interpret that this way: Only STATUS_TIMEOUT is a success.' textarea='12,0,12,0' cmdcolor='16777215' cmdcolor_sec='16777215' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' />
								<command class_type='decision' title='Decision' cmdcolor='12878594' cmdcolor_sec='15113998' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' exp='.Return = STATUS_TIMEOUT' swap='0' >
									<flowline >
										<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
											<exp exp='.Return = STATUS_OK' />
										</command>
									</flowline>
									<flowline >
										<command class_type='decision' title='Decision' cmdcolor='12878594' cmdcolor_sec='15113998' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' exp='.Return = STATUS_OK' swap='0' >
											<flowline >
												<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
													<exp exp='.Return = STATUS_ERROR' />
												</command>
											</flowline>
											<flowline />
										</command>
									</flowline>
								</command>
							</flowline>
						</command>
					</flowline>
				</macro>
				<macro >
					<flowline name='ReadRegister' description='Returns a value from a register onboard the MFRC522 device' statediag='0' >
						<return name='Return' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='Address' type='u8' description='Register Address' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<command class_type='call' title='Call Component Macro' cmdcolor='2207487' cmdcolor_sec='5488895' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' component='cal_spi' macro='Master_Enable_CS' />
						<command class_type='call' title='Call Component Macro' cmdcolor='2207487' cmdcolor_sec='5488895' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' component='cal_spi' macro='Master_Byte' >
							<argument exp='((.Address &lt;&lt; 1) &amp; 0x7E) | 0x80' />
						</command>
						<command class_type='call' title='Call Component Macro' cmdcolor='2207487' cmdcolor_sec='5488895' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' component='cal_spi' macro='Master_Byte' >
							<return exp='.Return' />
							<argument exp='0' />
						</command>
						<command class_type='call' title='Call Component Macro' cmdcolor='2207487' cmdcolor_sec='5488895' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' component='cal_spi' macro='Master_Disable_CS' />
						<command class_type='sim' title='Component Macro' cmdcolor='16777215' cmdcolor_sec='16777215' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' component='LibraryComponent1' macro='FlashRx' />
					</flowline>
				</macro>
				<macro >
					<flowline name='ReadUIDByte' description='' statediag='0' >
						<return name='Return' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='Index' type='u8' description='0-9 = UID Data Bytes, 10 = UID Length, 11 = UID SAK' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<command class_type='switch' title='Switch' textarea='36,25,36,25' cmdcolor='16777215' cmdcolor_sec='16777215' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' exp='.index' >
							<case >
								<flowline >
									<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
										<exp exp='.Return = uidBytes[.index]' />
									</command>
								</flowline>
							</case>
							<case exp='10' >
								<flowline >
									<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
										<exp exp='.Return = uidSize' />
									</command>
								</flowline>
							</case>
							<case exp='11' >
								<flowline >
									<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
										<exp exp='.Return = uidSak' />
									</command>
								</flowline>
							</case>
						</command>
					</flowline>
				</macro>
				<macro >
					<flowline name='CalculateCRC' description='' statediag='0' >
						<return name='Return' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='data' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='20' />
						</param>
						<param name='length' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='result' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='20' />
						</param>
						<local name='i' type='u16' description='' isconst='0' isHidden='0' isinit='1' usrinit='5000' setinit='5000' />
						<local name='n' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<command class_type='call' title='Stop any active command' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='WriteRegister' >
							<argument exp='CommandReg' />
							<argument exp='PCD_Idle' />
						</command>
						<command class_type='call' title='Clear the CRCIRq interrupt request bit' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='WriteRegister' >
							<argument exp='DivIrqReg' />
							<argument exp='0x04' />
						</command>
						<command class_type='call' title='FlushBuffer = 1, FIFO initialization' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='WriteRegister' >
							<argument exp='FIFOLevelReg' />
							<argument exp='0x80' />
						</command>
						<command class_type='call' title='Write data to the FIFO' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='WriteRegisters' >
							<argument exp='FIFODataReg' />
							<argument exp='.length' />
							<argument exp='.data' />
						</command>
						<command class_type='call' title='Start the calculation' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='WriteRegister' >
							<argument exp='CommandReg' />
							<argument exp='PCD_CalcCRC' />
						</command>
						<command class_type='loop' title='Wait for the CRC calculation to complete' cmdcolor='13142532' cmdcolor_sec='15174148' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' type='0' exp='.i &gt; 0' >
							<flowline >
								<command class_type='call' title='Call Macro' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='ReadRegister' >
									<return exp='.n' />
									<argument exp='DivIrqReg' />
								</command>
								<command class_type='decision' title='CRCIRq bit set - calculation done' cmdcolor='12878594' cmdcolor_sec='15113998' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' exp='.n &amp; 0x04' swap='0' >
									<flowline >
										<command class_type='call' title='Stop calculating CRC for new content in the FIFO' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='WriteRegister' >
											<argument exp='CommandReg' />
											<argument exp='PCD_Idle' />
										</command>
										<command class_type='call' title='Transfer the result from the registers to the result buffer' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='ReadRegister' >
											<return exp='.result[0]' />
											<argument exp='CRCResultRegL' />
										</command>
										<command class_type='call' title='Transfer the result from the registers to the result buffer' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='ReadRegister' >
											<return exp='.Result[1]' />
											<argument exp='CRCResultRegH' />
										</command>
										<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
											<exp exp='.Return = STATUS_OK' />
										</command>
										<command class_type='goto' title='Goto Connection Point' cmdcolor='16777215' cmdcolor_sec='16777215' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' labelid='0' labelname='' />
									</flowline>
									<flowline >
										<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
											<exp exp='.i = .i - 1' />
										</command>
									</flowline>
								</command>
							</flowline>
						</command>
						<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
							<exp exp='.Return = STATUS_TIMEOUT' />
						</command>
						<command class_type='label' title='Connection Point' cmdcolor='12615680' cmdcolor_sec='15376912' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' labelid='0' labelname='A' />
					</flowline>
				</macro>
				<macro >
					<flowline name='AntennaOn' description='Switches on the RFID antenna.
Called as part of the Initialise macro.' statediag='0' >
						<return name='Return' type='v0' description='' isconst='0' isHidden='0' isinit='0' usrinit='' setinit='' />
						<local name='RegVal' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<command class_type='call' title='Read Register' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='ReadRegister' >
							<return exp='.RegVal' />
							<argument exp='TxControlReg' />
						</command>
						<command class_type='decision' title='Decision' cmdcolor='12878594' cmdcolor_sec='15113998' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' exp='(.RegVal &amp; 0x03) != 0x03' swap='0' >
							<flowline >
								<command class_type='call' title='Call Macro' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='WriteRegister' >
									<argument exp='TxControlReg' />
									<argument exp='.RegVal | 0x03' />
								</command>
							</flowline>
							<flowline />
						</command>
					</flowline>
				</macro>
				<macro >
					<flowline name='Main' description='' statediag='0' >
						<return name='Return' type='v0' description='' isconst='0' isHidden='0' isinit='0' usrinit='' setinit='' />
					</flowline>
				</macro>
				<macro >
					<flowline name='WriteRegister' description='Writes a value to a register onboard the MFRC522 device' statediag='0' >
						<return name='Return' type='v0' description='' isconst='0' isHidden='0' isinit='0' usrinit='' setinit='' />
						<param name='Address' type='u8' description='Register Address' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='Value' type='u8' description='Data to write to the register' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<command class_type='call' title='Call Component Macro' cmdcolor='2207487' cmdcolor_sec='5488895' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' component='cal_spi' macro='Master_Enable_CS' />
						<command class_type='call' title='Call Component Macro' cmdcolor='2207487' cmdcolor_sec='5488895' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' component='cal_spi' macro='Master_Byte' >
							<argument exp='(.Address &lt;&lt; 1) &amp; 0x7E' />
						</command>
						<command class_type='call' title='Call Component Macro' cmdcolor='2207487' cmdcolor_sec='5488895' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' component='cal_spi' macro='Master_Byte' >
							<argument exp='.Value' />
						</command>
						<command class_type='call' title='Call Component Macro' cmdcolor='2207487' cmdcolor_sec='5488895' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' component='cal_spi' macro='Master_Disable_CS' />
						<command class_type='sim' title='Component Macro' cmdcolor='16777215' cmdcolor_sec='16777215' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' component='LibraryComponent1' macro='FlashTx' />
					</flowline>
				</macro>
				<macro >
					<flowline name='Initialise' description='Initialises the RFID module ready for interaction with RFID tags.' statediag='0' >
						<return name='Return' type='v0' description='' isconst='0' isHidden='0' isinit='0' usrinit='' setinit='' />
						<local name='Adress3' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='Data3' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='HardReset' type='u8' description='' isconst='0' isHidden='0' isinit='1' usrinit='0' setinit='0' />
						<local name='in' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<command class_type='calculation' title='Bring device out of reset' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
							<exp exp='.in = reset' />
						</command>
						<command class_type='call' title='Call Component Macro' cmdcolor='2207487' cmdcolor_sec='5488895' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' component='cal_spi' macro='Master_Init' />
						<command class_type='decision' title='If a valid pin number has been set, pull device out of power dow' cmdcolor='12878594' cmdcolor_sec='15113998' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' exp='reset = 0' swap='0' >
							<flowline >
								<command class_type='calculation' title='Now set the resetPowerDownPin as digital output' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
									<exp exp='reset = 1' />
								</command>
								<command class_type='delay' title='Delay' cmdcolor='12632064' cmdcolor_sec='16769676' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' exp='50' type='1' />
								<command class_type='calculation' title='Calculation' cmdcolor='16760911' cmdcolor_sec='16760841' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' >
									<exp exp='.HardReset = 1' />
								</command>
							</flowline>
							<flowline />
						</command>
						<command class_type='decision' title='Perform a soft reset if we haven&apos;t triggered a hard reset above' cmdcolor='12878594' cmdcolor_sec='15113998' cmdcolor_txt='0' cmdgradient='1' cmdopacity='1' exp='.HardReset = 0' swap='0' >
							<flowline >
								<command class_type='call' title='Call Macro' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='Reset' />
							</flowline>
							<flowline />
						</command>
						<command class_type='call' title='Reset Baud Rates' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='WriteRegister' >
							<argument exp='TxModeReg' />
							<argument exp='0x00' />
						</command>
						<command class_type='call' title='Reset Baud Rates' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='WriteRegister' >
							<argument exp='RxModeReg' />
							<argument exp='0x00' />
						</command>
						<command class_type='call' title='Reset ModWidthReg' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='WriteRegister' >
							<argument exp='ModWidthReg' />
							<argument exp='0x26' />
						</command>
						<command class_type='comment' title='' comment='When communicating with a PICC we need a timeout if something goes wrong' textarea='12,0,12,0' cmdcolor='16777215' cmdcolor_sec='16777215' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' />
						<command class_type='call' title='Call Macro' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='WriteRegister' >
							<argument exp='TModeReg' />
							<argument exp='0x80' />
						</command>
						<command class_type='call' title='Call Macro' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='WriteRegister' >
							<argument exp='TPrescalerReg' />
							<argument exp='0xA9' />
						</command>
						<command class_type='call' title='Reload timer with 0x3E8 = 1000, ie 25ms before timeout' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='WriteRegister' >
							<argument exp='TReloadRegH' />
							<argument exp='0x03' />
						</command>
						<command class_type='call' title='Call Macro' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='WriteRegister' >
							<argument exp='TReloadRegL' />
							<argument exp='0xE8' />
						</command>
						<command class_type='call' title='Default 0x00. Force a 100 % ASK modulation independent of the Mo' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='WriteRegister' >
							<argument exp='TxASKReg' />
							<argument exp='0x40' />
						</command>
						<command class_type='call' title='Default 0x3F. Set the preset value for the CRC coprocessor for t' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='WriteRegister' >
							<argument exp='ModeReg' />
							<argument exp='0x3D' />
						</command>
						<command class_type='call' title='Enable the antenna driver pins TX1 and TX2' cmdcolor='1879295' cmdcolor_sec='5751039' cmdcolor_txt='8355711' cmdgradient='1' cmdopacity='1' macro='AntennaOn' />
					</flowline>
				</macro>
			</macros>
			<component class_type='ref' guid='c67171df-0ad6-4b11-8361-cfe14b072847' vmin='1' vmaj='2' codename='cal_spi' panelId='-1' x='0.590444' y='-0.939101' z='150.983' xsz='0.05' ysz='0.05' zsz='0.05' xang='0' yang='0' zang='0' xquat='0' yquat='0' zquat='0' wquat='1' visible='1' scadavisible='1' interactive='1' solid='1' layer='1' poslock='0' comp2dType='0' >
				<resources />
				<properties />
				<values >
					<value target='ENABLED' data='1' />
					<value target='REF' data='1' />
					<value target='CHANNEL' data='001' />
					<value target='MOSI' data='$PORTC.5' />
					<value target='MOSIPins' data='008' />
					<value target='MISO' data='$PORTC.4' />
					<value target='MISOPins' data='013' />
					<value target='CLK' data='$PORTC.3' />
					<value target='CLKPins' data='004' />
					<value target='UseAutoCS' data='1' />
					<value target='UseCS' data='0' />
					<value target='SS' data='$PORTC.2' />
					<value target='CSPolarity' data='000' />
					<value target='SSPins' data='000' />
					<value target='AltSSPin' data='0' />
					<value target='Mode' data='000' />
					<value target='PR_SCALE' data='004' />
					<value target='CKE' data='001' />
					<value target='CKP' data='001' />
					<value target='SMP' data='001' />
					<value target='ScopeTraces' data='1' />
					<value target='ConsoleData' data='0' />
					<value target='Injector' data='000' />
					<value target='InjectorCS' data='0' />
					<value target='InjectorHandle' data='0' />
					<value target='InjectorChannel' data='0' />
					<value target='Loading' data='1' />
					<value target='BMODE' data='7' />
					<value target='MOSI_PORT' data='$PORTC.5' />
					<value target='MOSI_TRIS' data='$PORTC.5' />
					<value target='MOSI_PIN' data='5' />
					<value target='MISO_PORT' data='$PORTC.4' />
					<value target='MISO_TRIS' data='$PORTC.4' />
					<value target='MISO_PIN' data='4' />
					<value target='SCK_PORT' data='$PORTC.3' />
					<value target='SCK_TRIS' data='$PORTC.3' />
					<value target='SCK_PIN' data='3' />
					<value target='SS_PORT' data='$PORTC.2' />
					<value target='SS_TRIS' data='$PORTC.2' />
					<value target='SS_PIN' data='2' />
					<value target='Remappable' data='' />
					<value target='MOSIReg' data='008' />
					<value target='CLKREG' data='004' />
					<value target='MOSIRPNUM' data='21' />
					<value target='MOSIBank' data='b' />
					<value target='MOSIBank2' data='c' />
					<value target='CLKRPNUM' data='20' />
					<value target='CLKBank' data='b' />
					<value target='MISORPREG' data='SSP1DATPPS' />
					<value target='MISOBank' data='b' />
					<value target='SPIName' data='' />
					<value target='MISOReg' data='000' />
					<value target='SPIClock' data='' />
					<value target='MISOBank2' data='c' />
					<value target='CLKBank2' data='c' />
					<value target='ParentName' data='' />
					<value target='BitDelay' data='0' />
					<value target='ClockSpeed' data='19660800' />
					<value target='MasterDivider' data='4' />
					<value target='Sim' data='1' />
					<value target='CLKRPREG' data='' />
					<value target='SSRPREG' data='' />
					<value target='SSBank' data='' />
					<value target='SSBank2' data='' />
					<value target='AltSSReg' data='' />
					<value target='AltSSMask' data='0' />
				</values>
				<events />
				<apis />
				<variables />
				<macros />
			</component>
			<component class_type='ref' guid='58be670e-18fb-477e-ab09-61fde14b23ec' vmin='0' vmaj='1' codename='LibraryComponent1' panelId='-1' x='0' y='0' z='0' xsz='100' ysz='100' zsz='100' xang='0' yang='0' zang='0' xquat='0' yquat='0' zquat='0' wquat='1' visible='1' scadavisible='1' interactive='1' solid='1' layer='1' poslock='1' comp2dType='0' >
				<resources />
				<properties />
				<values >
					<value target='Text::sText' data='MFRC522' />
					<value target='Name' data='' />
					<value target='Peripheral::sText' data='(SPI CH1)' />
					<value target='Text::nVerticalAlignment' data='002' />
					<value target='ShowComms' data='1' />
					<value target='InputIcon::CommsType' data='255' />
					<value target='InputIcon::LinkTo' data='0' />
					<value target='IconsOnRight' data='0' />
					<value target='OutputIcon::CommsType' data='005' />
					<value target='OutputIcon::LinkTo' data='0' />
					<value target='InputIcon1::CommsType' data='255' />
					<value target='ConsoleHandle' data='0' />
					<value target='Upgraded' data='0' />
				</values>
				<events />
				<apis />
				<variables />
				<macros />
			</component>
		</component>
	</components>
	<scadaresourcelookup />
	<keymap />
	<panel2d shadows='0' lighting='2' brightness='0' >
		<background rgb='5767167' img='' style='0' />
		<camera xe='-1.03277' ye='-22.5939' ze='440.201' xt='-1.03277' yt='-22.5939' zt='0' xquat='0' yquat='0' zquat='0' wquat='1' />
		<viewport dx='622' dy='352' zoom='170.972' fix_topleft='0' />
		<page x='1000' y='1000' show='0' rgb='7360576' />
		<winpos ID='7005' RectRecentFloat='1270,427,1920,877' RectRecentDocked='0,0,330,723' RecentFrameAlignment='16384' RecentRowIndex='0' IsFloating='1' MRUWidth='32767' PinState='0' IsMaximized='0' IsVisible='1' />
	</panel2d>
	<panel3d shadows='0' lighting='2' brightness='0' perspective='1' >
		<background rgb='8409120' img='' style='0' />
		<table rgb='7360576' img='' style='0' size='28' />
		<camera xe='-0.85406' ye='0.675485' ze='176.29' xt='-0.85406' yt='0.675485' zt='0' xquat='0' yquat='0' zquat='0' wquat='1' />
		<camerakey0 xe='0' ye='0' ze='300' xt='0' yt='0' zt='0' xquat='0' yquat='0' zquat='0' wquat='1' />
		<camerakey1 xe='-3.67394e-14' ye='0' ze='-300' xt='0' yt='0' zt='0' xquat='0' yquat='1' zquat='0' wquat='6.12323e-17' />
		<camerakey2 xe='0' ye='-300' ze='6.66134e-14' xt='0' yt='0' zt='0' xquat='-0.707107' yquat='0' zquat='0' wquat='0.707107' />
		<camerakey3 xe='-3.67394e-14' ye='300' ze='6.66134e-14' xt='0' yt='0' zt='0' xquat='-4.32978e-17' yquat='0.707107' zquat='0.707107' wquat='4.32978e-17' />
		<camerakey4 xe='-300' ye='-6.66134e-14' ze='6.66134e-14' xt='0' yt='0' zt='0' xquat='-0.5' yquat='0.5' zquat='0.5' wquat='0.5' />
		<camerakey5 xe='300' ye='-6.66134e-14' ze='6.66134e-14' xt='0' yt='0' zt='0' xquat='-0.5' yquat='-0.5' zquat='-0.5' wquat='0.5' />
		<camerakey6 xe='-173.205' ye='-173.205' ze='173.205' xt='0' yt='0' zt='0' xquat='-0.424708' yquat='0.17592' zquat='0.339851' wquat='0.820473' />
		<winpos ID='7004' RectRecentFloat='0,425,654,1002' RectRecentDocked='0,0,210,723' RecentFrameAlignment='16384' RecentRowIndex='0' IsFloating='0' MRUWidth='32767' PinState='0' IsMaximized='0' IsVisible='0' />
	</panel3d>
	<panels2d count='0' />
	<layout >
		<view type='0' name='Reset' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAA8gIAAM4CAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='Initialise' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAA8gIAAM4CAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='WriteRegister' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAA8gIAAM4CAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='ReadRegister' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAA8gIAAM4CAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='WriteRegisters' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAA8gIAAM4CAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='ReadRegisters' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAA8gIAAM4CAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='Main' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAA8gIAAM4CAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='Ev_Initialise' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAA8gIAAM4CAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='Ev_Property' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAA8gIAAM4CAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='MifareWrite' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAA8gIAAM4CAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='MifareRead' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAA8gIAAM4CAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='IsNewCardPresent' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAA8gIAAM4CAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='CalculateCRC' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAA8gIAAM4CAAA' zoom='75' scrollx='0' scrolly='249' flags='0' />
		<view type='0' name='HaltA' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAA8gIAAM4CAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='Select' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAA8gIAAM4CAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='Authenticate' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAA8gIAAM4CAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='CompareUID' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAA8gIAAM4CAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='MifareTransceive' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAA8gIAAM4CAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='CommunicateWithPICC' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAA8gIAAM4CAAA' zoom='75' scrollx='0' scrolly='2239' flags='0' />
		<view type='0' name='ReadUIDByte' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAA8gIAAM4CAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='ReadCardSerial' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAA8gIAAM4CAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='ReqA_Or_WupA' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAA8gIAAM4CAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='TransceiveData' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAA8gIAAM4CAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='RequestA' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAA8gIAAM4CAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='AntennaOn' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAA8gIAAM4CAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='GetType' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAA8gIAAM4CAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='StopCrypto' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAA8gIAAM4CAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='AntennaOff' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAA8gIAAM4CAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='ClearRegisterBitMask' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAA8gIAAM4CAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='SetRegisterBitMask' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAA8gIAAM4CAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='Ev_Timer' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAA8gIAAM4CAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
	</layout>
</document>
</root>
