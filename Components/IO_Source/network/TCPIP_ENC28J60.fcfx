<root>
<document scada='0' schema='103' license='10,BenR,C9TN1M' title='' description='' fcversion='655363' target='PIC.16F.16F1937' >
	<config data='!0,fe2!10,1eff%0,2%3,0%5,1%6,1%7,1%8,1%9,3%b,1%c,0%d,0%10,3%14,3%18,0%19,1%1a,1%1c,1%1d,0' clkspd='19660800' simspd='1' usewdt='0' constif='0' Use3V3='0' />
	<plugins >
		<dll_models enabled='1' />
	</plugins>
	<supplement use='0' head='' body='' />
	<debug />
	<traces />
	<ghost >
		<FK2 >
			<data name='FK2D0' port='4294967295' pin='4294967295' />
			<data name='FK2D1' port='4294967295' pin='4294967295' />
			<data name='FK2D2' port='4294967295' pin='4294967295' />
			<data name='FK2D3' port='4294967295' pin='4294967295' />
			<data name='FK2D4' port='4294967295' pin='4294967295' />
			<data name='FK2D5' port='4294967295' pin='4294967295' />
			<data name='FK2D6' port='4294967295' pin='4294967295' />
			<data name='FK2D7' port='4294967295' pin='4294967295' />
			<data name='FK2D8' port='4294967295' pin='4294967295' />
			<data name='FK2D9' port='4294967295' pin='4294967295' />
			<data name='FK2D10' port='4294967295' pin='4294967295' />
			<data name='FK2D11' port='4294967295' pin='4294967295' />
			<data name='FK2D12' port='4294967295' pin='4294967295' />
			<data name='FK2D13' port='4294967295' pin='4294967295' />
			<data name='FK2D14' port='4294967295' pin='4294967295' />
			<data name='FK2D15' port='4294967295' pin='4294967295' />
			<data name='FK2A0' port='4294967295' pin='4294967295' />
			<data name='FK2A1' port='4294967295' pin='4294967295' />
			<data name='FK2A2' port='4294967295' pin='4294967295' />
			<data name='FK2A3' port='4294967295' pin='4294967295' />
			<data name='FK2A4' port='4294967295' pin='4294967295' />
			<data name='FK2A5' port='4294967295' pin='4294967295' />
		</FK2>
		<ICD >
			<data name='AnalogPrescaleValue' value='19' />
			<data name='DigitalSampleRate' value='100000' />
			<data name='BreakpointCount' value='8' />
			<data name='CallStackDepthCount' value='8' />
			<data name='ClockPort' value='1' />
			<data name='ClockPin' value='6' />
			<data name='DataPort' value='1' />
			<data name='DataPin' value='7' />
			<data name='UseDefaultPins' value='1' />
			<data name='WrapEnabled' value='1' />
			<data name='CommsDelayOverridden' value='0' />
			<data name='CommsDelay' value='9' />
			<data name='CalculatedCommsDelay' value='9' />
			<data name='AnalogEB2PrescaleValue' value='2' />
			<data name='DigitalEB2SampleRate' value='100000' />
		</ICD>
		<pins >
			<digital A='0' B='0' C='0' D='0' E='0' F='0' G='0' H='0' I='0' J='0' K='0' L='0' M='0' N='0' O='0' P='0' Q='0' R='0' S='0' T='0' U='0' V='0' W='0' X='0' Y='0' Z='0' />
			<analog A='0' B='0' C='0' D='0' E='0' F='0' G='0' H='0' I='0' J='0' K='0' L='0' M='0' N='0' O='0' P='0' Q='0' R='0' S='0' T='0' U='0' V='0' W='0' X='0' Y='0' Z='0' />
		</pins>
	</ghost>
	<components >
		<settings autoimg='0' center='1' unitscale='0' fixedscale='0' fixedx='1' fixedy='1' fixedz='1' headcode='0' />
		<definition guid='8aab4b54-a912-449c-b11a-7c1a5db8d591' vstate='40' vmin='2' vmaj='2' srcleaf='TCPIP_ENC28J60.fcfx' visiblename='TCP/IP (ENC28J60)' description='A set of routines used to control a ENC28J60 TCP/IP Module.
Required connections VCC, Reset, GND, SCK, MISO, MOSI, CS.
Leave these pins disconnected CLKOUT, ENC_WOL, ENC_INT' category='Comms: Networking' category2='' category3='' bIs2dOnly='1' bIs3dOnly='0' catenable='1' author='Matrix TSL' manuname='Microchip' manucode='' sysinfo='17830731' keywords='' dynamic='1' scadaCompatible='0' embeddedCompatible='1' showmacros='1' iconpath='..\..\Icons\Components\TCP_IP.png' />
		<component class_type='root' codename='TCPIP_ENC28J60' panelId='-1' x='0' y='0' z='0' xsz='1' ysz='1' zsz='1' xang='0' yang='0' zang='0' xquat='0' yquat='0' zquat='0' wquat='1' visible='1' scadavisible='1' interactive='1' solid='1' layer='0' poslock='0' comp2dType='0' >
			<resources />
			<properties >
				<property name='TCP IP Specifics' folder='property_4' hidden='0' >
					<property name='Server Port' target='Port' typeid='21' hidden='0' locked='0' info='Sets the server&apos;s TCP/IP port address which is used to filter incoming TCP packets.' />
					<property name='Buffer Size' target='BufferSize' typeid='21' hidden='0' locked='0' info='Number of bytes to use for the transmit and receive buffer, we actually use this +1 to allow for a null termination.
8-bit PICs should set this to 255 to allow compilation to succeed.
Other devices can have larger buffers.
Default = 500' />
				</property>
				<property name='SPI Settings' folder='property_3' hidden='0' >
					<property name='Channel' target='cal_spi::CHANNEL' typeid='16' hidden='0' locked='0' info='SPI Channel selector' filter='000Software
001Channel 1
' />
					<property name='Prescale' target='cal_spi::PR_SCALE' typeid='16' hidden='0' locked='0' info='Prescale option selector' filter='004Fosc/4
016Fosc/16
064Fosc/64' />
					<property name='MOSI' target='cal_spi::MOSI' typeid='5' hidden='0' locked='1' info='SPI Data Out Pin SDO - Also Known as Master Out Slave In (MOSI) when used in Master mode.' />
					<property name='MOSI Remap Pin' target='cal_spi::MOSIPins' typeid='16' hidden='1' locked='0' info='Select which the target pin to assign the MOSI hardware pin functionality.' filter='000$PORTE.5
001$PORTE.7
002$PORTG.6
003$PORTG.8
004$PORTF.4
005$PORTF.5
006$PORTF.3
007$PORTD.0
008$PORTD.1
009$PORTD.2
010$PORTD.3
011$PORTD.4
012$PORTD.5
013$PORTD.6
014$PORTD.7
015$PORTF.0
016$PORTF.1
017$PORTE.0
018$PORTE.2
019$PORTE.4' />
					<property name='MISO' target='cal_spi::MISO' typeid='5' hidden='0' locked='1' info='SPI Data In Pin SDI - Also Known as Master In Slave Out (MISO) when used in Master mode.' />
					<property name='MISO Remap Pin' target='cal_spi::MISOPins' typeid='16' hidden='1' locked='0' info='Select which the target pin to assign the MISO hardware pin functionality.' filter='085$PORTE.5
086$PORTE.6
087$PORTE.7
118$PORTG.6
119$PORTG.7
120$PORTG.8
121$PORTG.9
037$PORTB.5
036$PORTB.4
035$PORTB.3
034$PORTB.2
033$PORTB.1
032$PORTB.0
038$PORTB.6
039$PORTB.7
040$PORTB.8
041$PORTB.9
042$PORTB.10
043$PORTB.11
044$PORTB.12
045$PORTB.13
046$PORTB.14
047$PORTB.15
100$PORTF.4
101$PORTF.5
099$PORTF.3
060$PORTC.12
072$PORTD.8
073$PORTD.9
074$PORTD.10
075$PORTD.11
064$PORTD.0
061$PORTC.13
062$PORTC.14
065$PORTD.1
066$PORTD.2
067$PORTD.3
068$PORTD.4
069$PORTD.5
070$PORTD.6
071$PORTD.7
096$PORTF.0
097$PORTF.1
080$PORTE.0
081$PORTE.1
082$PORTE.2
083$PORTE.3
084$PORTE.4' />
					<property name='CLK' target='cal_spi::CLK' typeid='5' hidden='0' locked='1' info='SPI Clock Pin CLK - The Clock signal is driven by the SPI master.' />
					<property name='CLK Remap Pin' target='cal_spi::CLKPins' typeid='16' hidden='1' locked='0' info='Select which the target pin to assign the CLK hardware pin functionality.' filter='000$PORTE.5
001$PORTE.7
002$PORTG.6
003$PORTG.8
004$PORTF.4
005$PORTF.5
006$PORTF.3
007$PORTD.0
008$PORTD.1
009$PORTD.2
010$PORTD.3
011$PORTD.4
012$PORTD.5
013$PORTD.6
014$PORTD.7
015$PORTF.0
016$PORTF.1
017$PORTE.0
018$PORTE.2
019$PORTE.4' />
					<property name='CS / SS' target='cal_spi::SS' typeid='5' hidden='0' locked='0' info='Chip Select / Slave Select Pin 
Master Mode: General purpose output pin used to select the remote SPI device.
Slave Mode: Hardware chip select pin input used to select the SPI device.
' />
					<property name='Reset Pin' target='ResetPin' typeid='5' hidden='0' locked='0' info='' />
				</property>
				<property name='MAC Address' folder='property_1' hidden='0' >
					<property name='MAC0' target='MAC0' typeid='21' hidden='0' locked='0' info='' />
					<property name='MAC1' target='MAC1' typeid='21' hidden='0' locked='0' info='' />
					<property name='MAC2' target='MAC2' typeid='21' hidden='0' locked='0' info='' />
					<property name='MAC3' target='MAC3' typeid='21' hidden='0' locked='0' info='' />
					<property name='MAC4' target='MAC4' typeid='21' hidden='0' locked='0' info='' />
					<property name='MAC5' target='MAC5' typeid='21' hidden='0' locked='0' info='' />
				</property>
				<property name='IP Address' folder='property_2' hidden='0' >
					<property name='IP0' target='IP0' typeid='21' hidden='0' locked='0' info='' />
					<property name='IP1' target='IP1' typeid='21' hidden='0' locked='0' info='' />
					<property name='IP2' target='IP2' typeid='21' hidden='0' locked='0' info='' />
					<property name='IP3' target='IP3' typeid='21' hidden='0' locked='0' info='' />
				</property>
				<property name='Simulation' folder='property_5' hidden='0' >
					<property name='Label' target='label' typeid='10' hidden='0' locked='0' info='' />
					<property name='Sim Type' target='SimType' typeid='16' hidden='0' locked='0' info='Decides how to perform the simulation of the component.
TCP IP - Communicates using the Windows TCP IP communications DLL
SPI / API - Communicates using the CAL SPI to allow the communications to be analysed and debugged.' filter='000TCP IP - N/A
001SPI / API' />
					<property name='SPI Simulation' folder='property_6' hidden='0' >
						<property name='Scope Traces' target='cal_spi::ScopeTraces' typeid='7' hidden='0' locked='0' info='Selects if the scope traces are automatically generated or not' />
						<property name='Console Data' target='cal_spi::ConsoleData' typeid='7' hidden='0' locked='0' info='Selects if the console data is automatically generated or not' />
						<property name='API' target='cal_spi::Injector' typeid='16' hidden='0' locked='0' info='' filter='000' />
						<property name='API CS Pin' target='cal_spi1::InjectorCS' typeid='21' hidden='1' locked='0' info='' />
					</property>
					<property name='TCP Simulation' folder='property_7' hidden='1' >
						<property name='Network Interface' target='TCP_Base1::interface' typeid='16' hidden='0' locked='0' info='List of network interfaces connected to the PC. 
Sets which interface we are communicating via.' filter='0000
255AutoDetect' />
					</property>
				</property>
				<property name='RemapIndex' target='RemapIndex' typeid='21' hidden='1' locked='0' info='' />
			</properties>
			<values >
				<value target='Port' data='80' />
				<value target='BufferSize' data='500' />
				<value target='cal_spi::CHANNEL' data='001' />
				<value target='cal_spi::PR_SCALE' data='004' />
				<value target='cal_spi::MOSI' data='$PORTC.5' />
				<value target='cal_spi::MOSIPins' data='013' />
				<value target='cal_spi::MISO' data='$PORTC.4' />
				<value target='cal_spi::MISOPins' data='065' />
				<value target='cal_spi::CLK' data='$PORTC.3' />
				<value target='cal_spi::CLKPins' data='009' />
				<value target='cal_spi::SS' data='$PORTC.2' />
				<value target='ResetPin' data='$PORTC.1' />
				<value target='MAC0' data='100' />
				<value target='MAC1' data='101' />
				<value target='MAC2' data='102' />
				<value target='MAC3' data='103' />
				<value target='MAC4' data='104' />
				<value target='MAC5' data='105' />
				<value target='IP0' data='192' />
				<value target='IP1' data='168' />
				<value target='IP2' data='1' />
				<value target='IP3' data='90' />
				<value target='label' data='ENC28J60' />
				<value target='SimType' data='1' />
				<value target='cal_spi::ScopeTraces' data='1' />
				<value target='cal_spi::ConsoleData' data='1' />
				<value target='cal_spi::Injector' data='000' />
				<value target='cal_spi1::InjectorCS' data='' />
				<value target='TCP_Base1::interface' data='0' />
				<value target='RemapIndex' data='4' />
			</values>
			<events >
				<event class='Components' event='Renamed' target='Ev_Renamed' />
				<event class='Components' event='Property' target='Ev_Property' />
				<event class='Compile' event='GetVarSize' target='Ev_GetVarSize' />
				<event class='Components' event='Initialise' target='Ev_Initialise' />
			</events>
			<apis >
				<api name='SetMyIPAddress' alt='SetMyIPAddress' type='1' proto='1' />
				<api name='PacketSend' alt='PacketSend' type='1' proto='1' />
				<api name='MakeTcpSynackFromSyn' alt='MakeTcpSynackFromSyn' type='1' proto='1' />
				<api name='MakeArpRequest' alt='MakeArpRequest' type='1' proto='1' />
				<api name='InitialiseDataLengthInfo' alt='InitialiseDataLengthInfo' type='1' proto='1' />
				<api name='MakeTcpAckFromAny' alt='MakeTcpAckFromAny' type='1' proto='1' />
				<api name='PacketReceive' alt='PacketReceive' type='1' proto='1' />
				<api name='CheckForTCPType' alt='CheckForTCPType' type='1' proto='1' />
				<api name='CheckArpPacketIsMyreplyArp' alt='CheckArpPacketIsMyreplyArp' type='1' proto='1' />
				<api name='CheckForIp' alt='CheckForIp' type='1' proto='1' />
				<api name='CheckForTCPPort' alt='CheckForTCPPort' type='1' proto='1' />
				<api name='CheckForPing' alt='CheckForPing' type='1' proto='1' />
				<api name='GetModuleRevision' alt='GetModuleRevision' type='1' proto='1' />
				<api name='MakeTcpAckWithData' alt='MakeTcpAckWithData' type='1' proto='1' />
				<api name='SetMyMACAddress' alt='SetMyMACAddress' type='1' proto='1' />
				<api name='MakeArpAnswerFromRequest' alt='MakeArpAnswerFromRequest' type='1' proto='1' />
				<api name='ReadArrayFromBuffer' alt='ReadArrayFromBuffer' type='1' proto='1' />
				<api name='ReadRegister' alt='ReadRegister' type='1' proto='1' />
				<api name='CheckForARP' alt='CheckForARP' type='1' proto='1' />
				<api name='ClientSendPacket' alt='ClientSendPacket' type='1' proto='1' />
				<api name='MakeEchoReplyFromRequest' alt='MakeEchoReplyFromRequest' type='1' proto='1' />
				<api name='ControlLEDs' alt='ControlLEDs' type='1' proto='1' />
				<api name='GetDataLength' alt='GetDataLength' type='1' proto='1' />
				<api name='GetTcpDataPointer' alt='GetTcpDataPointer' type='1' proto='1' />
				<api name='WriteRegister' alt='WriteRegister' type='1' proto='1' />
				<api name='FillTcpData' alt='FillTcpData' type='1' proto='1' />
				<api name='ReadStringFromBuffer' alt='ReadStringFromBuffer' type='1' proto='1' />
				<api name='GetSendersMAC' alt='GetSendersMAC' type='1' proto='1' />
				<api name='FillTcpArray' alt='FillTcpArray' type='1' proto='1' />
				<api name='Initialise' alt='Initialise' type='1' proto='1' />
			</apis>
			<variables >
				<variable public='0' >
					<def class_type='variable' name='MyMAC' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
						<array size='6' />
					</def>
				</variable>
				<variable public='0' >
					<def class_type='variable' name='info_hdr_len' type='s16' description='' isconst='0' isHidden='0' isinit='1' usrinit='0' setinit='0' />
				</variable>
				<variable public='0' >
					<def class_type='variable' name='false' type='b1' description='' isconst='1' isHidden='0' isinit='1' usrinit='0' setinit='0' />
				</variable>
				<variable public='0' >
					<def class_type='variable' name='Enc28j60Bank' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
				</variable>
				<variable public='0' >
					<def class_type='variable' name='info_data_len' type='s16' description='' isconst='0' isHidden='0' isinit='1' usrinit='0' setinit='0' />
				</variable>
				<variable public='0' >
					<def class_type='variable' name='MyIP' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
						<array size='4' />
					</def>
				</variable>
				<variable public='0' >
					<def class_type='variable' name='Buffer' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
						<array size='501' />
					</def>
				</variable>
				<variable public='0' >
					<def class_type='variable' name='IP_Identifier' type='u16' description='' isconst='0' isHidden='0' isinit='1' usrinit='1' setinit='1' />
				</variable>
				<variable public='0' >
					<def class_type='variable' name='SeqNum' type='u8' description='' isconst='0' isHidden='0' isinit='1' usrinit='10' setinit='0x0A' />
				</variable>
				<variable public='0' >
					<def class_type='variable' name='BANK_MASK' type='s16' description='' isconst='1' isHidden='0' isinit='1' usrinit='96' setinit='0x60' />
				</variable>
				<variable public='0' >
					<def class_type='variable' name='NextPacketPtr' type='u16' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
				</variable>
				<variable public='0' >
					<def class_type='variable' name='true' type='b1' description='' isconst='1' isHidden='0' isinit='1' usrinit='1' setinit='1' />
				</variable>
				<variable public='0' >
					<def class_type='variable' name='ADDR_MASK' type='s16' description='' isconst='1' isHidden='0' isinit='1' usrinit='31' setinit='0x1F' />
				</variable>
			</variables>
			<macros >
				<macro >
					<flowline name='EncPhyWrite' description='' statediag='0' >
						<return name='Return' type='v0' description='' isconst='0' isHidden='0' isinit='0' usrinit='' setinit='' />
						<param name='Address' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='Data' type='u16' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='retval' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='Timeout' type='u16' description='' isconst='0' isHidden='0' isinit='1' usrinit='9999' setinit='9999' />
						<command class_type='call' title='PHY register address' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='WriteRegister' >
							<argument exp='0xD4' />
							<argument exp='.Address' />
						</command>
						<command class_type='call' title='PHY data' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='WriteRegister' >
							<argument exp='0xD6' />
							<argument exp='.Data' />
						</command>
						<command class_type='call' title='PHY data' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='WriteRegister' >
							<argument exp='0xD7' />
							<argument exp='.Data &gt;&gt; 8' />
						</command>
						<command class_type='loop' title='wait until the PHY write completes' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' type='0' exp='.retval &amp; 0x01' start='0' >
							<flowline >
								<command class_type='delay' title='Delay' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' exp='15' type='0' />
								<command class_type='call' title='Call Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='ReadRegister' >
									<return exp='.retval' />
									<argument exp='0xCA' />
								</command>
								<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='.Timeout = .Timeout - 1' />
								</command>
								<command class_type='decision' title='Decision' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='.Timeout = 0' swap='0' >
									<flowline >
										<command class_type='comment' title='' comment='Don&apos;t block forever if no reply' textarea='12,0,12,0' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' />
										<command class_type='goto' title='Goto Connection Point' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' labelid='0' labelname='' />
									</flowline>
									<flowline />
								</command>
							</flowline>
						</command>
						<command class_type='label' title='Connection Point' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' labelid='0' labelname='A' />
					</flowline>
				</macro>
				<macro >
					<flowline name='EncSetBank' description='' statediag='0' >
						<return name='Return' type='v0' description='' isconst='0' isHidden='0' isinit='0' usrinit='' setinit='' />
						<param name='Address' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<command class_type='decision' title='Decision' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='(.Address &amp; BANK_MASK) != Enc28j60Bank' swap='0' >
							<flowline >
								<command class_type='call' title='Call Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='EncWriteOp' >
									<argument exp='0xA0' />
									<argument exp='0x1F' />
									<argument exp='0x03' />
								</command>
								<command class_type='call' title='Call Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='EncWriteOp' >
									<argument exp='0x80' />
									<argument exp='0x1F' />
									<argument exp='(.Address &amp; BANK_MASK) &gt;&gt; 5' />
								</command>
								<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='Enc28j60Bank = (.Address &amp; BANK_MASK)' />
								</command>
							</flowline>
							<flowline />
						</command>
					</flowline>
				</macro>
				<macro >
					<flowline name='IpMakeTcpHead' description='' statediag='0' >
						<return name='Return' type='v0' description='' isconst='0' isHidden='0' isinit='0' usrinit='' setinit='' />
						<param name='RelAckNum' type='u16' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='Mss' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='CpSeq' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='Port' type='u16' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='idx' type='u8' description='' isconst='0' isHidden='0' isinit='1' usrinit='4' setinit='4' />
						<local name='tseq' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<command class_type='calculation' title='Set Source and Destination Ports' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[0x24] = Buffer[0x22]' />
							<exp exp='Buffer[0x25] = Buffer[0x23]' />
							<exp exp='' />
							<exp exp='Buffer[0x22] = .Port &gt;&gt; 8' />
							<exp exp='Buffer[0x23] = .Port' />
						</command>
						<command class_type='loop' title='Loop' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' type='0' exp='.idx &gt; 0' >
							<flowline >
								<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='.RelAckNum = Buffer[0x26 + .idx - 1] + .RelAckNum' />
								</command>
								<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='.tseq = Buffer[0x2A + .idx - 1]' />
								</command>
								<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='Buffer[0x2A + .idx - 1] = .RelAckNum' />
								</command>
								<command class_type='decision' title='Decision' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='.CpSeq' swap='0' >
									<flowline >
										<command class_type='calculation' title='copy the acknum sent to us into the sequence number' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
											<exp exp='Buffer[0x26 + .idx - 1] = .tseq' />
										</command>
									</flowline>
									<flowline >
										<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
											<exp exp='Buffer[0x26 + .idx - 1] = 0' />
										</command>
									</flowline>
								</command>
								<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='.RelAckNum = .RelAckNum &gt;&gt; 8' />
								</command>
								<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='.idx = .idx - 1' />
								</command>
							</flowline>
						</command>
						<command class_type='decision' title='Decision' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='.CpSeq = 0' swap='0' >
							<flowline >
								<command class_type='calculation' title='put inital seq number' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='Buffer[0x26] = 0' />
									<exp exp='Buffer[0x27] = 0' />
								</command>
								<command class_type='calculation' title='' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='Buffer[0x28] = SeqNum' />
									<exp exp='Buffer[0x29] = 0' />
								</command>
								<command class_type='calculation' title='' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='SeqNum = SeqNum + 2' />
								</command>
							</flowline>
							<flowline />
						</command>
						<command class_type='calculation' title='zero the checksum' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[0x32] = 0' />
							<exp exp='Buffer[0x33] = 0' />
						</command>
						<command class_type='decision' title='Decision' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='.Mss' swap='0' >
							<flowline >
								<command class_type='calculation' title='the only option we set is MSS to 1408:' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='Buffer[0x36] = 2' />
									<exp exp='Buffer[0x37] = 4' />
									<exp exp='Buffer[0x38] = 5' />
									<exp exp='Buffer[0x39] = 0x80' />
									<exp exp='' />
									<exp exp='Buffer[0x2E] = 0x60' />
								</command>
							</flowline>
							<flowline >
								<command class_type='calculation' title='no options:' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='Buffer[0x2E] = 0x50' />
								</command>
							</flowline>
						</command>
					</flowline>
				</macro>
				<macro >
					<flowline name='EncClockOut' description='' statediag='0' >
						<return name='Return' type='v0' description='' isconst='0' isHidden='0' isinit='0' usrinit='' setinit='' />
						<param name='Clk' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<command class_type='call' title='Call Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='WriteRegister' >
							<argument exp='0x75' />
							<argument exp='.Clk &amp; 0x07' />
						</command>
					</flowline>
				</macro>
				<macro >
					<flowline name='SetMyIPAddress' description='Allows the IP Address specified in the component properties to be overridden.
The IP Address will revert back to the IP specified in the component properties as part of the initialise macro.' statediag='0' >
						<return name='Return' type='v0' description='' isconst='0' isHidden='0' isinit='0' usrinit='' setinit='' />
						<param name='IP0' type='u8' description='IP Address Parameter - e.g. 192' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='IP1' type='u8' description='IP Address Parameter - e.g. 168' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='IP2' type='u8' description='IP Address Parameter - e.g. 1' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='IP3' type='u8' description='IP Address Parameter - e.g. 250' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='MyIp[0] = .IP0' />
							<exp exp='MyIp[1] = .IP1' />
							<exp exp='MyIp[2] = .IP2' />
							<exp exp='MyIp[3] = .IP3' />
						</command>
					</flowline>
				</macro>
				<macro >
					<flowline name='PopulateInjectorFilter' description='' statediag='0' >
						<return name='Return' type='v0' description='' isconst='0' isHidden='0' isinit='0' usrinit='' setinit='' />
						<local name='ObjHandle' type='h32' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='RootHandle' type='h32' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='OldHandle' type='h32' description='' isconst='0' isHidden='0' isinit='1' usrinit='0' setinit='0' />
						<local name='ObjName' type='T8' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='20' />
						</local>
						<local name='CmpName' type='T8' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='20' />
						</local>
						<local name='CmpStr' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='Index' type='u8' description='' isconst='0' isHidden='0' isinit='1' usrinit='0' setinit='0' />
						<command class_type='sim' title='Call Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='Component.Property.SetFilter' >
							<argument exp='this' />
							<argument exp='&quot;Injector&quot;' />
							<argument exp='&quot;&quot;' />
						</command>
						<command class_type='sim' title='Call Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='Component.GetParent' >
							<return exp='.ObjHandle' />
							<argument exp='this' />
						</command>
						<command class_type='sim' title='Call Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='Tree.GetCopy' >
							<return exp='.RootHandle' />
							<argument exp='.ObjHandle' />
						</command>
						<command class_type='loop' title='Loop' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' type='0' exp='.OldHandle != .ObjHandle' >
							<flowline >
								<command class_type='sim' title='Call Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='Tree.GetCopy' >
									<return exp='.OldHandle' />
									<argument exp='.ObjHandle' />
								</command>
								<command class_type='sim' title='Call Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='Tree.GetName' >
									<return exp='.ObjName' />
									<argument exp='.ObjHandle' />
								</command>
								<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='.CmpName = Left$ (.ObjName,8)' />
								</command>
								<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='.CmpStr = Compare$ (.CmpName,&quot;Injector&quot;,0)' />
								</command>
								<command class_type='decision' title='Decision' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='.CmpStr = 0' swap='0' >
									<flowline >
										<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
											<exp exp='.CmpName = Left$ (.ObjName,12)' />
										</command>
										<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
											<exp exp='.CmpStr = Compare$ (.CmpName,&quot;InjectorBase&quot;,0)' />
										</command>
										<command class_type='decision' title='Decision' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='.CmpStr &gt; 0' swap='0' >
											<flowline >
												<command class_type='sim' title='Call Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='Component.Property.AddListItem' >
													<argument exp='this' />
													<argument exp='&quot;Injector&quot;' />
													<argument exp='.Index' />
													<argument exp='.ObjName' />
												</command>
												<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
													<exp exp='.Index = .Index + 1' />
												</command>
											</flowline>
											<flowline />
										</command>
									</flowline>
									<flowline />
								</command>
								<command class_type='sim' title='Call Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='Tree.Traverse' >
									<argument exp='.ObjHandle' />
									<argument exp='.RootHandle' />
								</command>
							</flowline>
						</command>
					</flowline>
				</macro>
				<macro >
					<flowline name='PacketSend' description='Attempts to transmit a data packet to the ENC28J60 module.' statediag='0' >
						<return name='Return' type='v0' description='' isconst='0' isHidden='0' isinit='0' usrinit='' setinit='' />
						<param name='Length' type='u16' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='EndPointer' type='u16' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='retval' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<command class_type='call' title='Set the write pointer to start of transmit buffer area' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='WriteRegister' >
							<argument exp='0x02' />
							<argument exp='0x00' />
						</command>
						<command class_type='call' title='Set the write pointer to start of transmit buffer area' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='WriteRegister' >
							<argument exp='0x03' />
							<argument exp='0x1A' />
						</command>
						<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='.EndPointer = 0x1A00 + .Length' />
						</command>
						<command class_type='decision' title='Decision' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='.EndPointer &gt; 0x1FFF' swap='0' >
							<flowline >
								<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='.EndPointer = 0x1FFF' />
								</command>
							</flowline>
							<flowline />
						</command>
						<command class_type='call' title='Set the TXND pointer to correspond to the packet size given' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='WriteRegister' >
							<argument exp='0x06' />
							<argument exp='.EndPointer' />
						</command>
						<command class_type='call' title='Set the TXND pointer to correspond to the packet size given' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='WriteRegister' >
							<argument exp='0x07' />
							<argument exp='.EndPointer &gt;&gt; 8' />
						</command>
						<command class_type='call' title='write per-packet control byte (0x00 means use macon3 settings)' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='EncWriteOp' >
							<argument exp='0x7A' />
							<argument exp='0' />
							<argument exp='0' />
						</command>
						<command class_type='call' title='copy the packet into the transmit buffer' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='EncWriteBuffer' >
							<argument exp='.Length' />
						</command>
						<command class_type='call' title='send the contents of the transmit buffer onto the network' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='EncWriteOp' >
							<argument exp='0x80' />
							<argument exp='0x1F' />
							<argument exp='0x08' />
						</command>
						<command class_type='call' title='Reset the transmit logic problem. See Rev. B4 Silicon Errata poi' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='ReadRegister' >
							<return exp='.retval' />
							<argument exp='0x1C' />
						</command>
						<command class_type='decision' title='Decision' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='.retval &amp; 0x02' swap='0' >
							<flowline >
								<command class_type='call' title='Call Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='EncWriteOp' >
									<argument exp='0xA0' />
									<argument exp='0x1F' />
									<argument exp='0x08' />
								</command>
							</flowline>
							<flowline />
						</command>
					</flowline>
				</macro>
				<macro >
					<flowline name='IpMakeEth' description='' statediag='0' >
						<return name='Return' type='v0' description='' isconst='0' isHidden='0' isinit='0' usrinit='' setinit='' />
						<command class_type='calculation' title='copy the destination mac from the source' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[0] = Buffer[6]' />
							<exp exp='Buffer[1] = Buffer[7]' />
							<exp exp='Buffer[2] = Buffer[8]' />
							<exp exp='Buffer[3] = Buffer[9]' />
							<exp exp='Buffer[4] = Buffer[10]' />
							<exp exp='Buffer[5] = Buffer[11]' />
						</command>
						<command class_type='calculation' title='fill my mac into src' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[6] = MyMac[0]' />
							<exp exp='Buffer[7] = MyMac[1]' />
							<exp exp='Buffer[8] = MyMac[2]' />
							<exp exp='Buffer[9] = MyMac[3]' />
							<exp exp='Buffer[10] = MyMac[4]' />
							<exp exp='Buffer[11] = MyMac[5]' />
						</command>
					</flowline>
				</macro>
				<macro >
					<flowline name='MakeTcpSynackFromSyn' description='' statediag='0' >
						<return name='Return' type='v0' description='' isconst='0' isHidden='0' isinit='0' usrinit='' setinit='' />
						<param name='Port' type='u16' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='ck' type='u16' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<command class_type='call' title='Call Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='IpMakeEth' />
						<command class_type='calculation' title='total length field in the IP header' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[0x10] = 0' />
							<exp exp='Buffer[0x11] = 44' />
						</command>
						<command class_type='call' title='Call Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='IpMakeIp' />
						<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[0x2F] = 0x12' />
						</command>
						<command class_type='call' title='Call Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='IpMakeTcpHead' >
							<argument exp='1' />
							<argument exp='1' />
							<argument exp='0' />
							<argument exp='.Port' />
						</command>
						<command class_type='call' title='Calculate the checksum' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='IpChecksum' >
							<return exp='.ck' />
							<argument exp='0x1A' />
							<argument exp='32' />
							<argument exp='2' />
						</command>
						<command class_type='calculation' title='Assign checksum' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[0x32] = .ck &gt;&gt; 8' />
							<exp exp='Buffer[0x33] = .ck' />
						</command>
						<command class_type='call' title='add 4 for option mss:' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='PacketSend' >
							<argument exp='58' />
						</command>
					</flowline>
				</macro>
				<macro >
					<flowline name='CheckForSynAck' description='Checks for a SYNACK flag in the received buffer' statediag='0' >
						<return name='Return' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<command class_type='decision' title='Decision' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='Buffer[0x2F] == 0x12' swap='0' >
							<flowline >
								<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='.Return = 1' />
								</command>
							</flowline>
							<flowline >
								<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='.Return = 0' />
								</command>
							</flowline>
						</command>
					</flowline>
				</macro>
				<macro >
					<flowline name='Ev_Initialise' description='Initialisation routine for the component once the component is linked to its parent' statediag='0' >
						<return name='Return' type='u32' description='Non-zero to prevent initialisation' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='tempstr' type='T8' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='20' />
						</local>
					</flowline>
				</macro>
				<macro >
					<flowline name='IpInitIpArpUdpTcp' description='' statediag='0' >
						<return name='Return' type='v0' description='' isconst='0' isHidden='0' isinit='0' usrinit='' setinit='' />
					</flowline>
				</macro>
				<macro >
					<flowline name='MakeArpRequest' description='' statediag='0' >
						<return name='Return' type='v0' description='' isconst='0' isHidden='0' isinit='0' usrinit='' setinit='' />
						<param name='ServerIP' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='4' />
						</param>
						<local name='idx' type='u8' description='' isconst='0' isHidden='0' isinit='1' usrinit='0' setinit='0' />
						<command class_type='loop' title='Loop' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' type='0' exp='.idx &lt; 6' >
							<flowline >
								<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='Buffer[0 + .idx] = 0xFF' />
								</command>
								<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='.idx = .idx + 1' />
								</command>
							</flowline>
						</command>
						<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[6] = MyMac[0]' />
							<exp exp='Buffer[7] = MyMac[1]' />
							<exp exp='Buffer[8] = MyMac[2]' />
							<exp exp='Buffer[9] = MyMac[3]' />
							<exp exp='Buffer[10] = MyMac[4]' />
							<exp exp='Buffer[11] = MyMac[5]' />
						</command>
						<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[12] = 0x08' />
							<exp exp='Buffer[13] = 0x06' />
						</command>
						<command class_type='calculation' title='Generate ARP Packet' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[0x14] = 0x00' />
							<exp exp='Buffer[0x15] = 0x01' />
						</command>
						<command class_type='calculation' title='setup hardware type to ethernet 0x0001' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[0x0E] = 0x00' />
							<exp exp='Buffer[0x0F] = 0x01' />
						</command>
						<command class_type='calculation' title='setup protocol type to ip 0x0800' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[0x10] = 0x08' />
							<exp exp='Buffer[0x11] = 0x00' />
						</command>
						<command class_type='calculation' title='setup hardware length to 0x06' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[0x12] = 0x06' />
							<exp exp='' />
						</command>
						<command class_type='calculation' title='setup protocol length to 0x04' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[0x13] = 0x04' />
							<exp exp='' />
						</command>
						<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='.idx = 0' />
						</command>
						<command class_type='loop' title='Loop' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' type='0' exp='.idx &lt; 6' >
							<flowline >
								<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='Buffer[0x20 + .idx] = 0' />
								</command>
								<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='.idx = .idx + 1' />
								</command>
							</flowline>
						</command>
						<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[0x16] = MyMac[0]' />
							<exp exp='Buffer[0x17] = MyMac[1]' />
							<exp exp='Buffer[0x18] = MyMac[2]' />
							<exp exp='Buffer[0x19] = MyMac[3]' />
							<exp exp='Buffer[0x1A] = MyMac[4]' />
							<exp exp='Buffer[0x1B] = MyMac[5]' />
						</command>
						<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='.idx = 0' />
						</command>
						<command class_type='loop' title='Loop' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' type='0' exp='.idx &lt; 4' >
							<flowline >
								<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='Buffer[0x26 + .idx] = .ServerIP[.idx]' />
								</command>
								<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='.idx = .idx + 1' />
								</command>
							</flowline>
						</command>
						<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[0x1C] = MyIp[0]' />
							<exp exp='Buffer[0x1D] = MyIp[1]' />
							<exp exp='Buffer[0x1E] = MyIp[2]' />
							<exp exp='Buffer[0x1F] = MyIp[3]' />
							<exp exp='' />
						</command>
						<command class_type='call' title='eth+arp is 42 bytes:' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='PacketSend' >
							<argument exp='42' />
						</command>
					</flowline>
				</macro>
				<macro >
					<flowline name='InitialiseDataLengthInfo' description='Initialises the data pointers to allow us to craft a response containing data' statediag='0' >
						<return name='Return' type='v0' description='' isconst='0' isHidden='0' isinit='0' usrinit='' setinit='' />
						<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='info_data_len = (Buffer[0x10] &lt;&lt; 8) | Buffer[0x11]' />
						</command>
						<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='info_data_len = info_data_len - 20' />
						</command>
						<command class_type='calculation' title='generate len in bytes' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='info_hdr_len = (Buffer[0x2E] &gt;&gt; 4) * 4' />
						</command>
						<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='info_data_len = info_data_len - info_hdr_len' />
						</command>
						<command class_type='decision' title='Decision' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='info_data_len &lt;= 0' swap='0' >
							<flowline >
								<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='info_data_len = 0' />
								</command>
							</flowline>
							<flowline />
						</command>
					</flowline>
				</macro>
				<macro >
					<flowline name='MakeTcpAckFromAny' description='' statediag='0' >
						<return name='Return' type='v0' description='' isconst='0' isHidden='0' isinit='0' usrinit='' setinit='' />
						<param name='Port' type='u16' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='ck' type='u16' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='idx' type='u8' description='' isconst='0' isHidden='0' isinit='1' usrinit='0' setinit='0' />
						<local name='SubBuff' type='T8' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='28' />
						</local>
						<command class_type='call' title='Call Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='IpMakeEth' />
						<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[0x2F] = 0x10' />
						</command>
						<command class_type='decision' title='Decision' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='info_data_len = 0' swap='0' >
							<flowline >
								<command class_type='call' title='Call Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='IpMakeTcpHead' >
									<argument exp='1' />
									<argument exp='0' />
									<argument exp='1' />
									<argument exp='.Port' />
								</command>
							</flowline>
							<flowline >
								<command class_type='call' title='Call Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='IpMakeTcpHead' >
									<argument exp='info_data_len' />
									<argument exp='0' />
									<argument exp='1' />
									<argument exp='.Port' />
								</command>
							</flowline>
						</command>
						<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[0x10] = 0' />
							<exp exp='Buffer[0x11] = 40' />
						</command>
						<command class_type='call' title='Call Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='IpMakeIp' />
						<command class_type='call' title='Calculate the checksum' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='IpChecksum' >
							<return exp='.ck' />
							<argument exp='0x1A' />
							<argument exp='28' />
							<argument exp='2' />
						</command>
						<command class_type='calculation' title='Assign checksum' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[0x32] = .ck &gt;&gt; 8' />
							<exp exp='Buffer[0x33] = .ck' />
						</command>
						<command class_type='call' title='' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='PacketSend' >
							<argument exp='54' />
						</command>
					</flowline>
				</macro>
				<macro >
					<flowline name='EncReadBuffer' description='' statediag='0' >
						<return name='Return' type='v0' description='' isconst='0' isHidden='0' isinit='0' usrinit='' setinit='' />
						<param name='Length' type='u16' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='Index' type='u16' description='' isconst='0' isHidden='0' isinit='1' usrinit='0' setinit='0' />
						<command class_type='sim' title='Component Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' component='LibraryComponent1' macro='FlashRx' />
						<command class_type='call' title='Call Component Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' component='cal_spi' macro='Master_Enable_CS' />
						<command class_type='call' title='ENC28J60_READ_BUF_MEM' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' component='cal_spi' macro='Master_Byte' >
							<argument exp='0x3A' />
						</command>
						<command class_type='loop' title='Loop' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' type='0' exp='.Index &lt; .Length' >
							<flowline >
								<command class_type='call' title='Call Component Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' component='cal_spi' macro='Master_Byte' >
									<return exp='Buffer[.Index]' />
									<argument exp='0x3A' />
								</command>
								<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='.Index = .Index + 1' />
								</command>
							</flowline>
						</command>
						<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[.Index] = 0' />
						</command>
						<command class_type='call' title='Call Component Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' component='cal_spi' macro='Master_Disable_CS' />
					</flowline>
				</macro>
				<macro >
					<flowline name='IpMakeIp' description='' statediag='0' >
						<return name='Return' type='v0' description='' isconst='0' isHidden='0' isinit='0' usrinit='' setinit='' />
						<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[0x1E] = Buffer[0x1A]' />
							<exp exp='Buffer[0x1F] = Buffer[0x1B]' />
							<exp exp='Buffer[0x20] = Buffer[0x1C]' />
							<exp exp='Buffer[0x21] = Buffer[0x1D]' />
						</command>
						<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[0x1A] = MyIp[0]' />
							<exp exp='Buffer[0x1B] = MyIp[1]' />
							<exp exp='Buffer[0x1C] = MyIp[2]' />
							<exp exp='Buffer[0x1D] = MyIp[3]' />
						</command>
						<command class_type='calculation' title='Dont fragment' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[0x14] = 0x40' />
							<exp exp='Buffer[0x15] = 0' />
						</command>
						<command class_type='calculation' title='set packet identification' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[0x12] = IP_Identifier &gt;&gt; 8' />
							<exp exp='Buffer[0x13] = IP_Identifier' />
							<exp exp='IP_Identifier = IP_Identifier + 1' />
						</command>
						<command class_type='call' title='Call Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='IpFillIpHdrChecksum' />
					</flowline>
				</macro>
				<macro >
					<flowline name='PacketReceive' description='Attempts to receive a data packet from the ENC28J60 module.
Returns the number of bytes received.' statediag='0' >
						<return name='Return' type='u16' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='RxStat' type='u16' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='Length' type='u16' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='RetVal' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='Retry' type='u8' description='' isconst='0' isHidden='0' isinit='1' usrinit='5' setinit='5' />
						<command class_type='label' title='Declare Connection Point' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' labelid='1' labelname='B' />
						<command class_type='call' title='check if a packet has been received and buffered' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='ReadRegister' >
							<return exp='.RetVal' />
							<argument exp='0x39' />
						</command>
						<command class_type='decision' title='Decision' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='.RetVal = 0' swap='0' >
							<flowline >
								<command class_type='decision' title='Decision' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='.Retry' swap='0' >
									<flowline >
										<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
											<exp exp='.Retry = .Retry - 1' />
										</command>
										<command class_type='goto' title='Goto Connection Point' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' labelid='1' labelname='' />
									</flowline>
									<flowline />
								</command>
								<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='.Return = 0' />
								</command>
								<command class_type='goto' title='Goto Connection Point' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' labelid='0' labelname='' />
							</flowline>
							<flowline />
						</command>
						<command class_type='call' title='Set the read pointer to the start of the received packet' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='WriteRegister' >
							<argument exp='0' />
							<argument exp='NextPacketPtr' />
						</command>
						<command class_type='call' title='Call Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='WriteRegister' >
							<argument exp='1' />
							<argument exp='NextPacketPtr &gt;&gt; 8' />
						</command>
						<command class_type='call' title='read the next packet pointer' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='EncReadOp' >
							<return exp='NextPacketPtr' />
							<argument exp='0x3A' />
							<argument exp='0' />
						</command>
						<command class_type='call' title='read the next packet pointer' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='EncReadOp' >
							<return exp='.RetVal' />
							<argument exp='0x3A' />
							<argument exp='0' />
						</command>
						<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='NextPacketPtr = NextPacketPtr | (.RetVal &lt;&lt; 8)' />
						</command>
						<command class_type='call' title='read the packet length' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='EncReadOp' >
							<return exp='.Length' />
							<argument exp='0x3A' />
							<argument exp='0' />
						</command>
						<command class_type='call' title='read the packet length' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='EncReadOp' >
							<return exp='.RetVal' />
							<argument exp='0x3A' />
							<argument exp='0' />
						</command>
						<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='.Length = .Length | (.RetVal &lt;&lt; 8)' />
							<exp exp='.Length = .Length - 4' />
						</command>
						<command class_type='call' title='read the receive status ' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='EncReadOp' >
							<return exp='.RxStat' />
							<argument exp='0x3A' />
							<argument exp='0' />
						</command>
						<command class_type='call' title='read the receive status ' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='EncReadOp' >
							<return exp='.RetVal' />
							<argument exp='0x3A' />
							<argument exp='0' />
						</command>
						<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='.RxStat = .RxStat | (.RetVal &lt;&lt; 8)' />
						</command>
						<command class_type='decision' title='Decision' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='.Length &gt; (BufferSize)' swap='0' >
							<flowline >
								<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='.Length = BufferSize' />
								</command>
							</flowline>
							<flowline />
						</command>
						<command class_type='decision' title='check CRC and symbol errors' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='(.RxStat &amp; 0x80) = 0' swap='0' >
							<flowline >
								<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='.Length = 0' />
								</command>
							</flowline>
							<flowline >
								<command class_type='call' title='Call Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='EncReadBuffer' >
									<argument exp='.Length' />
								</command>
							</flowline>
						</command>
						<command class_type='call' title='Move the RX read pointer to the start of the next received packe' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='WriteRegister' >
							<argument exp='0x0C' />
							<argument exp='NextPacketPtr' />
						</command>
						<command class_type='call' title='Move the RX read pointer to the start of the next received packe' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='WriteRegister' >
							<argument exp='0x0D' />
							<argument exp='NextPacketPtr &gt;&gt; 8' />
						</command>
						<command class_type='call' title='decrement the packet counter indicate we are done with this pack' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='EncWriteOp' >
							<argument exp='0x80' />
							<argument exp='0x1E' />
							<argument exp='0x40' />
						</command>
						<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='.Return = .Length' />
						</command>
						<command class_type='label' title='Connection Point' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' labelid='0' labelname='A' />
					</flowline>
				</macro>
				<macro >
					<flowline name='CheckForTCPType' description='Checks to what kind of TCP type the received data is requesting.
Returns a bit field specifying the type of request.
0x01 = Ack Requires, 0x02 = Synchronise
0x10 = Ack
' statediag='0' >
						<return name='Return' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='.Return = Buffer[0x2F]' />
						</command>
					</flowline>
				</macro>
				<macro >
					<flowline name='CheckArpPacketIsMyreplyArp' description='' statediag='0' >
						<return name='Return' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='.Return = 0' />
						</command>
						<command class_type='decision' title='if packet type is not arp packet exit from function' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='Buffer[12] != Buffer[0x08] || Buffer[13] != Buffer[0x06]' swap='0' >
							<flowline >
								<command class_type='goto' title='Goto Connection Point' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' labelid='0' labelname='' />
							</flowline>
							<flowline />
						</command>
						<command class_type='decision' title='check arp request opcode' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='Buffer[0x14] != Buffer[0x00] || Buffer[0x15] != Buffer[0x02]' swap='0' >
							<flowline >
								<command class_type='goto' title='Goto Connection Point' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' labelid='0' labelname='' />
							</flowline>
							<flowline />
						</command>
						<command class_type='decision' title='if destination ip address in arp packet not match with avr ip ad' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='Buffer[0x26] != MyIp[0]' swap='0' >
							<flowline >
								<command class_type='goto' title='Goto Connection Point' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' labelid='0' labelname='' />
							</flowline>
							<flowline />
						</command>
						<command class_type='decision' title='if destination ip address in arp packet not match with avr ip ad' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='Buffer[0x27] != MyIp[1]' swap='0' >
							<flowline >
								<command class_type='goto' title='Goto Connection Point' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' labelid='0' labelname='' />
							</flowline>
							<flowline />
						</command>
						<command class_type='decision' title='if destination ip address in arp packet not match with avr ip ad' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='Buffer[0x28] != MyIp[2]' swap='0' >
							<flowline >
								<command class_type='goto' title='Goto Connection Point' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' labelid='0' labelname='' />
							</flowline>
							<flowline />
						</command>
						<command class_type='decision' title='if destination ip address in arp packet not match with avr ip ad' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='Buffer[0x29] != MyIp[3]' swap='0' >
							<flowline >
								<command class_type='goto' title='Goto Connection Point' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' labelid='0' labelname='' />
							</flowline>
							<flowline />
						</command>
						<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='.Return = 1' />
						</command>
						<command class_type='label' title='Connection Point' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' labelid='0' labelname='A' />
					</flowline>
				</macro>
				<macro >
					<flowline name='IpMakeEthIpNew' description='' statediag='0' >
						<return name='Return' type='v0' description='' isconst='0' isHidden='0' isinit='0' usrinit='' setinit='' />
						<param name='DestinationMAC' type='u8*' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='6' />
						</param>
						<command class_type='calculation' title='copy the destination mac' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[0] = .DestinationMAC[0]' />
							<exp exp='Buffer[1] = .DestinationMAC[1]' />
							<exp exp='Buffer[2] = .DestinationMAC[2]' />
							<exp exp='Buffer[3] = .DestinationMAC[3]' />
							<exp exp='Buffer[4] = .DestinationMAC[4]' />
							<exp exp='Buffer[5] = .DestinationMAC[5]' />
						</command>
						<command class_type='calculation' title='fill my mac into src' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[6] = MyMac[0]' />
							<exp exp='Buffer[7] = MyMac[1]' />
							<exp exp='Buffer[8] = MyMac[2]' />
							<exp exp='Buffer[9] = MyMac[3]' />
							<exp exp='Buffer[10] = MyMac[4]' />
							<exp exp='Buffer[11] = MyMac[5]' />
						</command>
						<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[12] = 8' />
							<exp exp='Buffer[13] = 0' />
						</command>
					</flowline>
				</macro>
				<macro >
					<flowline name='IpMakeIpTcpNew' description='' statediag='0' >
						<return name='Return' type='v0' description='' isconst='0' isHidden='0' isinit='0' usrinit='' setinit='' />
						<param name='Length' type='u16' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='DestIp' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='4' />
						</param>
						<command class_type='calculation' title='set ipv4 and header length' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[0x0E] = 0x45' />
						</command>
						<command class_type='calculation' title='set TOS to default 0x00' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[0x0F] = 0x00' />
						</command>
						<command class_type='calculation' title='set total length' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[0x10] = .Length &gt;&gt; 8' />
							<exp exp='Buffer[0x11] = .Length' />
						</command>
						<command class_type='calculation' title='set packet identification' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[0x12] = IP_Identifier &gt;&gt; 8' />
							<exp exp='Buffer[0x13] = IP_Identifier' />
							<exp exp='IP_Identifier = IP_Identifier + 1' />
						</command>
						<command class_type='calculation' title='set fragment flags' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[0x14] = 0x00' />
							<exp exp='Buffer[0x15] = 0x00' />
						</command>
						<command class_type='calculation' title='set TTL' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[0x16] = 128' />
						</command>
						<command class_type='calculation' title='set ip packettype to tcp/udp/icmp...' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[0x17] = 0x06' />
						</command>
						<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[0x1E] = .DestIp[0]' />
							<exp exp='Buffer[0x1F] = .DestIp[1]' />
							<exp exp='Buffer[0x20] = .DestIp[2]' />
							<exp exp='Buffer[0x21] = .DestIp[3]' />
						</command>
						<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[0x1A] = MyIp[0]' />
							<exp exp='Buffer[0x1B] = MyIp[1]' />
							<exp exp='Buffer[0x1C] = MyIp[2]' />
							<exp exp='Buffer[0x1D] = MyIp[3]' />
						</command>
						<command class_type='call' title='Call Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='IpFillIpHdrChecksum' />
					</flowline>
				</macro>
				<macro >
					<flowline name='IpChecksum' description='' statediag='0' >
						<return name='Return' type='u16' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='Idx' type='u16' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='Length' type='u16' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='Type' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='Sum' type='u32' description='' isconst='0' isHidden='0' isinit='1' usrinit='0' setinit='0' />
						<local name='temp2' type='u16' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<command class_type='decision' title='Decision' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='.Type = 1' swap='0' >
							<flowline >
								<command class_type='calculation' title='protocol udp' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='.Sum = .Sum + 0x11' />
								</command>
								<command class_type='calculation' title='the length here is the length of udp' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='.Sum = .Sum + (.Length - 8)' />
								</command>
							</flowline>
							<flowline />
						</command>
						<command class_type='decision' title='Decision' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='.Type = 2' swap='0' >
							<flowline >
								<command class_type='calculation' title='protocol udp' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='.Sum = .Sum + 0x06' />
								</command>
								<command class_type='calculation' title='the length here is the length of tcp ' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='.Sum = .Sum + (.Length - 8)' />
								</command>
							</flowline>
							<flowline />
						</command>
						<command class_type='loop' title='build the sum of 16bit words' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' type='0' exp='.Length &gt; 1' >
							<flowline >
								<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='.temp2 = (Buffer[.Idx] &lt;&lt; 8) | Buffer[.Idx + 1]' />
								</command>
								<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='.Sum = .Sum + .temp2' />
								</command>
								<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='.Idx = .Idx + 2' />
									<exp exp='.Length = .Length - 2' />
								</command>
							</flowline>
						</command>
						<command class_type='decision' title='if there is a byte left then add it (padded with zero)' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='.Length' swap='0' >
							<flowline >
								<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='.temp2 = (Buffer[.Idx] &lt;&lt; 8)' />
								</command>
								<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='.Sum = .Sum + .temp2' />
								</command>
							</flowline>
							<flowline />
						</command>
						<command class_type='native' title='C Code' disable='1' ccode='while (FCL_SUM &gt;&gt; 16)
{
  FCL_SUM = (FCL_SUM &amp; 0xFFFF) + (FCL_SUM &gt;&gt; 16);
}' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' language='C' />
						<command class_type='loop' title='Loop' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' type='0' exp='.Sum / 65536' >
							<flowline >
								<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='.temp2 = .Sum &amp; 0xFFFF' />
								</command>
								<command class_type='calculation' title='now calculate the sum over the bytes in the sum' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='.Sum = (.Sum / 65536) + .temp2' />
								</command>
							</flowline>
						</command>
						<command class_type='native' title='C Code' ccode='FCR_RETVAL = (MX_UINT16) FCL_SUM ^ 0xFFFF;' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' language='C' />
						<command class_type='calculation' title='build 1&apos;s complement:' disable='1' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='.Return = ~ .Sum' />
						</command>
					</flowline>
				</macro>
				<macro >
					<flowline name='CheckForIp' description='Checks to see if the received data is an IP request with my IP address.' statediag='0' >
						<return name='Return' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='Length' type='u16' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='.Return = 0' />
						</command>
						<command class_type='decision' title='Decision' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='.Length &lt; 42' swap='0' >
							<flowline >
								<command class_type='goto' title='Goto Connection Point' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' labelid='0' labelname='' />
							</flowline>
							<flowline />
						</command>
						<command class_type='decision' title='Decision' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='Buffer[12] != 0x08 || Buffer[13] != 0x00' swap='0' >
							<flowline >
								<command class_type='goto' title='Goto Connection Point' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' labelid='0' labelname='' />
							</flowline>
							<flowline />
						</command>
						<command class_type='decision' title='Decision' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='Buffer[0x0E] != 0x45' swap='0' >
							<flowline >
								<command class_type='goto' title='Goto Connection Point' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' labelid='0' labelname='' />
							</flowline>
							<flowline />
						</command>
						<command class_type='decision' title='Decision' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='Buffer[0x1E] != MyIp[0]' swap='0' >
							<flowline >
								<command class_type='goto' title='Goto Connection Point' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' labelid='0' labelname='' />
							</flowline>
							<flowline />
						</command>
						<command class_type='decision' title='Decision' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='Buffer[0x1F] != MyIp[1]' swap='0' >
							<flowline >
								<command class_type='goto' title='Goto Connection Point' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' labelid='0' labelname='' />
							</flowline>
							<flowline />
						</command>
						<command class_type='decision' title='Decision' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='Buffer[0x20] != MyIp[2]' swap='0' >
							<flowline >
								<command class_type='goto' title='Goto Connection Point' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' labelid='0' labelname='' />
							</flowline>
							<flowline />
						</command>
						<command class_type='decision' title='Decision' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='Buffer[0x21] != MyIp[3]' swap='0' >
							<flowline >
								<command class_type='goto' title='Goto Connection Point' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' labelid='0' labelname='' />
							</flowline>
							<flowline />
						</command>
						<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='.Return = 1' />
						</command>
						<command class_type='label' title='Connection Point' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' labelid='0' labelname='A' />
					</flowline>
				</macro>
				<macro >
					<flowline name='CheckForTCPPort' description='Checks to see if the received data is requesting the server port' statediag='0' >
						<return name='Return' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='Port' type='u16' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='.Return = 0' />
						</command>
						<command class_type='decision' title='Check for TCP Port Request' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='Buffer[0x17] == 0x06' swap='0' >
							<flowline >
								<command class_type='decision' title='Decision' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='Buffer[0x24] == (.Port &gt;&gt; 8)' swap='0' >
									<flowline >
										<command class_type='decision' title='Decision' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='Buffer[0x25] == .Port' swap='0' >
											<flowline >
												<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
													<exp exp='.Return = 1' />
												</command>
											</flowline>
											<flowline />
										</command>
									</flowline>
									<flowline />
								</command>
							</flowline>
							<flowline />
						</command>
					</flowline>
				</macro>
				<macro >
					<flowline name='CheckForPing' description='Checks to see if the received data is a Ping request' statediag='0' >
						<return name='Return' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='.Return = 0' />
						</command>
						<command class_type='decision' title='Ping Request' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='Buffer[0x17] == 0x01 &amp;&amp; Buffer[0x22] == 8' swap='0' >
							<flowline >
								<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='.Return = 1' />
								</command>
							</flowline>
							<flowline />
						</command>
					</flowline>
				</macro>
				<macro >
					<flowline name='GetModuleRevision' description='Requets the module revision number and returns the value supplied by the module&apos;s firmware.' statediag='0' >
						<return name='Return' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<command class_type='call' title='Call Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='ReadRegister' >
							<return exp='.Return' />
							<argument exp='0x72' />
						</command>
					</flowline>
				</macro>
				<macro >
					<flowline name='MakeTcpAckWithData' description='' statediag='0' >
						<return name='Return' type='v0' description='' isconst='0' isHidden='0' isinit='0' usrinit='' setinit='' />
						<param name='DataLength' type='u16' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='ck' type='u16' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[0x2F] = 0x19' />
						</command>
						<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='.ck = 40 + .DataLength' />
						</command>
						<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[0x10] = .ck &gt;&gt; 8' />
							<exp exp='Buffer[0x11] = .ck' />
						</command>
						<command class_type='call' title='Call Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='IpFillIpHdrChecksum' />
						<command class_type='calculation' title='Zero the checksum' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[0x32] = 0' />
							<exp exp='Buffer[0x33] = 0' />
						</command>
						<command class_type='call' title='Calculate the checksum' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='IpChecksum' >
							<return exp='.ck' />
							<argument exp='0x1A' />
							<argument exp='28 + .DataLength' />
							<argument exp='2' />
						</command>
						<command class_type='calculation' title='Assign checksum' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[0x32] = .ck &gt;&gt; 8' />
							<exp exp='Buffer[0x33] = .ck' />
						</command>
						<command class_type='call' title='' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='PacketSend' >
							<argument exp='54 + .DataLength' />
						</command>
					</flowline>
				</macro>
				<macro >
					<flowline name='SetMyMACAddress' description='Allows the MAC Address specified in the component properties to be overridden.
The MAC Address will revert back to the MAC specified in the component properties as part of the initialise macro.' statediag='0' >
						<return name='Return' type='v0' description='' isconst='0' isHidden='0' isinit='0' usrinit='' setinit='' />
						<param name='MAC0' type='u8' description='MAC Address Parameter' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='MAC1' type='u8' description='MAC Address Parameter' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='MAC2' type='u8' description='MAC Address Parameter' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='MAC3' type='u8' description='MAC Address Parameter' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='MAC4' type='u8' description='MAC Address Parameter' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='MAC5' type='u8' description='MAC Address Parameter' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='MyMAC[0] = .MAC0' />
							<exp exp='MyMAC[1] = .MAC1' />
							<exp exp='MyMAC[2] = .MAC2' />
							<exp exp='MyMAC[3] = .MAC3' />
							<exp exp='MyMAC[4] = .MAC4' />
							<exp exp='MyMAC[5] = .MAC5' />
						</command>
						<command class_type='call' title='Call Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='InternalInit' />
					</flowline>
				</macro>
				<macro >
					<flowline name='Ev_Property' description='Sent when a property has been changed by the User' statediag='0' >
						<return name='Return' type='u32' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='tempstr' type='T8' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='20' />
						</local>
						<local name='ObjHandle' type='h32' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<command class_type='comment' title='' comment='Override Sim Type as TCP IP mode currently unsupported' textarea='53,30,53,30' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' />
						<command class_type='sim' title='Simulation' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='Component.Property.SetValue' >
							<argument exp='this' />
							<argument exp='&quot;SimType&quot;' />
							<argument exp='1' />
						</command>
						<command class_type='decision' title='Decision' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='SImType' swap='0' >
							<flowline >
								<command class_type='sim' title='Simulation' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='Component.Property.SetVisible' >
									<argument exp='this' />
									<argument exp='&quot;property_6&quot;' />
									<argument exp='1' />
								</command>
								<command class_type='sim' title='Simulation' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='Component.Property.SetVisible' >
									<argument exp='this' />
									<argument exp='&quot;property_7&quot;' />
									<argument exp='0' />
								</command>
								<command class_type='sim' title='Call Component Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' component='cal_spi' macro='GetConsoleHandle' >
									<return exp='.ObjHandle' />
								</command>
							</flowline>
							<flowline >
								<command class_type='sim' title='Simulation' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='Component.Property.SetVisible' >
									<argument exp='this' />
									<argument exp='&quot;property_6&quot;' />
									<argument exp='0' />
								</command>
								<command class_type='sim' title='Simulation' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='Component.Property.SetVisible' >
									<argument exp='this' />
									<argument exp='&quot;property_7&quot;' />
									<argument exp='1' />
								</command>
								<command class_type='sim' title='Component Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' component='TCP_Base1' macro='GetConsole' >
									<return exp='.ObjHandle' />
								</command>
							</flowline>
						</command>
						<command class_type='sim' title='Component Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' component='LibraryComponent1' macro='SetConsoleHandle' >
							<argument exp='.ObjHandle' />
						</command>
					</flowline>
				</macro>
				<macro >
					<flowline name='EncReadOp' description='' statediag='0' >
						<return name='Return' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='Op' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='Address' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<command class_type='sim' title='Component Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' component='LibraryComponent1' macro='FlashRx' />
						<command class_type='call' title='Call Component Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' component='cal_spi' macro='Master_Enable_CS' />
						<command class_type='call' title='Call Component Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' component='cal_spi' macro='Master_Byte' >
							<argument exp='.Op | (.Address &amp; ADDR_MASK)' />
						</command>
						<command class_type='call' title='Call Component Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' component='cal_spi' macro='Master_Byte' >
							<return exp='.Return' />
							<argument exp='0x00' />
						</command>
						<command class_type='decision' title='Decision' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='.Address &amp; 0x80' swap='0' >
							<flowline >
								<command class_type='call' title='Call Component Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' component='cal_spi' macro='Master_Byte' >
									<return exp='.Return' />
									<argument exp='0x00' />
								</command>
							</flowline>
							<flowline />
						</command>
						<command class_type='call' title='Call Component Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' component='cal_spi' macro='Master_Disable_CS' />
					</flowline>
				</macro>
				<macro >
					<flowline name='IpMakeUdpReplyFromRequest' description='' statediag='0' >
						<return name='Return' type='v0' description='' isconst='0' isHidden='0' isinit='0' usrinit='' setinit='' />
						<param name='Data' type='T8*' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='20' />
						</param>
						<param name='DataLength' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='Port' type='u16' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='idx' type='u8' description='' isconst='0' isHidden='0' isinit='1' usrinit='0' setinit='0' />
						<local name='ck' type='u16' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<command class_type='call' title='Call Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='IpMakeEth' />
						<command class_type='decision' title='Decision' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='.DataLength &gt; 220' swap='0' >
							<flowline >
								<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='.DataLength = 220' />
								</command>
							</flowline>
							<flowline />
						</command>
						<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[0x10] = 0' />
							<exp exp='Buffer[0x11] = 28 + .DataLength' />
						</command>
						<command class_type='call' title='Call Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='IpMakeIp' />
						<command class_type='calculation' title='Assign Destination Port' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[0x24] = .Port &gt;&gt; 8' />
							<exp exp='Buffer[0x25] = .Port' />
						</command>
						<command class_type='calculation' title='calculte the udp length:' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[0x26] = 0' />
							<exp exp='Buffer[0x27] = 8 + .DataLength' />
						</command>
						<command class_type='calculation' title='Zero the checksum' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[0x28] = 0' />
							<exp exp='Buffer[0x29] = 0' />
						</command>
						<command class_type='loop' title='Copy the data' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' type='0' exp='.idx &lt; .DataLength' >
							<flowline >
								<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='Buffer[0x2A + .idx] = .Data[.idx]' />
								</command>
								<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='.idx = .idx + 1' />
								</command>
							</flowline>
						</command>
						<command class_type='call' title='Calculate the checksum' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='IpChecksum' >
							<return exp='.ck' />
							<argument exp='0x1A' />
							<argument exp='16 + .DataLength' />
							<argument exp='1' />
						</command>
						<command class_type='calculation' title='Zero the checksum' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[0x28] = .ck &gt;&gt; 8' />
							<exp exp='Buffer[0x29] = .ck' />
						</command>
						<command class_type='call' title='Call Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='PacketSend' >
							<argument exp='42 + .DataLength' />
						</command>
					</flowline>
				</macro>
				<macro >
					<flowline name='Ev_AddVarSize' description='Sent to a component to allow dynamic amendment of global array-size declarations' statediag='0' >
						<return name='Return' type='u32' description='Non-zero to include definition - initialised on call' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='VarName' type='T8' description='The original Flowcode variable' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='20' />
						</param>
						<param name='ExpandName' type='T8' description='The expanded variable-size name' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='20' />
						</param>
						<param name='Expansion' type='T8*' description='The expanded string to inline to the code' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='20' />
						</param>
					</flowline>
				</macro>
				<macro >
					<flowline name='MakeArpAnswerFromRequest' description='' statediag='0' >
						<return name='Return' type='v0' description='' isconst='0' isHidden='0' isinit='0' usrinit='' setinit='' />
						<command class_type='call' title='Call Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='IpMakeEth' />
						<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[0x14] = 0' />
							<exp exp='Buffer[0x15] = 2' />
						</command>
						<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[0x20] = Buffer[0x16]' />
							<exp exp='Buffer[0x21] = Buffer[0x17]' />
							<exp exp='Buffer[0x22] = Buffer[0x18]' />
							<exp exp='Buffer[0x23] = Buffer[0x19]' />
							<exp exp='Buffer[0x24] = Buffer[0x1A]' />
							<exp exp='Buffer[0x25] = Buffer[0x1B]' />
						</command>
						<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[0x16] = MyMac[0]' />
							<exp exp='Buffer[0x17] = MyMac[1]' />
							<exp exp='Buffer[0x18] = MyMac[2]' />
							<exp exp='Buffer[0x19] = MyMac[3]' />
							<exp exp='Buffer[0x1A] = MyMac[4]' />
							<exp exp='Buffer[0x1B] = MyMac[5]' />
						</command>
						<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[0x26] = Buffer[0x1C]' />
							<exp exp='Buffer[0x27] = Buffer[0x1D]' />
							<exp exp='Buffer[0x28] = Buffer[0x1E]' />
							<exp exp='Buffer[0x29] = Buffer[0x1F]' />
						</command>
						<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[0x1C] = MyIp[0]' />
							<exp exp='Buffer[0x1D] = MyIp[1]' />
							<exp exp='Buffer[0x1E] = MyIp[2]' />
							<exp exp='Buffer[0x1F] = MyIp[3]' />
						</command>
						<command class_type='call' title='Call Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='PacketSend' >
							<argument exp='42' />
						</command>
					</flowline>
				</macro>
				<macro >
					<flowline name='ReadArrayFromBuffer' description='Reads an array of bytes from the buffer at location specified for the number of bytes specified.
If a space character is encountered then the macro will return straight away without the space character in the string.' statediag='0' >
						<return name='Return' type='v0' description='' isconst='0' isHidden='0' isinit='0' usrinit='' setinit='' />
						<param name='BufferLocation' type='u16' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='NumberOfBytes' type='u8' description='Number of bytes to read from the buffer and store into string' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='Data' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='10' />
						</param>
						<local name='Index' type='u16' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='Count' type='u8' description='' isconst='0' isHidden='0' isinit='1' usrinit='0' setinit='0' />
						<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='.Index = .BufferLocation' />
						</command>
						<command class_type='loop' title='Loop' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' type='0' exp='.Count &lt; .NumberOfBytes' >
							<flowline >
								<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='.Data[.Count] = Buffer[.Index]' />
								</command>
								<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='.Index = .Index + 1' />
									<exp exp='.Count = .Count + 1' />
								</command>
							</flowline>
						</command>
					</flowline>
				</macro>
				<macro >
					<flowline name='Ev_Renamed' description='' statediag='0' >
						<return name='Return' type='u32' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='Name' type='T8' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='20' />
						</local>
						<command class_type='sim' title='' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='Tree.GetName' >
							<return exp='.Name' />
							<argument exp='this' />
						</command>
						<command class_type='sim' title='' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='Component.Property.SetValue' >
							<argument exp='LibraryComponent1' />
							<argument exp='&quot;Name&quot;' />
							<argument exp='.Name' />
						</command>
					</flowline>
				</macro>
				<macro >
					<flowline name='Ev_GetVarSize' description='Sent to a component to amend the size of the expected array' statediag='0' >
						<return name='Return' type='u32' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='VarName' type='T8' description='The original Flowcode variable' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='20' />
						</param>
						<param name='Elements' type='u32*' description='The number of elements in the array' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<command class_type='decision' title='Check for Buffer Variable' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='Compare$ (.VarName,&quot;Buffer&quot;,0) == 0' swap='0' >
							<flowline >
								<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='.Elements = BufferSize + 1' />
								</command>
							</flowline>
							<flowline />
						</command>
					</flowline>
				</macro>
				<macro >
					<flowline name='EncInit' description='' statediag='0' >
						<return name='Return' type='v0' description='' isconst='0' isHidden='0' isinit='0' usrinit='' setinit='' />
						<command class_type='call' title='Call Component Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' component='cal_spi' macro='Master_Disable_CS' />
						<command class_type='call' title='System Reset' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='EncWriteOp' >
							<argument exp='0xFF' />
							<argument exp='0' />
							<argument exp='0xFF' />
						</command>
						<command class_type='delay' title='Delay' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' exp='50' type='1' />
						<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='NextPacketPtr = 0' />
						</command>
						<command class_type='call' title='Rx Start - 0x0000' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='WriteRegister' >
							<argument exp='0x08' />
							<argument exp='0' />
						</command>
						<command class_type='call' title='Rx Start' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='WriteRegister' >
							<argument exp='0x09' />
							<argument exp='0' />
						</command>
						<command class_type='call' title='set receive pointer address - 0x0000' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='WriteRegister' >
							<argument exp='0x0C' />
							<argument exp='0' />
						</command>
						<command class_type='call' title='set receive pointer address' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='WriteRegister' >
							<argument exp='0x0D' />
							<argument exp='0' />
						</command>
						<command class_type='call' title='RX end - 0x19FF' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='WriteRegister' >
							<argument exp='0x0A' />
							<argument exp='0xFF' />
						</command>
						<command class_type='call' title='RX end' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='WriteRegister' >
							<argument exp='0x0B' />
							<argument exp='0x19' />
						</command>
						<command class_type='call' title='TX start - 0x1A00' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='WriteRegister' >
							<argument exp='0x04' />
							<argument exp='0' />
						</command>
						<command class_type='call' title='TX start' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='WriteRegister' >
							<argument exp='0x05' />
							<argument exp='0x1A' />
						</command>
						<command class_type='call' title='TX end - 0x1FFF' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='WriteRegister' >
							<argument exp='0x06' />
							<argument exp='0xFF' />
						</command>
						<command class_type='call' title='TX end' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='WriteRegister' >
							<argument exp='0x07' />
							<argument exp='0x1F' />
						</command>
						<command class_type='call' title='Packet Filter - Bank1' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='WriteRegister' >
							<argument exp='0x38' />
							<argument exp='0xB0' />
						</command>
						<command class_type='call' title='Packet Filter' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='WriteRegister' >
							<argument exp='0x28' />
							<argument exp='0x3F' />
						</command>
						<command class_type='call' title='Packet Filter' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='WriteRegister' >
							<argument exp='0x29' />
							<argument exp='0x30' />
						</command>
						<command class_type='call' title='Packet Filter' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='WriteRegister' >
							<argument exp='0x30' />
							<argument exp='0xF9' />
						</command>
						<command class_type='call' title='Packet Filter' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='WriteRegister' >
							<argument exp='0x31' />
							<argument exp='0xF7' />
						</command>
						<command class_type='call' title='Enable MAC Receive - Bank2' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='WriteRegister' >
							<argument exp='0xC0' />
							<argument exp='0x0D' />
						</command>
						<command class_type='call' title='Enable MAC Receive' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='WriteRegister' >
							<argument exp='0xC1' />
							<argument exp='0x00' />
						</command>
						<command class_type='call' title='Auto 60 Byte Padding &amp; CRC' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='EncWriteOp' >
							<argument exp='0x80' />
							<argument exp='0xC2' />
							<argument exp='0x32' />
						</command>
						<command class_type='call' title='Inner Frame Gap - Non Back to back' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='WriteRegister' >
							<argument exp='0xC6' />
							<argument exp='0x12' />
						</command>
						<command class_type='call' title='Inner Frame Gap' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='WriteRegister' >
							<argument exp='0xC7' />
							<argument exp='0x0C' />
						</command>
						<command class_type='call' title='Inner Frame Gap - Back to back' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='WriteRegister' >
							<argument exp='0xC4' />
							<argument exp='0x12' />
						</command>
						<command class_type='call' title='Max Packet Size' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='WriteRegister' >
							<argument exp='0xCA' />
							<argument exp='0x00' />
						</command>
						<command class_type='call' title='Max Packet Size' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='WriteRegister' >
							<argument exp='0xCB' />
							<argument exp='0x1A' />
						</command>
						<command class_type='call' title='MAC Address - Bank3' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='WriteRegister' >
							<argument exp='0xE4' />
							<argument exp='MyMac[0]' />
						</command>
						<command class_type='call' title='MAC Address' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='WriteRegister' >
							<argument exp='0xE5' />
							<argument exp='MyMac[1]' />
						</command>
						<command class_type='call' title='MAC Address' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='WriteRegister' >
							<argument exp='0xE2' />
							<argument exp='MyMac[2]' />
						</command>
						<command class_type='call' title='MAC Address' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='WriteRegister' >
							<argument exp='0xE3' />
							<argument exp='MyMac[3]' />
						</command>
						<command class_type='call' title='MAC Address' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='WriteRegister' >
							<argument exp='0xE0' />
							<argument exp='MyMac[4]' />
						</command>
						<command class_type='call' title='MAC Address' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='WriteRegister' >
							<argument exp='0xE1' />
							<argument exp='MyMac[5]' />
						</command>
						<command class_type='call' title='no loopback of transmitted frames' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='EncPhyWrite' >
							<argument exp='0x10' />
							<argument exp='0x0100' />
						</command>
						<command class_type='call' title='Switch to Bank0' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='EncSetBank' >
							<argument exp='0x1F' />
						</command>
						<command class_type='call' title='Enable Interrupts' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='EncWriteOp' >
							<argument exp='0x80' />
							<argument exp='0x1B' />
							<argument exp='0xC0' />
						</command>
						<command class_type='call' title='Enable Packet Reception' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='EncWriteOp' >
							<argument exp='0x80' />
							<argument exp='0x1F' />
							<argument exp='0x04' />
						</command>
					</flowline>
				</macro>
				<macro >
					<flowline name='ReadRegister' description='Reads the value from a single register onboard the ENC28J60 module.' statediag='0' >
						<return name='Return' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='Address' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<command class_type='call' title='Call Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='EncSetBank' >
							<argument exp='.Address' />
						</command>
						<command class_type='call' title='ENC28J60_READ_CTRL_REG' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='EncReadOp' >
							<return exp='.Return' />
							<argument exp='0x00' />
							<argument exp='.Address' />
						</command>
					</flowline>
				</macro>
				<macro >
					<flowline name='CheckForARP' description='Checks to see if the received data is an ARP request with my IP address.' statediag='0' >
						<return name='Return' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='Length' type='u16' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='.Return = 0' />
						</command>
						<command class_type='decision' title='Decision' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='.Length &lt; 41' swap='0' >
							<flowline >
								<command class_type='goto' title='Goto Connection Point' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' labelid='0' labelname='' />
							</flowline>
							<flowline />
						</command>
						<command class_type='decision' title='Decision' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='Buffer[12] != 0x08 || Buffer[13] != 0x06' swap='0' >
							<flowline >
								<command class_type='goto' title='Goto Connection Point' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' labelid='0' labelname='' />
							</flowline>
							<flowline />
						</command>
						<command class_type='decision' title='Decision' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='Buffer[0x26] != MyIp[0]' swap='0' >
							<flowline >
								<command class_type='goto' title='Goto Connection Point' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' labelid='0' labelname='' />
							</flowline>
							<flowline />
						</command>
						<command class_type='decision' title='Decision' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='Buffer[0x27] != MyIp[1]' swap='0' >
							<flowline >
								<command class_type='goto' title='Goto Connection Point' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' labelid='0' labelname='' />
							</flowline>
							<flowline />
						</command>
						<command class_type='decision' title='Decision' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='Buffer[0x28] != MyIp[2]' swap='0' >
							<flowline >
								<command class_type='goto' title='Goto Connection Point' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' labelid='0' labelname='' />
							</flowline>
							<flowline />
						</command>
						<command class_type='decision' title='Decision' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='Buffer[0x29] != MyIp[3]' swap='0' >
							<flowline >
								<command class_type='goto' title='Goto Connection Point' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' labelid='0' labelname='' />
							</flowline>
							<flowline />
						</command>
						<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='.Return = 1' />
						</command>
						<command class_type='label' title='Connection Point' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' labelid='0' labelname='A' />
					</flowline>
				</macro>
				<macro >
					<flowline name='ClientSendPacket' description='' statediag='0' >
						<return name='Return' type='v0' description='' isconst='0' isHidden='0' isinit='0' usrinit='' setinit='' />
						<param name='DestPort' type='u16' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='SourcePort' type='u16' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='Flags' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='MaxSegmentSize' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='ClearSeqAck' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='NextAckNum' type='u16' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='DataLength' type='u16' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='DestMac' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='6' />
						</param>
						<param name='DestIp' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='4' />
						</param>
						<local name='idx' type='u8' description='' isconst='0' isHidden='0' isinit='1' usrinit='0' setinit='0' />
						<local name='tseq' type='u8' description='' isconst='0' isHidden='0' isinit='1' usrinit='0' setinit='0' />
						<local name='ck' type='u16' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<command class_type='calculation' title='copy the destination mac' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[0] = .DestMAC[0]' />
							<exp exp='Buffer[1] = .DestMAC[1]' />
							<exp exp='Buffer[2] = .DestMAC[2]' />
							<exp exp='Buffer[3] = .DestMAC[3]' />
							<exp exp='Buffer[4] = .DestMAC[4]' />
							<exp exp='Buffer[5] = .DestMAC[5]' />
						</command>
						<command class_type='calculation' title='fill my mac into src' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[6] = MyMac[0]' />
							<exp exp='Buffer[7] = MyMac[1]' />
							<exp exp='Buffer[8] = MyMac[2]' />
							<exp exp='Buffer[9] = MyMac[3]' />
							<exp exp='Buffer[10] = MyMac[4]' />
							<exp exp='Buffer[11] = MyMac[5]' />
						</command>
						<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[12] = 8' />
							<exp exp='Buffer[13] = 0' />
						</command>
						<command class_type='calculation' title='Set Destination Port' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[0x24] = .DestPort &gt;&gt; 8' />
							<exp exp='Buffer[0x25] = .DestPort' />
						</command>
						<command class_type='calculation' title='Set Source Port' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[0x22] = .SourcePort &gt;&gt; 8' />
							<exp exp='Buffer[0x23] = .SourcePort' />
						</command>
						<command class_type='decision' title='sequence numbers' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='.NextAckNum' swap='0' >
							<flowline >
								<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='.Idx = 4' />
								</command>
								<command class_type='loop' title='Loop' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' type='0' exp='.Idx &gt; 0' >
									<flowline >
										<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
											<exp exp='.NextAckNum = Buffer[0x26 + .Idx - 1] + .NextAckNum' />
											<exp exp='.tseq = Buffer[0x2A + .Idx - 1]' />
											<exp exp='Buffer[0x2A + .Idx - 1] = .NextAckNum' />
										</command>
										<command class_type='calculation' title='copy the acknum sent to us into the sequence number' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
											<exp exp='Buffer[0x26 + .Idx - 1] = .tseq' />
											<exp exp='.NextAckNum = .NextAckNum &gt;&gt; 8' />
										</command>
										<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
											<exp exp='.Idx = .Idx - 1' />
										</command>
									</flowline>
								</command>
							</flowline>
							<flowline />
						</command>
						<command class_type='decision' title='initial tcp sequence number,require to setup for first transmit/' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='.MaxSegmentSize' swap='0' >
							<flowline >
								<command class_type='calculation' title='put inital seq number' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='Buffer[0x26] = 0' />
									<exp exp='Buffer[0x27] = 0' />
								</command>
								<command class_type='calculation' title='we step only the second byte' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='Buffer[0x28] = SeqNum' />
									<exp exp='Buffer[0x29] = 0' />
								</command>
								<command class_type='calculation' title='step the inititial seq num' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='SeqNum = SeqNum + 2' />
								</command>
								<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='Buffer[0x36] = 2' />
									<exp exp='Buffer[0x37] = 4' />
									<exp exp='Buffer[0x38] = 0x05' />
									<exp exp='Buffer[0x39] = 0x80' />
								</command>
								<command class_type='calculation' title='24 Bytes' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='Buffer[0x2E] = 0x60' />
									<exp exp='' />
								</command>
								<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='.DataLength = .DataLength + 4' />
								</command>
							</flowline>
							<flowline >
								<command class_type='calculation' title='20 Bytes' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='Buffer[0x2E] = 0x50' />
									<exp exp='' />
								</command>
							</flowline>
						</command>
						<command class_type='call' title='Call Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='IpMakeIpTcpNew' >
							<argument exp='40 + .DataLength' />
							<argument exp='.DestIp' />
						</command>
						<command class_type='decision' title='clear sequence ack numer before send tcp SYN packet' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='.ClearSeqAck' swap='0' >
							<flowline >
								<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='Buffer[0x2A] = 0' />
									<exp exp='Buffer[0x2B] = 0' />
									<exp exp='Buffer[0x2C] = 0' />
									<exp exp='Buffer[0x2D] = 0' />
								</command>
							</flowline>
							<flowline />
						</command>
						<command class_type='calculation' title='Zero the checksum' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[0x32] = 0' />
							<exp exp='Buffer[0x33] = 0' />
						</command>
						<command class_type='calculation' title='Setup the flags' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[0x2F] = .Flags' />
						</command>
						<command class_type='calculation' title='setup maximum windows size' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[0x30] = 0x02' />
							<exp exp='Buffer[0x31] = 0x36' />
						</command>
						<command class_type='calculation' title='setup urgent pointer' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[0x34] = 0' />
							<exp exp='Buffer[0x35] = 0' />
						</command>
						<command class_type='call' title='Calculate checksum' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='IpChecksum' >
							<return exp='.ck' />
							<argument exp='0x1A' />
							<argument exp='28 + .DataLength' />
							<argument exp='2' />
						</command>
						<command class_type='calculation' title='Assign checksum' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[0x32] = .ck &gt;&gt; 8' />
							<exp exp='Buffer[0x33] = .ck' />
						</command>
						<command class_type='call' title='Call Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='PacketSend' >
							<argument exp='54 + .DataLength' />
						</command>
					</flowline>
				</macro>
				<macro >
					<flowline name='EncWriteBuffer' description='' statediag='0' >
						<return name='Return' type='v0' description='' isconst='0' isHidden='0' isinit='0' usrinit='' setinit='' />
						<param name='Length' type='u16' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='Index' type='u16' description='' isconst='0' isHidden='0' isinit='1' usrinit='0' setinit='0' />
						<command class_type='sim' title='Component Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' component='LibraryComponent1' macro='FlashTx' />
						<command class_type='call' title='Call Component Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' component='cal_spi' macro='Master_Enable_CS' />
						<command class_type='call' title='ENC28J60_WRITE_BUF_MEM' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' component='cal_spi' macro='Master_Byte' >
							<argument exp='0x7A' />
						</command>
						<command class_type='loop' title='Loop' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' type='0' exp='.Index &lt; .Length' >
							<flowline >
								<command class_type='call' title='Call Component Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' component='cal_spi' macro='Master_Byte' >
									<argument exp='Buffer[.Index]' />
								</command>
								<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='.Index = .Index + 1' />
								</command>
							</flowline>
						</command>
						<command class_type='call' title='Call Component Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' component='cal_spi' macro='Master_Disable_CS' />
					</flowline>
				</macro>
				<macro >
					<flowline name='MakeEchoReplyFromRequest' description='' statediag='0' >
						<return name='Return' type='v0' description='' isconst='0' isHidden='0' isinit='0' usrinit='' setinit='' />
						<param name='Length' type='u16' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<command class_type='call' title='Call Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='IpMakeEth' />
						<command class_type='call' title='Call Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='IpMakeIp' />
						<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[0x22] = 0' />
						</command>
						<command class_type='decision' title='Decision' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='Buffer[0x24] &gt; 0xF7' swap='0' >
							<flowline >
								<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='Buffer[0x25] = Buffer[0x25] + 1' />
								</command>
							</flowline>
							<flowline />
						</command>
						<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[0x24] = Buffer[0x24] + 0x08' />
						</command>
						<command class_type='call' title='Call Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='PacketSend' >
							<argument exp='.Length' />
						</command>
					</flowline>
				</macro>
				<macro >
					<flowline name='InternalInit' description='Initialises the SPI connection to the TCPIP module and sets up some initial values.
Flashes the LEDs on and off twice to confirm SPI comms are active.
LEDs are then configured to auto functionality.' statediag='0' >
						<return name='Return' type='v0' description='' isconst='0' isHidden='0' isinit='0' usrinit='' setinit='' />
						<command class_type='calculation' title='Reset Low' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='ResetPin = 0' />
						</command>
						<command class_type='delay' title='Delay' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' exp='1' type='1' />
						<command class_type='calculation' title='Reset High' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='ResetPin = 1' />
						</command>
						<command class_type='delay' title='Delay' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' exp='10' type='1' />
						<command class_type='call' title='Call Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' component='cal_spi' macro='Master_Init' />
						<command class_type='call' title='Call Component Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='EncInit' />
						<command class_type='call' title='change clkout from 6.25MHz to 12.5MHz' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='EncClockOut' >
							<argument exp='2' />
						</command>
						<command class_type='delay' title='Delay' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' exp='10' type='1' />
						<command class_type='call' title='LEDs On' disable='1' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='ControlLEDs' >
							<argument exp='1' />
						</command>
						<command class_type='delay' title='Delay' disable='1' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' exp='500' type='1' />
						<command class_type='call' title='LEDs Off' disable='1' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='ControlLEDs' >
							<argument exp='0' />
						</command>
						<command class_type='delay' title='Delay' disable='1' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' exp='500' type='1' />
						<command class_type='call' title='LEDs On' disable='1' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='ControlLEDs' >
							<argument exp='1' />
						</command>
						<command class_type='delay' title='Delay' disable='1' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' exp='500' type='1' />
						<command class_type='call' title='LEDs Off' disable='1' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='ControlLEDs' >
							<argument exp='0' />
						</command>
						<command class_type='delay' title='Delay' disable='1' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' exp='500' type='1' />
						<command class_type='call' title='LEDs Auto' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='ControlLEDs' >
							<argument exp='2' />
						</command>
						<command class_type='delay' title='Delay' disable='1' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' exp='100' type='1' />
					</flowline>
				</macro>
				<macro >
					<flowline name='Loop' description='' statediag='0' >
						<return name='Return' type='v0' description='' isconst='0' isHidden='0' isinit='0' usrinit='' setinit='' />
						<param name='Port' type='u16' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='plen' type='u16' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='dat_p' type='u16' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='retval' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='CompString' type='T8' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='4' />
						</local>
						<command class_type='call' title='Check for incoming data' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='PacketReceive' >
							<return exp='.plen' />
						</command>
						<command class_type='decision' title='Data Available?' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='.plen != 0' swap='0' >
							<flowline >
								<command class_type='call' title='ARP Request?' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='CheckForARP' >
									<return exp='.retval' />
									<argument exp='.plen' />
								</command>
								<command class_type='decision' title='Decision' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='.retval' swap='0' >
									<flowline >
										<command class_type='call' title='Call Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='MakeArpAnswerFromRequest' />
										<command class_type='goto' title='Goto Connection Point' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' labelid='0' labelname='' />
									</flowline>
									<flowline />
								</command>
								<command class_type='call' title='IP Request' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='CheckForIp' >
									<return exp='.retval' />
									<argument exp='.plen' />
								</command>
								<command class_type='decision' title='If not IP Request then bail out' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='.retval = 0' swap='0' >
									<flowline >
										<command class_type='goto' title='Goto Connection Point' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' labelid='0' labelname='' />
									</flowline>
									<flowline />
								</command>
								<command class_type='call' title='Check For Ping' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='CheckForPing' >
									<return exp='.retval' />
								</command>
								<command class_type='decision' title='Ping Request' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='.retval' swap='0' >
									<flowline >
										<command class_type='call' title='Call Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='MakeEchoReplyFromRequest' >
											<argument exp='.plen' />
										</command>
										<command class_type='goto' title='Goto Connection Point' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' labelid='0' labelname='' />
									</flowline>
									<flowline />
								</command>
								<command class_type='call' title='Check For Port' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='CheckForTCPPort' >
									<return exp='.retval' />
									<argument exp='.Port' />
								</command>
								<command class_type='decision' title='Check for TCP Port Request' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='.retval' swap='0' >
									<flowline >
										<command class_type='call' title='Check For Type' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='CheckForTCPType' >
											<return exp='.retval' />
										</command>
										<command class_type='decision' title='Synchronise?' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='.retval &amp; 0x02' swap='0' >
											<flowline >
												<command class_type='call' title='Call Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='MakeTcpSynackFromSyn' >
													<argument exp='.Port' />
												</command>
												<command class_type='goto' title='Goto Connection Point' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' labelid='0' labelname='' />
											</flowline>
											<flowline />
										</command>
										<command class_type='decision' title='Ack?' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='.retval &amp; 0x10' swap='0' >
											<flowline >
												<command class_type='call' title='Call Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='InitialiseDataLengthInfo' />
												<command class_type='call' title='Call Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='GetTcpDataPointer' >
													<return exp='.dat_p' />
												</command>
												<command class_type='decision' title='Is there no data?' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='.dat_p = 0' swap='0' >
													<flowline >
														<command class_type='decision' title='Decision' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='.retval &amp; 0x01' swap='0' >
															<flowline >
																<command class_type='call' title='Call Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='MakeTcpAckFromAny' >
																	<argument exp='.Port' />
																</command>
															</flowline>
															<flowline />
														</command>
														<command class_type='goto' title='Goto Connection Point' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' labelid='0' labelname='' />
													</flowline>
													<flowline />
												</command>
												<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
													<exp exp='.CompString[0] = Buffer[.dat_p]' />
													<exp exp='.CompString[1] = Buffer[.dat_p + 1]' />
													<exp exp='.CompString[2] = Buffer[.dat_p + 2]' />
													<exp exp='.CompString[3] = Buffer[.dat_p + 3]' />
												</command>
												<command class_type='decision' title='&quot;GET&quot; Request' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='Compare$ (&quot;GET &quot;, .CompString,0) != 0' swap='0' >
													<flowline >
														<command class_type='call' title='Call Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='FillTcpData' >
															<return exp='.plen' />
															<argument exp='0' />
															<argument exp='&quot;HTTP/1.0 200 OK\r\nContent-Type: text/html\r\n\r\n&lt;h1&gt;200 OK&lt;/h1&gt;&quot;' />
														</command>
														<command class_type='goto' title='Goto Connection Point' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' labelid='1' labelname='' />
													</flowline>
													<flowline />
												</command>
												<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
													<exp exp='.CompString[0] = Buffer[.dat_p + 4]' />
													<exp exp='.CompString[1] = Buffer[.dat_p + 5]' />
													<exp exp='.CompString[2] = 0' />
												</command>
												<command class_type='decision' title='Root of I/P' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='Compare$ (&quot;/ &quot;, .CompString,0) = 0' swap='0' >
													<flowline >
														<command class_type='call' title='Call Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='FillTcpData' >
															<return exp='.plen' />
															<argument exp='0' />
															<argument exp='&quot;HTTP/1.0 200 OK\r\nContent-Type: text/html\r\n\r\n&quot;' />
														</command>
														<command class_type='call' title='Call Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='FillTcpData' >
															<return exp='.plen' />
															<argument exp='.plen' />
															<argument exp='&quot;&lt;center&gt;&lt;p&gt;&lt;h1&gt;Welcome to Arduino Ethernet Shield V1.0  &lt;/h1&gt;&lt;/p&gt;&quot;' />
														</command>
														<command class_type='call' title='Call Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='FillTcpData' >
															<return exp='.plen' />
															<argument exp='.plen' />
															<argument exp='&quot;&lt;hr&gt;&lt;br&gt; &lt;h2&gt;&lt;font color=\&quot;blue\&quot;&gt;-- Put your ARDUINO online -- &quot;' />
														</command>
														<command class_type='call' title='Call Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='FillTcpData' >
															<return exp='.plen' />
															<argument exp='.plen' />
															<argument exp='&quot;&lt;br&gt; Control digital outputs &quot;' />
														</command>
														<command class_type='call' title='Call Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='FillTcpData' >
															<return exp='.plen' />
															<argument exp='.plen' />
															<argument exp='&quot;&lt;br&gt; Read digital analog inputs HERE &quot;' />
														</command>
														<command class_type='call' title='Call Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='FillTcpData' >
															<return exp='.plen' />
															<argument exp='.plen' />
															<argument exp='&quot;  &lt;br&gt;&lt;/font&gt;&lt;/h2&gt; &quot;' />
														</command>
														<command class_type='call' title='Call Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='FillTcpData' >
															<return exp='.plen' />
															<argument exp='.plen' />
															<argument exp='&quot;&lt;/center&gt;&lt;hr&gt;  V1.0 &lt;a href=\&quot;http://www.nuelectronics.com\&quot;&gt;www.nuelectronics.com&lt;a&gt;&quot;' />
														</command>
														<command class_type='goto' title='Goto Connection Point' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' labelid='1' labelname='' />
													</flowline>
													<flowline />
												</command>
											</flowline>
											<flowline />
										</command>
										<command class_type='label' title='Connection Point' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' labelid='1' labelname='SendTCP' />
										<command class_type='call' title='send ack for http get' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='MakeTcpAckFromAny' >
											<argument exp='.Port' />
										</command>
										<command class_type='call' title='send data  ' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='MakeTcpAckWithData' >
											<argument exp='.plen' />
										</command>
									</flowline>
									<flowline />
								</command>
							</flowline>
							<flowline />
						</command>
						<command class_type='label' title='Connection Point' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' labelid='0' labelname='Return' />
					</flowline>
				</macro>
				<macro >
					<flowline name='ControlLEDs' description='Allows both the LEDs on the Ethernet socket to be controlled.
Useful for checking if the SPI communications are functioning correctly.' statediag='0' >
						<return name='Return' type='v0' description='' isconst='0' isHidden='0' isinit='0' usrinit='' setinit='' />
						<param name='Mode' type='u8' description='0=Off, 1=On, 2=Auto' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<command class_type='switch' title='Switch' textarea='36,25,36,25' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='.Mode' >
							<case >
								<flowline />
							</case>
							<case exp='0' >
								<flowline >
									<command class_type='call' title='LEDs Off' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='EncPhyWrite' >
										<argument exp='0x14' />
										<argument exp='0x990' />
									</command>
								</flowline>
							</case>
							<case exp='1' >
								<flowline >
									<command class_type='call' title='LEDs On' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='EncPhyWrite' >
										<argument exp='0x14' />
										<argument exp='0x880' />
									</command>
								</flowline>
							</case>
							<case exp='2' >
								<flowline >
									<command class_type='call' title='LEDs Auto' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='EncPhyWrite' >
										<argument exp='0x14' />
										<argument exp='0x476' />
									</command>
								</flowline>
							</case>
						</command>
					</flowline>
				</macro>
				<macro >
					<flowline name='GetDataLength' description='Returns the number of received data bytes after the headers' statediag='0' >
						<return name='Return' type='u16' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='dLength' type='s16' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='hLength' type='s16' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='.dLength = (Buffer[0x10] &lt;&lt; 8) | Buffer[0x11]' />
						</command>
						<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='.dLength = .dLength - 20' />
						</command>
						<command class_type='calculation' title='Length in bytes' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='.hLength = (Buffer[0x2E] &gt;&gt; 4) * 4' />
						</command>
						<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='.dLength = .dLength - .hLength' />
							<exp exp='' />
						</command>
						<command class_type='decision' title='Decision' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='.dLength &lt;= 0' swap='0' >
							<flowline >
								<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='.dLength = 0' />
								</command>
							</flowline>
							<flowline />
						</command>
						<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='.Return = .dLength' />
						</command>
					</flowline>
				</macro>
				<macro >
					<flowline name='CheckForPshAck' description='Checks for a PSHACK flag in the received buffer' statediag='0' >
						<return name='Return' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<command class_type='decision' title='Decision' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='Buffer[0x2F] == 0x12' swap='0' >
							<flowline >
								<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='.Return = 1' />
								</command>
							</flowline>
							<flowline >
								<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='.Return = 0' />
								</command>
							</flowline>
						</command>
					</flowline>
				</macro>
				<macro >
					<flowline name='EncWriteOp' description='' statediag='0' >
						<return name='Return' type='v0' description='' isconst='0' isHidden='0' isinit='0' usrinit='' setinit='' />
						<param name='Op' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='Address' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='Data' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<command class_type='sim' title='Component Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' component='LibraryComponent1' macro='FlashTx' />
						<command class_type='call' title='Call Component Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' component='cal_spi' macro='Master_Enable_CS' />
						<command class_type='call' title='Call Component Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' component='cal_spi' macro='Master_Byte' >
							<argument exp='.Op | (.Address &amp; ADDR_MASK)' />
						</command>
						<command class_type='call' title='Call Component Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' component='cal_spi' macro='Master_Byte' >
							<argument exp='.Data' />
						</command>
						<command class_type='call' title='Call Component Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' component='cal_spi' macro='Master_Disable_CS' />
					</flowline>
				</macro>
				<macro >
					<flowline name='IpFillIpHdrChecksum' description='' statediag='0' >
						<return name='Return' type='v0' description='' isconst='0' isHidden='0' isinit='0' usrinit='' setinit='' />
						<local name='ck' type='u16' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<command class_type='calculation' title='clear the 2 byte checksum' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[0x18] = 0' />
							<exp exp='Buffer[0x19] = 0' />
						</command>
						<command class_type='calculation' title='Dont fragment' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[0x14] = 0' />
							<exp exp='Buffer[0x15] = 0' />
						</command>
						<command class_type='calculation' title='TTL' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[0x16] = 64' />
						</command>
						<command class_type='call' title='Calculate the checksum' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='IpChecksum' >
							<return exp='.ck' />
							<argument exp='0x0E' />
							<argument exp='20' />
							<argument exp='0' />
						</command>
						<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='Buffer[0x18] = .ck &gt;&gt; 8' />
							<exp exp='Buffer[0x19] = .ck' />
						</command>
					</flowline>
				</macro>
				<macro >
					<flowline name='GetTcpDataPointer' description='' statediag='0' >
						<return name='Return' type='u16' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<command class_type='decision' title='Decision' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='info_data_len' swap='0' >
							<flowline >
								<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='.Return = 0x22 + info_hdr_len' />
								</command>
							</flowline>
							<flowline >
								<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='.Return = 0' />
								</command>
							</flowline>
						</command>
					</flowline>
				</macro>
				<macro >
					<flowline name='Main' description='' statediag='0' >
						<return name='Return' type='v0' description='' isconst='0' isHidden='0' isinit='0' usrinit='' setinit='' />
						<command class_type='call' title='Call Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='Initialise' />
						<command class_type='loop' title='Loop' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' type='0' exp='1' >
							<flowline >
								<command class_type='delay' title='Delay' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' exp='10' type='1' />
								<command class_type='call' title='Call Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='Loop' >
									<argument exp='80' />
								</command>
							</flowline>
						</command>
					</flowline>
				</macro>
				<macro >
					<flowline name='WriteRegister' description='Writes a value to a single register onboard the ENC28J60 module.' statediag='0' >
						<return name='Return' type='v0' description='' isconst='0' isHidden='0' isinit='0' usrinit='' setinit='' />
						<param name='Address' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='Data' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<command class_type='call' title='Call Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='EncSetBank' >
							<argument exp='.Address' />
						</command>
						<command class_type='call' title='ENC28J60_WRITE_CTRL_REG' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='EncWriteOp' >
							<argument exp='0x40' />
							<argument exp='.Address' />
							<argument exp='.Data' />
						</command>
					</flowline>
				</macro>
				<macro >
					<flowline name='FillTcpData' description='' statediag='0' >
						<return name='Return' type='u16' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='Position' type='u16' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='Data' type='T8*' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='20' />
						</param>
						<local name='idx' type='u8' description='' isconst='0' isHidden='0' isinit='1' usrinit='0' setinit='0' />
						<command class_type='loop' title='Loop' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' type='0' exp='.Data[.idx]' >
							<flowline >
								<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='Buffer[0x36 + .Position] = .Data[.idx]' />
								</command>
								<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='.idx = .idx + 1' />
									<exp exp='.Position = .Position + 1' />
								</command>
							</flowline>
						</command>
						<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='.Return = .Position' />
						</command>
					</flowline>
				</macro>
				<macro >
					<flowline name='ReadStringFromBuffer' description='Reads a string from the buffer at location specified for the number of bytes specified.
If a space character is encountered then the macro will return straight away without the space character in the string.' statediag='0' >
						<return name='Return' type='T8' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='2000' />
						</return>
						<param name='BufferLocation' type='u16' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='NumberOfBytes' type='u8' description='Number of bytes to read from the buffer and store into string' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='Index' type='u16' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<local name='Count' type='u8' description='' isconst='0' isHidden='0' isinit='1' usrinit='0' setinit='0' />
						<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='.Index = .BufferLocation' />
						</command>
						<command class_type='loop' title='Loop' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' type='0' exp='.Index &lt; (.BufferLocation + .NumberOfBytes)' >
							<flowline >
								<command class_type='decision' title='Check for a space' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' exp='Buffer[.Index] = &apos; &apos;' swap='0' >
									<flowline >
										<command class_type='calculation' title='End collecting data' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
											<exp exp='.Index = 0xFFFF' />
										</command>
									</flowline>
									<flowline >
										<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
											<exp exp='.Return[.Count] = Buffer[.Index]' />
										</command>
										<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
											<exp exp='.Index = .Index + 1' />
											<exp exp='.Count = .Count + 1' />
										</command>
									</flowline>
								</command>
							</flowline>
						</command>
						<command class_type='calculation' title='Null termination' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='.Return[.Count] = 0' />
						</command>
					</flowline>
				</macro>
				<macro >
					<flowline name='GetSendersMAC' description='Gets the MAC address from locations 6-11 of the IP Header' statediag='0' >
						<return name='Return' type='v0' description='' isconst='0' isHidden='0' isinit='0' usrinit='' setinit='' />
						<param name='MAC' type='u8' description='6-byte Array to store the MAC address' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='6' />
						</param>
						<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='.MAC[0] = Buffer[6]' />
							<exp exp='.MAC[1] = Buffer[7]' />
							<exp exp='.MAC[2] = Buffer[8]' />
							<exp exp='.MAC[3] = Buffer[9]' />
							<exp exp='.MAC[4] = Buffer[10]' />
							<exp exp='.MAC[5] = Buffer[11]' />
						</command>
					</flowline>
				</macro>
				<macro >
					<flowline name='FillTcpArray' description='' statediag='0' >
						<return name='Return' type='v0' description='' isconst='0' isHidden='0' isinit='0' usrinit='' setinit='' />
						<param name='Position' type='u16' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='Count' type='u16' description='' isconst='0' isHidden='0' isinit='0' usrinit='0' setinit='' />
						<param name='Data' type='u8' description='' isconst='0' isHidden='0' isinit='0' usrinit='&quot;&quot;' setinit='' >
							<array size='20' />
						</param>
						<local name='idx' type='u16' description='' isconst='0' isHidden='0' isinit='1' usrinit='0' setinit='0' />
						<command class_type='loop' title='Loop' cmdcolor='4767473' cmdcolor_sec='11337727' cmdcolor_txt='0' cmdgradient='4' cmdopacity='0.64' type='0' exp='.Idx &lt; .Count' >
							<flowline >
								<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='Buffer[0x36 + .Position] = .Data[.idx]' />
								</command>
								<command class_type='calculation' title='Calculation' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
									<exp exp='.idx = .idx + 1' />
									<exp exp='.Position = .Position + 1' />
								</command>
							</flowline>
						</command>
					</flowline>
				</macro>
				<macro >
					<flowline name='Initialise' description='Initialises the SPI connection to the TCPIP module and sets up some initial values.
Flashes the LEDs on and off twice to confirm SPI comms are active.
LEDs are then configured to auto functionality.' statediag='0' >
						<return name='Return' type='v0' description='' isconst='0' isHidden='0' isinit='0' usrinit='' setinit='' />
						<command class_type='calculation' title='Copy MAC and IP properties to Vars' cmdcolor='4206456' cmdcolor_sec='10785756' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' >
							<exp exp='MyMac[0] = MAC0' />
							<exp exp='MyMac[1] = MAC1' />
							<exp exp='MyMac[2] = MAC2' />
							<exp exp='MyMac[3] = MAC3' />
							<exp exp='MyMac[4] = MAC4' />
							<exp exp='MyMac[5] = MAC5' />
							<exp exp='' />
							<exp exp='MyIP[0] = IP0' />
							<exp exp='MyIP[1] = IP1' />
							<exp exp='MyIP[2] = IP2' />
							<exp exp='MyIP[3] = IP3' />
						</command>
						<command class_type='call' title='Call Macro' cmdcolor='4487093' cmdcolor_sec='11066367' cmdcolor_txt='16777215' cmdgradient='4' cmdopacity='0.64' macro='InternalInit' />
					</flowline>
				</macro>
			</macros>
			<component class_type='ref' guid='c67171df-0ad6-4b11-8361-cfe14b072847' vmin='1' vmaj='2' codename='cal_spi' panelId='-1' x='0' y='0' z='0' xsz='0.1' ysz='0.1' zsz='2.5' xang='0' yang='0' zang='0' xquat='0' yquat='0' zquat='0' wquat='1' visible='0' scadavisible='1' interactive='0' solid='0' layer='1' poslock='0' comp2dType='0' >
				<resources />
				<properties />
				<values >
					<value target='ENABLED' data='1' />
					<value target='REF' data='1' />
					<value target='CHANNEL' data='001' />
					<value target='MOSI' data='$PORTC.5' />
					<value target='MOSIPins' data='013' />
					<value target='MISO' data='$PORTC.4' />
					<value target='MISOPins' data='065' />
					<value target='CLK' data='$PORTC.3' />
					<value target='CLKPins' data='009' />
					<value target='UseAutoCS' data='1' />
					<value target='UseCS' data='0' />
					<value target='SS' data='$PORTC.2' />
					<value target='CSPolarity' data='000' />
					<value target='SSPins' data='000' />
					<value target='AltSSPin' data='0' />
					<value target='Mode' data='000' />
					<value target='PR_SCALE' data='004' />
					<value target='CKE' data='001' />
					<value target='CKP' data='000' />
					<value target='SMP' data='001' />
					<value target='ScopeTraces' data='1' />
					<value target='ConsoleData' data='1' />
					<value target='Injector' data='000' />
					<value target='InjectorCS' data='0' />
					<value target='InjectorHandle' data='0' />
					<value target='InjectorChannel' data='0' />
					<value target='BMODE' data='6' />
					<value target='MOSI_PORT' data='$PORTC.5' />
					<value target='MOSI_TRIS' data='$PORTC.5' />
					<value target='MOSI_PIN' data='5' />
					<value target='MISO_PORT' data='$PORTC.4' />
					<value target='MISO_TRIS' data='$PORTC.4' />
					<value target='MISO_PIN' data='4' />
					<value target='SCK_PORT' data='$PORTC.3' />
					<value target='SCK_TRIS' data='$PORTC.3' />
					<value target='SCK_PIN' data='3' />
					<value target='SS_PORT' data='$PORTC.2' />
					<value target='SS_TRIS' data='$PORTC.2' />
					<value target='SS_PIN' data='2' />
					<value target='Remappable' data='' />
					<value target='MOSIReg' data='013' />
					<value target='CLKREG' data='009' />
					<value target='MOSIRPNUM' data='5' />
					<value target='MOSIBank' data='' />
					<value target='MOSIBank2' data='' />
					<value target='CLKRPNUM' data='6' />
					<value target='CLKBank' data='' />
					<value target='MISORPREG' data='RPINR20bits.SDI1R' />
					<value target='MISOBank' data='' />
					<value target='SPIName' data='' />
					<value target='MISOReg' data='000' />
					<value target='SPIClock' data='' />
					<value target='MISOBank2' data='' />
					<value target='CLKBank2' data='' />
					<value target='ParentName' data='' />
					<value target='BitDelay' data='0' />
					<value target='ClockSpeed' data='19660800' />
					<value target='MasterDivider' data='4' />
					<value target='Sim' data='1' />
					<value target='CLKRPREG' data='' />
					<value target='SSRPREG' data='' />
					<value target='SSBank' data='' />
					<value target='SSBank2' data='' />
					<value target='AltSSReg' data='' />
					<value target='AltSSMask' data='0' />
				</values>
				<events />
				<apis />
				<variables />
				<macros />
			</component>
			<component class_type='ref' guid='54369d81-80ed-4d59-97bf-91f4b2cdf24c' vmin='2' vmaj='2' codename='TCP_Base1' panelId='-1' x='0' y='0' z='0' xsz='0.1' ysz='0.1' zsz='0' xang='0' yang='0' zang='0' xquat='0' yquat='0' zquat='0' wquat='1' visible='0' scadavisible='1' interactive='0' solid='0' layer='1' poslock='0' comp2dType='0' >
				<resources />
				<properties />
				<values >
					<value target='hostname' data='IRONMAN-PC2' />
					<value target='interface' data='0' />
					<value target='gateway0' data='192' />
					<value target='gateway1' data='168' />
					<value target='gateway2' data='1' />
					<value target='gateway3' data='10' />
					<value target='subnet0' data='255' />
					<value target='subnet1' data='255' />
					<value target='subnet2' data='255' />
					<value target='subnet3' data='0' />
					<value target='ip0' data='192' />
					<value target='ip1' data='168' />
					<value target='ip2' data='1' />
					<value target='ip3' data='49' />
					<value target='mac0' data='112' />
					<value target='mac1' data='77' />
					<value target='mac2' data='123' />
					<value target='mac3' data='104' />
					<value target='mac4' data='27' />
					<value target='mac5' data='112' />
					<value target='ConsoleData' data='1' />
					<value target='notify_target' data='' />
				</values>
				<events />
				<apis />
				<variables />
				<macros />
			</component>
			<component class_type='ref' guid='58be670e-18fb-477e-ab09-61fde14b23ec' vmin='0' vmaj='1' codename='LibraryComponent1' panelId='-1' x='0' y='0' z='0' xsz='100' ysz='100' zsz='100' xang='0' yang='0' zang='0' xquat='0' yquat='0' zquat='0' wquat='1' visible='1' scadavisible='1' interactive='1' solid='1' layer='1' poslock='1' comp2dType='0' >
				<resources />
				<properties />
				<values >
					<value target='Text::sText' data='ENC28J60' />
					<value target='Name' data='' />
					<value target='Peripheral::sText' data='(SPI CH1)' />
					<value target='Text::nVerticalAlignment' data='002' />
					<value target='ShowComms' data='1' />
					<value target='InputIcon::CommsType' data='001' />
					<value target='InputIcon::LinkTo' data='0' />
					<value target='IconsOnRight' data='0' />
					<value target='OutputIcon::CommsType' data='005' />
					<value target='OutputIcon::LinkTo' data='0' />
					<value target='ConsoleHandle' data='629' />
					<value target='Upgraded' data='0' />
				</values>
				<events />
				<apis />
				<variables />
				<macros />
			</component>
		</component>
	</components>
	<scadaresourcelookup />
	<keymap />
	<panel2d shadows='0' lighting='2' brightness='0' >
		<background rgb='9737364' img='' style='0' />
		<camera xe='7.57361' ye='2.81289' ze='322.425' xt='7.57361' yt='2.81289' zt='0' xquat='0' yquat='0' zquat='0' wquat='1' />
		<viewport dx='622' dy='352' zoom='233.425' fix_topleft='0' />
		<page x='1000' y='1000' show='0' rgb='0' />
		<winpos ID='7005' RectRecentFloat='1270,379,1920,829' RectRecentDocked='238,513,880,932' RecentFrameAlignment='16384' RecentRowIndex='0' IsFloating='0' MRUWidth='32767' PinState='0' IsMaximized='0' IsVisible='0' />
	</panel2d>
	<panel3d shadows='0' lighting='2' brightness='0' perspective='1' >
		<background rgb='8409120' img='' style='0' />
		<table rgb='7360576' img='' style='0' size='25' />
		<camera xe='0' ye='0' ze='300' xt='0' yt='0' zt='0' xquat='0' yquat='0' zquat='0' wquat='1' />
		<camerakey0 xe='0' ye='0' ze='300' xt='0' yt='0' zt='0' xquat='0' yquat='0' zquat='0' wquat='1' />
		<camerakey1 xe='-3.67394e-14' ye='0' ze='-300' xt='0' yt='0' zt='0' xquat='0' yquat='1' zquat='0' wquat='6.12323e-17' />
		<camerakey2 xe='0' ye='-300' ze='6.66134e-14' xt='0' yt='0' zt='0' xquat='-0.707107' yquat='0' zquat='0' wquat='0.707107' />
		<camerakey3 xe='-3.67394e-14' ye='300' ze='6.66134e-14' xt='0' yt='0' zt='0' xquat='-4.32978e-17' yquat='0.707107' zquat='0.707107' wquat='4.32978e-17' />
		<camerakey4 xe='-300' ye='-6.66134e-14' ze='6.66134e-14' xt='0' yt='0' zt='0' xquat='-0.5' yquat='0.5' zquat='0.5' wquat='0.5' />
		<camerakey5 xe='300' ye='-6.66134e-14' ze='6.66134e-14' xt='0' yt='0' zt='0' xquat='-0.5' yquat='-0.5' zquat='-0.5' wquat='0.5' />
		<camerakey6 xe='-173.205' ye='-173.205' ze='173.205' xt='0' yt='0' zt='0' xquat='-0.424708' yquat='0.17592' zquat='0.339851' wquat='0.820473' />
		<winpos ID='7004' RectRecentFloat='0,425,654,1002' RectRecentDocked='0,0,269,874' RecentFrameAlignment='16384' RecentRowIndex='0' IsFloating='1' MRUWidth='32767' PinState='0' IsMaximized='0' IsVisible='1' />
	</panel3d>
	<panels2d count='0' />
	<layout >
		<view type='0' name='InternalInit' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAAlgMAAGsDAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='Initialise' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAAlgMAAGsDAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='PacketReceive' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAAlgMAAGsDAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='ReadArrayFromBuffer' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAAlgMAAGsDAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='EncReadOp' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAAlgMAAGsDAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='Main' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAAlgMAAGsDAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='SetMyMACAddress' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAAlgMAAGsDAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='SetMyIPAddress' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAAlgMAAGsDAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='EncInit' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAAlgMAAGsDAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='ReadRegister' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAAlgMAAGsDAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='EncSetBank' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAAlgMAAGsDAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='CheckForARP' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAAlgMAAGsDAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='MakeArpAnswerFromRequest' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAAlgMAAGsDAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='CheckForIp' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAAlgMAAGsDAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='IpMakeIpTcpNew' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAAlgMAAGsDAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='CheckArpPacketIsMyreplyArp' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAAlgMAAGsDAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='IpMakeIp' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAAlgMAAGsDAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='MakeArpRequest' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAAlgMAAGsDAAA' zoom='75' scrollx='0' scrolly='606' flags='0' />
		<view type='0' name='ClientSendPacket' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAAlgMAAGsDAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='IpMakeEthIpNew' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAAlgMAAGsDAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='IpMakeEth' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAAlgMAAGsDAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='Ev_Property' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAAlgMAAGsDAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='Loop' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAAlgMAAGsDAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='PacketSend' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAAlgMAAGsDAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='IpMakeTcpHead' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAAlgMAAGsDAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='CheckForPshAck' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAAlgMAAGsDAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='CheckForTCPType' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAAlgMAAGsDAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='EncReadBuffer' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAAlgMAAGsDAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='EncWriteBuffer' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAAlgMAAGsDAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='EncWriteOp' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAAlgMAAGsDAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='Ev_Initialise' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAAlgMAAGsDAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='EncPhyWrite' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAAlgMAAGsDAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='ControlLEDs' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAAlgMAAGsDAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='WriteRegister' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAAlgMAAGsDAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='EncClockOut' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAAlgMAAGsDAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='CheckForTCPPort' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAAlgMAAGsDAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='MakeTcpAckFromAny' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAAlgMAAGsDAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='MakeTcpSynackFromSyn' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAAlgMAAGsDAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='IpMakeUdpReplyFromRequest' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAAlgMAAGsDAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='GetDataLength' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAAlgMAAGsDAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='CheckForSynAck' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAAlgMAAGsDAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='CheckForPing' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAAlgMAAGsDAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='GetSendersMAC' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAAlgMAAGsDAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='InitialiseDataLengthInfo' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAAlgMAAGsDAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='GetTcpDataPointer' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAAlgMAAGsDAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='MakeTcpAckWithData' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAAlgMAAGsDAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='MakeEchoReplyFromRequest' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAAlgMAAGsDAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='GetModuleRevision' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAAlgMAAGsDAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='Ev_GetVarSize' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAAlgMAAGsDAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='Ev_AddVarSize' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAAlgMAAGsDAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='IpFillIpHdrChecksum' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAAlgMAAGsDAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='IpChecksum' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAAlgMAAGsDAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='IpInitIpArpUdpTcp' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAAlgMAAGsDAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='PopulateInjectorFilter' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAAlgMAAGsDAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='ReadStringFromBuffer' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAAlgMAAGsDAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='FillTcpData' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAAlgMAAGsDAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
		<view type='0' name='FillTcpArray' mode='0' placement='LAAAAAAAAAABAAAA---------------------wUAAAAYAAAAlgMAAGsDAAA' zoom='75' scrollx='0' scrolly='0' flags='0' />
	</layout>
</document>
</root>
